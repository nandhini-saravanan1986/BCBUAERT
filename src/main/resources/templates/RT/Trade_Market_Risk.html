<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<!-- 
CREATED BY	: Gowtham R
CREATED ON	: 16.06.2025
PURPOSE		:  Trade Market Risk Report
Tested by   : Rajalakshmi
-->

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- ✅ CSS Libraries -->
	<link rel="stylesheet" th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}" />
	<link rel="stylesheet" th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}" />
	<link rel="stylesheet" th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}" />
	<link rel="stylesheet" th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}" />
	<link rel="stylesheet" th:href="@{/css/CustomButton.css}" />
	<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon" />

	<!-- ✅ JavaScript Libraries (in correct order) -->

	<!-- jQuery core (must be loaded first) -->
	<script th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>

	<!-- jQuery Plugins -->
	<script th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>
	<script th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

	<!-- Bootstrap and dependencies -->
	<script th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>

	<!-- DataTables -->
	<script th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
</head>

<style>
	.btns {
		float: right;
		margin: 5px;
	}

	.col-sm-5 {
		padding-bottom: 15px;
	}

	.list-body {
		padding: 0px;
	}

	.error {
		color: red;
		padding-left: 10px;
	}

	.formline {
		padding-bottom: 15px;
	}

	.btn-primary {
		background-color: #E77400;
		border-color: #0c0c0c;
	}

	.btn-primary:not(:disabled):not(.disabled).active,
	.btn-primary:not(:disabled):not(.disabled):active,
	.show > .btn-primary.dropdown-toggle {
	  color: #fff;
	  background-color: #cc0000;
	  border-color: #161617;
	}

	#finusertb {
		width: 460px;
	}

	.dataTables_wrapper .dataTables_paginate .paginate_button {
		padding: 0px;
	}
</style>




<style>
	.card {
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		border-radius: 8px;
	}

	.card-header h5 {
		font-size: 22px;
		color: #fff;
		font-weight: 600;
	}

	.nav-tabs .nav-link {
		font-weight: 500;
		border: 1px solid #dee2e6;
		border-bottom: none;
		border-radius: 4px 4px 0 0;
		background-color: #f1f1f1;
		margin-right: 5px;
	}

	.nav-tabs .nav-link.active {
		background-color: #ffffff;
		border-color: #dee2e6 #dee2e6 #ffffff;
	}

	.table-responsive {
		border: 1px solid #dee2e6;
		border-radius: 4px;
	}

	.table-hover tbody tr:hover {
		background-color: #f3f6f9;
	}

	thead th {
		position: sticky;
		top: 0;
		background-color: #e9ecf0;
		z-index: 1;
	}

	.card-footer {
		padding: 10px;
		border-top: 1px solid #ccc;
	}

	.btn-xs {
		padding: 4px 12px;
		font-size: 14px;
		border-radius: 4px;
	}

	#usertable th,
	#usertable td {
		vertical-align: middle;
		text-align: left;
		font-size: 17px;
		font-family: Verdana, sans-serif;
	}

	.fa-edit:hover {
		color: #28a745;
		transform: scale(1.1);
	}



	td {
		border: 1px solid rgb(0, 164, 166);
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
</style>


<style>
	.form-group {
		position: relative;
		margin-bottom: 1.5rem;
	}

	.form-control {
		width: 100%;
		border: 2px solid #ccc;
		border-radius: 8px;
		font-size: 1rem;
		outline: none;
		background: transparent;
		transition: border-color 0.3s ease, padding-top 0.3s ease;
	}

	.error {
		color: red;
		padding-top: 15px;
	}



	.form-control:focus {
		border-color: #007bff;
	}

	.form-legend {
		position: absolute;
		top: 50%;
		left: 15px;
		transform: translateY(-50%);
		font-size: 1rem;
		color: #aaa;
		background: white;
		padding: 0 5px;
		pointer-events: none;
		transition: 0.3s ease;
	}

	/* When input or select is focused or has a value, move the label up */
	.form-control:focus~.form-legend,
	.form-control:not(:placeholder-shown)~.form-legend {
		top: -8px;
		font-size: 1rem;
		color: #007bff;
	}

	/* Hover effect when the input/select is focused */
	.form-control:focus:hover~.form-legend {
		color: #0056b3;
		/* Darker shade of blue on hover */
	}

	/* Ensure the label returns to the normal color after focus or hover is removed */
	.form-control:not(:focus)~.form-legend {
		color: #aaa;
		/* Normal label color */
	}
</style>

<style>
	/* Red border for invalid inputs */
	input.error,
	select.error {
		border: 2px solid red !important;
	}

	/* Error message style */
	label.error {
		color: red;
		font-size: 0.85em;
		margin-top: 5px;
		display: block;
	}

	.section-header {
		font-weight: bold;
	}
</style>
<script type="text/javascript">
	$(document).ready(function () {
		$("#nostroForm").validate({
			errorClass: "error", // use 'error' class for styling
			errorElement: "label", // wrap error messages in <label>

			rules: {
				submittingInstitution: {required: true},
				portfolioDate: {required: true},
				contactEmployee1Name1: {required: true},
				contactEmployee1Title1: {required: true},
				contactEmployee1Email1: {required: true, email: true},
				contactEmployee2Name2: {required: true},
				contactEmployee2Title2: {required: true},
				contactEmployee2Email2: {required: true, email: true},
				signOffCroName: {required: true},
				signOffCroEmail: {required: true, email: true},
				signOffCfoName: {required: true},
				signOffCfoEmail: {required: true, email: true},
				signOffHeadOfTreasuryName: {required: true},
				signOffHeadOfTreasuryEmail: {required: true, email: true}
			},
			messages: {
				submittingInstitution: {required: "Please select an institution"},
				portfolioDate: {required: "Please select a portfolio date"},
				contactEmployee1Name1: {required: "Please enter a name"},
				contactEmployee1Title1: {required: "Please enter a title"},
				contactEmployee1Email1: {required: "Please enter an email", email: "Please enter a valid email address"},
				contactEmployee2Name2: {required: "Please enter a name"},
				contactEmployee2Title2: {required: "Please enter a title"},
				contactEmployee2Email2: {required: "Please enter an email", email: "Please enter a valid email address"},
				signOffCroName: {required: "Please enter CRO name"},
				signOffCroEmail: {required: "Please enter CRO email", email: "Please enter a valid email address"},
				signOffCfoName: {required: "Please enter CFO name"},
				signOffCfoEmail: {required: "Please enter CFO email", email: "Please enter a valid email address"},
				signOffHeadOfTreasuryName: {required: "Please enter Head of Treasury name"},
				signOffHeadOfTreasuryEmail: {required: "Please enter Head of Treasury email", email: "Please enter a valid email address"}
			},

			// Place the error after the input field
			errorPlacement: function (error, element) {
				if (element.parent('.form-group').length) {
					error.insertAfter(element); // default
				} else {
					error.insertAfter(element);
				}
			},

			// Highlight and unhighlight fields
			highlight: function (element) {
				$(element).addClass("error");
			},
			unhighlight: function (element) {
				$(element).removeClass("error");
			},

			// On successful validation, run this
			submitHandler: function (form) {
				submitForm(); // your custom submit function
			}
		});
	});
</script>

<script>

	function submitForm() {
		// First, check if the form is valid
		if (!$("#nostroForm").valid()) {
			return; // If not valid, stop the submission
		}

		$("#loader").modal("toggle");

		const reportName = 'CBUAE_Trade_Market_Risk_Data_Template';
		const submitUrl = './createDataControl?report_name=' + encodeURIComponent(reportName);
		const formData = $("#nostroForm").serialize();

		$.ajax({
			url: submitUrl,
			type: "POST",
			data: formData,
			success: function (response) {
				$("#loader").modal("hide");
				$("#alertmsg1").text(response);
				$("#alert1").modal("toggle");
			},
			error: function (xhr, status, error) {
				$("#loader").modal("hide");
				console.error("Error:", error);
				alert("Error occurred: " + error);
			}
		});
	}


</script>

<script th:inline="javascript">


	function home() {
		$("#loader").modal("toggle");
		location.href = 'Dashboard'
	}

	function back() {
		$("#loader").modal("toggle");
		window.history.back();
	}

	function list() {
		location.href = 'Trade_Market_Risk?formmode=list';
	}

	function trade() {
		location.href = 'Trade_Market_Risk';
	}

	$(document).ready(function () {
		// On modal close, redirect to the list view
		$('#alert').on('hidden.bs.modal', function () {
			window.location.href = './Trade_Market_Risk?formmode=list';
		});
	});

	// This function handles the submission of the edit form.
	function updateform(event) {
		event.preventDefault(); // Prevent the default form submission
		$("#loader").modal("show");

		$.ajax({
			url: './updateTradeMarketRisk',
			type: 'POST',
			data: $('#tradeMarketRiskEditForm').serialize(),
			success: function (response) {
				$("#loader").modal("hide");
				$("#alertmsg").text(response);
				$("#alert").modal("show");
			},
			error: function (xhr, status, error) {
				console.error("Error in modify:", error);
				$("#loader").modal("hide");
				alert("Failed to modify. Please try again.");
			}
		});
	}

</script>

<script>
	function navigateToTab(tabId) {
		if (tabId === 'data') {
			window.location.href = 'Trade_Market_Risk?formmode=list';
		} else if (tabId === 'datacontrols') {
			window.location.href = 'Trade_Market_Risk?formmode=add';

		}
	}

	function handleClick(tabId) {
		// Remove active class from all buttons
		document.querySelectorAll('.custom-tab-btn').forEach(btn => btn.classList.remove('active'));
		document.getElementById(tabId + '-btn').classList.add('active');

		// Hide all panes
		document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('show', 'active'));
		document.getElementById(tabId).classList.add('show', 'active');
	}

	// On page load, detect formmode and show corresponding tab
	window.addEventListener('DOMContentLoaded', function () {
		const params = new URLSearchParams(window.location.search);
		const formmode = params.get('formmode');

		if (formmode === 'list') {
			handleClick('data');
		} else if (formmode !== 'edit') { // Do not trigger for edit mode
			handleClick('datacontrols'); // default or formmode=add
		}
	});
</script>

<script>
	/**
	 * Shows a custom styled modal with a title and message.
	 * @param {string} title - The title for the modal header.
	 * @param {string} message - The message for the modal body.
	 */
	function showResultModal(title, message) {
		// Set the text for the modal elements
		$('#resultModalLabel').text(title);
		$('#resultModalBody').text(message);

		// Show the modal
		$('#resultModal').modal('show');
	}

	/**
	 * Initiates the download for the Trade Market Risk report.
	 */
	function downloadTradeMarketRisk() {
		// 1. Show the loader
		$('#loader').modal('show');

		$.ajax({
			url: './downloadTradeMarketRiskExcel',
			type: 'GET',
			xhrFields: {
				responseType: 'blob' // Essential for file downloads
			},
			success: function (data) {
				// 2a. Hide loader on success
				$('#loader').modal('hide');

				// Check if the server returned any data to download
				if (data && data.size > 100) { // A small threshold to ensure the file isn't empty
					// Create a temporary link to trigger the download
					const blob = new Blob([data], {type: 'application/vnd.ms-excel'});
					const url = window.URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.style.display = 'none';
					a.href = url;
					a.download = 'CBUAE_Trade_Market_Risk_Data_Template.xls';
					document.body.appendChild(a);

					a.click();

					// Clean up the temporary link and URL
					window.URL.revokeObjectURL(url);
					document.body.removeChild(a);

					// Show success message in your custom modal
					showResultModal('Success', 'The file has been downloaded successfully.');

				} else {
					// Handle case where the server responds but there's no data
					showResultModal('Information', 'No data was available to create a download.');
				}
			},
			error: function (jqXHR, textStatus, errorThrown) {
				// 2b. Hide loader on error
				$('#loader').modal('hide');

				console.error("Download failed:", textStatus, errorThrown);

				// Show error message in your custom modal
				showResultModal('Error', 'An error occurred while downloading the file. Please try again.');
			}
		});
	}


</script>
<title>BCDRS</title>

<body>
	<div class="container-fluid" style="padding-left:0px; padding-right:0px;">
		<div class="row">

			<div th:insert="XBRLHeaderMenu :: header"></div>

			<div class="card-header" th:if="${formmode == 'list' or formmode == 'add' or formmode =='null' }"
				style="background-color: rgb(107, 122, 143) ; ">
				<div class="float-left">
					<h5
						style="font-family: verdana; margin-left:20px; font-size: 20px; font-weight: bold; padding-top: 10px; ">
						TRADE MARKET RISK REPORT</h5>
				</div>


			</div>
			<!-- -------------------User List Starts----------------------------------------------------- -->
			<div style="padding-right: 10px;padding-left: 20px;"
				th:if="${formmode == 'list' or formmode == 'add' or formmode =='null' }">





				<!-- Tabs -->
				<div class="button-tab-group" style="margin-top:5px; margin-bottom:20px;">
					<button class="custom-tab-btn" id="datacontrols-btn" onclick="navigateToTab('datacontrols')">Data
						Controls</button>
					<button class="custom-tab-btn" id="template-btn" onclick="handleClick('template')">Template
						Instructions</button>
					<button class="custom-tab-btn" id="data-btn" onclick="navigateToTab('data')">Data</button>
					<div class="float-right" style="margin-left:61%">

						<button th:if="${formmode} =='list'" type="button" class="custom-tab-btn"
							onclick="downloadTradeMarketRisk();">
							<i class="fa fa-download"></i> Download
						</button>

					</div>
				</div>






				<div class="tab-content" id="myTabContent" style="margin-top: 15px;"
					th:if="${formmode} =='null' or formmode == 'add'">
					<div class="tab-pane fade show active" id="datacontrols" role="tabpanel">

						<div class="row">
							<div class="col-sm-12 finuserapply">
								<form id="nostroForm" method="post" autocomplete="off">
									<div class="card-body" style="max-height:450px; overflow-y:auto">


										<input autocomplete="false" name="hidden" type="text" style="display: none;">
										<div class="form-group" style="border:none">
											<div class="row formline">
												<div class="col-sm-1"></div>
												<div class="form-group col-md-4">
													<select id="submittingInstitution" name="submittingInstitution"
														class="form-control" required>
														<option value="">-- Select Institution --</option>
														<option value="Bank of Baroda">Bank of Baroda</option>
													</select>
													<label for="submittingInstitution" class="form-legend">Submitting
														Institution</label>
												</div>


												<div class="col-sm-1"></div>

												<div class="form-group col-md-4">
													<input type="date" id="portfolioDate" name="portfolioDate"
														class="form-control" placeholder=" " required />
													<label for="portfolioDate" class="form-legend">Portfolio
														date</label>
												</div>
											</div>

											<!-- Contact Employee 1 Name / Title -->
											<!-- Contact Employee 1 Group -->
											<div class="form-group"
												style="border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
												<div class="row formline">
													<div class="col-sm-12">
														<label style="font-weight: bold; color: #007B8A;">Contact
															Details(Employee 1)</label>
													</div>
												</div>
												<div class="row formline">
													<div class="form-group col-md-4">
														<input type="text" id="contactEmployee1Name1"
															name="contactEmployee1Name1" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee1Name1"
															class="form-legend">Name</label>
													</div>


													<div class="form-group col-md-4">
														<input type="text" id="contactEmployee1Title1"
															name="contactEmployee1Title1" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee1Title1"
															class="form-legend">Title</label>
													</div>



													<div class="form-group col-md-4">
														<input type="email" id="contactEmployee1Email1"
															name="contactEmployee1Email1" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee1Email1"
															class="form-legend">Email</label>
													</div>
													<div class="col-sm-3">
													</div>

												</div>
											</div>
											<div class="form-group"
												style="border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
												<div class="row formline">
													<div class="col-sm-12">
														<label style="font-weight: bold; color: #007B8A;">Contact
															Details(Employee 2)</label>
													</div>
												</div>
												<div class="row formline">
													<div class="form-group col-md-4">
														<input type="text" id="contactEmployee2Name2"
															name="contactEmployee2Name2" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee2Name2"
															class="form-legend">Name</label>
													</div>


													<div class="form-group col-md-4">
														<input type="text" id="contactEmployee2Title2"
															name="contactEmployee2Title2" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee2Title2"
															class="form-legend">Title</label>
													</div>



													<div class="form-group col-md-4">
														<input type="email" id="contactEmployee2Email2"
															name="contactEmployee2Email2" class="form-control"
															placeholder=" " required />
														<label for="contactEmployee2Email2"
															class="form-legend">Email</label>
													</div>
													<div class="col-sm-3">
													</div>

												</div>
												<!-- Contact Employee 2 Group -->
											</div>
											<div class="form-group"
												style="border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
												<div class="row formline">
													<div class="col-sm-12">
														<label style="font-weight: bold; color: #007B8A;">Sign
															Off</label>
													</div>
												</div>

												<!-- Sign-off CRO Name / Email -->
												<div class="row formline">
													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="text" id="signOffCroName" name="signOffCroName"
															class="form-control" placeholder=" " required />
														<label for="signOffCroName" class="form-legend">CRO Name</label>
													</div>
													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="email" id="signOffCroEmail" name="signOffCroEmail"
															class="form-control" placeholder=" " required />
														<label for="signOffCroEmail" class="form-legend">CRO
															Email</label>
													</div>

												</div>

												<!-- Sign-off CFO Name / Email -->
												<div class="row formline">
													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="text" id="signOffCfoName" name="signOffCfoName"
															class="form-control" placeholder=" " required />
														<label for="signOffCfoName" class="form-legend">CFO Name</label>
													</div>

													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="email" id="signOffCfoEmail" name="signOffCfoEmail"
															class="form-control" placeholder=" " required />
														<label for="signOffCfoEmail" class="form-legend">CFO
															Email</label>
													</div>

												</div>

												<!-- Sign-off Head of Treasury Name / Email -->
												<div class="row formline">
													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="text" id="signOffHeadOfTreasuryName"
															name="signOffHeadOfTreasuryName" class="form-control"
															placeholder=" " required />
														<label for="signOffHeadOfTreasuryName" class="form-legend">Head
															of Treasury Name</label>
													</div>

													<div class="col-sm-1"></div>
													<div class="form-group col-md-4">
														<input type="email" id="signOffHeadOfTreasuryEmail"
															name="signOffHeadOfTreasuryEmail" class="form-control"
															placeholder=" " required />
														<label for="signOffHeadOfTreasuryEmail" class="form-legend">Head
															of Treasury Email</label>
													</div>
												</div>
											</div>

										</div>


								</form>
							</div>
						</div>
						<div class="card-footer text-center"
							style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
							<button type="button" class="custom-tab-btn" onclick="home();">
								<i class="fa fa-home"></i> Home
							</button>


							<button th:if="${formmode == 'null' or formmode == 'add'}" type="button"
								class="custom-tab-btn" onclick="submitForm()">Save</button>


							<button type="button" class="custom-tab-btn" onclick="back();">
								<i class="fa fa-arrow-left"></i> Back
							</button>

						</div>
					</div>
				</div>

				<!-- --------------------------------------DATA CONTROL ENDS--------------------------------------------- -->

				<!-- --------------------------------------TEMPLATE STARTS--------------------------------------------- -->

				<div class="tab-pane fade" id="template" role="tabpanel"
					th:if="${formmode == 'null' or formmode == 'add'}">
					<p>Templates tabs</p>
					<div class="card-footer text-center"
						style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
						<button type="button" class="custom-tab-btn" onclick="home();">
							<i class="fa fa-home"></i> Home
						</button>


					<!--	<button th:if="${formmode == 'null' or formmode == 'add'}" type="button" class="custom-tab-btn"
							onclick="submitForm()">Save</button>-->


						<button type="button" class="custom-tab-btn" onclick="back();">
							<i class="fa fa-arrow-left"></i> Back
						</button>

					</div>
				</div>

				<!-- --------------------------------------TEMPLATE ENDS--------------------------------------------- -->



				<!-- -----------------------------------DATA LIST STARTS -------------------------------------------- -->
				<div class="tab-pane fade" id="data" role="tabpanel">

					<div class="table-responsive" style="max-height: 500px; overflow: auto; border:none;">
						<table id="usertable" class="table table-bordered table-striped table-hover"
							style="min-width: 2000px; font-family:calibri;">

							<thead class="thead-light" style="background-color:#e9ecf0; font-size: 11px;">

								<tr>
									<th style="width: 40px;">Edit</th>
									<th>Report Date</th>
									<th>Bank Name</th>
									<th>Group_Head_Office_Subsidiary</th>
									<th>Subsidiary</th>
									<th>Bank Symbol</th>
									<th>Conventional/Islamic</th>
									<th>Local/Foreign</th>
									<th>CBUAE Tiering</th>
									<th>Trading Book/Desks</th>
									<th>CBUAE Internal Desk Reference</th>
									<th>Annual Budget (AED)</th>
									<th>Trading desk/book Size (Market value AED)</th>
									<th>Relative size (% Total Assets or % Total Trading Book)</th>
									<th>YTD P&L (AED)</th>
									<th>Maximum Loss over the period (AED)</th>
									<th>Confidence Interval</th>
									<th>Holding Period</th>
									<th>VaR Exposure (AED)</th>
									<th>VaR Limit (AED)</th>
									<th>Status</th>
									<th>Expected Shortfall (AED)</th>
									<th>Expected Shortfall Limit (AED)</th>
									<th>Status</th>
									<th>Modified Duration</th>
									<th>Interest rate shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>DV01</th>
									<th>Limit</th>
									<th>Status</th>
									<th>DV01 Tenor <3Yr </th>
									<th>DV01 Tenor >3Yr</th>
									<th>Credit Spread CS01</th>
									<th>Credit Spread shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Credit Spread CS01 (Investment Grade)</th>
									<th>Credit Spread CS01 (Sub Investment)</th>
									<th>Credit Spread CS01 (Unrated)</th>
									<th>Beta Equity</th>
									<th>Equity shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>BR01</th>
									<th>Interest rate differential shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Delta</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Gamma</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Vega</th>
									<th>Implied Volatility Type</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Theta</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Rho</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Vanna</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Dollar Volga</th>
									<th>shock applied (bps)</th>
									<th>Limit</th>
									<th>Status</th>
									<th>Credit Spread (AED)</th>
									<th>Credit Sensitive Impact (%)</th>
									<th>Interest Rate in the Trading Book (AED)</th>
									<th>Rate Sensitive Impact (%)</th>
									<th>Foreign Exchange (AED)</th>
									<th>FX Sensitive Impact (%)</th>
									<th>Equity (AED)</th>
									<th>Equity Sensitive Relative Impact (%)</th>
									<th>Commodities (AED)</th>
									<th>Commodity Sensitive Relative Impact (%)</th>
									<th>Credit Derivatives (AED)</th>
									<th>Relative Impact (%)</th>
									<th>Jump-to-Default Loss (AED)</th>
									<th>JTD Relative Impact (%)</th>
									<th>Overall Impact (AED)</th>
									<th>Overall Relative Impact (%)</th>
								</tr>

							</thead>

							<tbody style="font-size: 9px;">

								<!-- Loop to render data dynamically -->
								<tr th:each="data : ${dataList}">
									<td>
										<a
											th:href="@{/Trade_Market_Risk(formmode='edit', reportDate=${#dates.format(data.reportDate, 'yyyy-MM-dd')})}">
											<i class="fa fa-edit" style="color: #007bff; font-size: 16px;"></i>
										</a>
									</td>
									<td th:text="${#dates.format(data.reportDate, 'dd-MM-yyyy')}"></td>
									<td th:text="${data.bankName}"></td>
									<td th:text="${data.groupHeadOfficeSubsidiary}"></td>
									<td th:text="${data.subsidiary}"></td>
									<td th:text="${data.bankSymbol}"></td>
									<td th:text="${data.conventionalIslamic}"></td>
									<td th:text="${data.localForeign}"></td>
									<td th:text="${data.cbuaeTiering}"></td>
									<td th:text="${data.tradingBookDesks}"></td>
									<td th:text="${data.cbuaeInternalDeskReference}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.annualBudgetAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.tradingDeskBookSizeMarketValueAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.relativeSizePercentTotalAssetsOrPercentTotalTradingBook, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.ytdPandLAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.maximumLossOverThePeriodAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td th:text="${data.confidenceInterval}"></td>
<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.holdingPeriod, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.varExposureAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.varLimitAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td th:text="${data.status}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.expectedShortfallAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.expectedShortfallLimitAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td th:text="${data.status2}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.modifiedDuration, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.interestRateShockAppliedBps, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit1, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status3}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.dv01, 1, 'COMMA', 2, 'POINT')}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit2, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status4}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.dv01TenorGapsLt3Yr, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.dv01TenorGapsGt3Yr, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadCs01, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadShockAppliedBps, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit3, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status5}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadCs01InvestmentGrade, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadCs01SubInvestment, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadCs01Unrated, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.betaEquity, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.equityShockAppliedBps, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit4, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status6}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.br01, 1, 'COMMA', 2, 'POINT')}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.interestRateDifferentialShockAppliedBps, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.limit5, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status7}"></td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.dollarDelta, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.shockAppliedBps1, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit6, 1, 'COMMA', 2, 'POINT')}"></td>
									<td style="text-align: right;" th:text="${data.status8}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.dollarGamma, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.shockAppliedBps2, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit7, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status9}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.dollarVega, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  th:text="${data.impliedVolatilityType}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.shockAppliedBps3, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.limit8, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status10}"></td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.dollarTheta, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.limit9, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status11}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.dollarRho, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" 
										th:text="${#numbers.formatDecimal(data.shockAppliedBps4, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit10, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status12}"></td>
									<td style="text-align: right;"  th:text="${#numbers.formatDecimal(data.dollarVanna, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.shockAppliedBps5, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.limit11, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status13}"></td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.dollarVolga, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.shockAppliedBps6, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td  style="text-align: right;"th:text="${#numbers.formatDecimal(data.limit12, 1, 'COMMA', 2, 'POINT')}"></td>
									<td th:text="${data.status14}"></td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSpreadAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditSensitiveImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.interestRateInTheTradingBookAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.rateSensitiveImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.foreignExchangeAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.fxSensitiveImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;" th:text="${#numbers.formatDecimal(data.equityAed, 1, 'COMMA', 2, 'POINT')}">
									</td> 
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.equitySensitiveRelativeImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td
										th:text="${#numbers.formatDecimal(data.commoditiesAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.commoditySensitiveRelativeImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.creditDerivativesAed, 1, 'COMMA', 2, 'POINT')}">
									</td> 
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.relativeImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.jumpToDefaultLossAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.jtdRelativeImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.overallImpactAed, 1, 'COMMA', 2, 'POINT')}">
									</td>
									<td style="text-align: right;"
										th:text="${#numbers.formatDecimal(data.overallRelativeImpactPercent, 1, 'COMMA', 2, 'POINT')}">
									</td>
								</tr>

							</tbody>
						</table>
					</div>
					<div class="card-footer text-center"
						style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
						<button type="button" class="custom-tab-btn" onclick="home();">
							<i class="fa fa-home"></i> Home
						</button>


						<button th:if="${formmode == 'null' or formmode == 'add'}" type="button" class="custom-tab-btn"
							onclick="submitForm()">Save</button>


						<button type="button" class="custom-tab-btn" onclick="back();">
							<i class="fa fa-arrow-left"></i> Back
						</button>

					</div>

				</div>

			</div>
		</div>

		<!------------------ edit starts-------------------------------------------------------------->

		<div th:if="${formmode}=='edit'" style="width:100%;">

			<div class="row" style="margin: 0;">
				<form th:action="@{/updateTradeMarketRisk}" th:object="${data}" method="post"
					id="tradeMarketRiskEditForm" style="width: 100%;">
					<div class="card" style="margin-left: 15px;margin-right: 15px;">
						<div class="card-header" style="background-color: rgb(166,0,0);">
							<div class="float-left">
								<h3
									style="font-family: verdana;color: white !important; font-size: 24px; font-weight: bold;">
									Trade Market Risk - Edit</h3>
							</div>

						</div>
						<div class="card-body" style="max-height: 500px; overflow-y: auto;">
							<!-- Hidden field for the ID -->
							<input type="hidden" th:field="*{reportDate}" />

							<!-- SECTION: General Information -->
							<h4 class="section-header">Financial Institution information</h4>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Report Date</label>
								<div class="col-sm-4">
									<input type="text" class="form-control"
										th:value="${#dates.format(data.reportDate, 'dd-MM-yyyy')}" required readonly />
								</div>
								
								<label class="col-sm-2 col-form-label">Bank Name</label>
																	<div class="col-sm-4">
																		<select class="form-control" th:field="*{bankName}"
																			onchange="handleBankChange(this)">
																			<option value="" disabled selected>-- Select Bank --</option>
																			<option th:each="bank : ${bankList}" th:value="${bank.bankName}"
																				th:text="${bank.bankName}"></option>
																		</select>
												</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Group_Head_Office_Subsidiary</label>
																<div class="col-sm-4">
																	<select class="form-control" th:field="*{groupHeadOfficeSubsidiary}">
																		<option value="" disabled selected>-- Select --</option>
																		<option value="Head Office">Head Office</option>
																		<option value="Subsidiary">Subsidiary</option>
																	</select>
																</div>
								<label class="col-sm-2 col-form-label">Subsidiary</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{subsidiary}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Bank Symbol</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{bankSymbol}" readonly/>
								</div>
								<label class="col-sm-2 col-form-label">Conventional/Islamic</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{conventionalIslamic}" readonly/>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Local/Foreign</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{localForeign}" readonly/>
								</div>
								<label class="col-sm-2 col-form-label">CBUAE Tiering</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{cbuaeTiering}" readonly/>
								</div>
							</div>

							<!-- SECTION: Book Size & P&L -->
							<h4 class="section-header">Trading Book Desks</h4>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Trading Book/Desks</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  vchar-50" th:field="*{tradingBookDesks}" />
								</div>
								<label class="col-sm-2 col-form-label">CBUAE Internal Desk Reference</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  vchar-50" th:field="*{cbuaeInternalDeskReference}" readonly/>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Annual Budget (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-24-2" th:field="*{annualBudgetAed}" />
								</div>
								<label class="col-sm-2 col-form-label">Trading desk/book Size  (Market value AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-24-2"
										th:field="*{tradingDeskBookSizeMarketValueAed}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Relative size (% Total Assets or % Total Trading Book)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-24-2"
										th:field="*{relativeSizePercentTotalAssetsOrPercentTotalTradingBook}" />
								</div>
								<label class="col-sm-2 col-form-label">YTD P&L (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-24-2" th:field="*{ytdPandLAed}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Maximum Loss over the period (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{maximumLossOverThePeriodAed}" />
								</div>
							</div>

							<!-- SECTION: VaR & Expected Shortfall -->
							<h4 class="section-header">Value-at-Risk/Expected Shortfall</h4>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Confidence Interval</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{confidenceInterval}" />
								</div>
								<label class="col-sm-2 col-form-label">Holding Period</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-5-0" th:field="*{holdingPeriod}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">VaR Exposure (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{varExposureAed}" />
								</div>
								<label class="col-sm-2 col-form-label">VaR Limit (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{varLimitAed}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Status</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{status}" />
								</div>
								<label class="col-sm-2 col-form-label">Expected Shortfall (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{expectedShortfallAed}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Expected Shortfall Limit (AED)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{expectedShortfallLimitAed}" />
								</div>
								<label class="col-sm-2 col-form-label">Status</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" th:field="*{status2}" />
								</div>
							</div>

							<!-- SECTION: Sensitivity Analysis -->
							<h4 class="section-header">Sensitivity Metrics</h4>
							<!-- ... Continue with the rest of the fields, grouped logically ... -->
							<!-- Example for DV01 -->
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Modified Duration</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-10-0" th:field="*{modifiedDuration}" />
								</div>
								<label class="col-sm-2 col-form-label">Interest rate shock applied (bps)</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-10-0" th:field="*{interestRateShockAppliedBps}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Limit</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  number-24-2" th:field="*{limit1}" />
								</div>
								<label class="col-sm-2 col-form-label">Status</label>
								<div class="col-sm-4">
									<input type="text" class="form-control  vchar-50" th:field="*{status3}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">DV01</label>
								<div class="col-sm-4"><input type="text" class="form-control  number-24-2" th:field="*{dv01}" />
								</div>
								<label class="col-sm-2 col-form-label"> Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control  number-24-2" th:field="*{limit2}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label"> Status</label>
								<div class="col-sm-4"><input type="text" class="form-control  vchar-50" th:field="*{status4}" />
								</div>
								<label class="col-sm-2 col-form-label">DV01 Tenor <3Yr </label>
										<div class="col-sm-4"><input type="text" class="form-control  number-24-2"
												th:field="*{dv01TenorGapsLt3Yr}" /></div>
							</div>
							<!-- Combined: DV01 Tenor >3Yr and Credit Spread CS01 -->
<div class="form-group row">
	<label class="col-sm-2 col-form-label">DV01 Tenor >3Yr</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{dv01TenorGapsGt3Yr}" />
	</div>
	<label class="col-sm-2 col-form-label">Credit Spread CS01</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{creditSpreadCs01}" />
	</div>
</div>

<!-- Credit Spread shock applied (bps) -->
<div class="form-group row">
	<label class="col-sm-2 col-form-label">Credit Spread shock applied (bps)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-10-0" th:field="*{creditSpreadShockAppliedBps}" />
	</div>
	<label class="col-sm-2 col-form-label">Limit</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{limit3}" />
	</div>
</div>

<!-- Status -->
<!-- Combined: Status and Credit Spread CS01 (Investment Grade) -->
<div class="form-group row">
	<label class="col-sm-2 col-form-label">Status</label>
	<div class="col-sm-4">
		<input type="text" class="form-control vchar-50" th:field="*{status5}" />
	</div>
	<label class="col-sm-2 col-form-label">Credit Spread CS01 (Investment Grade)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{creditSpreadCs01InvestmentGrade}" />
	</div>
</div>

<!-- Credit Spread CS01 (Sub Investment) and (Unrated) -->
<div class="form-group row">
	<label class="col-sm-2 col-form-label">Credit Spread CS01 (Sub Investment)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{creditSpreadCs01SubInvestment}" />
	</div>
	<label class="col-sm-2 col-form-label">Credit Spread CS01 (Unrated)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{creditSpreadCs01Unrated}" />
	</div>
</div>


							<!-- Sub-section: Equity -->
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Beta Equity</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{betaEquity}" /></div>
								<label class="col-sm-2 col-form-label">Equity shock applied (bps)</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{equityShockAppliedBps}" /></div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{limit4}" />
								</div>
								<label class="col-sm-2 col-form-label"> Status</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{status6}" />
								</div>
							</div>

							<!-- Sub-section: Basis Risk (BR01) -->
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">BR01</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{br01}" />
								</div>
								<label class="col-sm-2 col-form-label">Interest rate differential shock applied (bps)</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{interestRateDifferentialShockAppliedBps}" /></div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label"> Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{limit5}" />
								</div>
								<label class="col-sm-2 col-form-label"> Status</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{status7}" />
								</div>
							</div>

							<!-- Sub-section: Greeks -->
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Dollar Delta</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{dollarDelta}" /></div>
								<label class="col-sm-2 col-form-label">shock applied (bps)</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{shockAppliedBps1}" /></div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label"> Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{limit6}" />
								</div>
								<label class="col-sm-2 col-form-label"> Status</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{status8}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Dollar Gamma</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{dollarGamma}" /></div>
								<label class="col-sm-2 col-form-label">shock applied (bps)</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{shockAppliedBps2}" /></div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label"> Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{limit7}" />
								</div>
								<label class="col-sm-2 col-form-label">Status</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{status9}" />
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">Dollar Vega</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{dollarVega}" /></div>
								<label class="col-sm-2 col-form-label">shock applied (bps)</label>
								<div class="col-sm-4"><input type="text" class="form-control"
										th:field="*{shockAppliedBps3}" /></div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-form-label"> Limit</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{limit8}" />
								</div>
								<label class="col-sm-2 col-form-label"> Status</label>
								<div class="col-sm-4"><input type="text" class="form-control" th:field="*{status10}" />
								</div>
							</div>
							<!-- Implied Volatility Section -->
<div class="form-group row">
	<label class="col-sm-2 col-form-label">Implied Volatility Type</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{impliedVolatilityType}" />
	</div>
	<label class="col-sm-2 col-form-label">Dollar Theta</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{dollarTheta}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Limit</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{limit9}" />
	</div>
	<label class="col-sm-2 col-form-label">Status</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{status11}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Dollar Rho</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{dollarRho}" />
	</div>
	<label class="col-sm-2 col-form-label">Shock Applied (bps)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{shockAppliedBps4}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Limit</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{limit10}" />
	</div>
	<label class="col-sm-2 col-form-label">Status</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{status12}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Dollar Vanna</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{dollarVanna}" />
	</div>
	<label class="col-sm-2 col-form-label">Shock Applied (bps)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{shockAppliedBps5}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Limit</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{limit11}" />
	</div>
	<label class="col-sm-2 col-form-label">Status</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{status13}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Dollar Volga</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{dollarVolga}" />
	</div>
	<label class="col-sm-2 col-form-label">Shock Applied (bps)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{shockAppliedBps6}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Limit</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{limit12}" />
	</div>
	<label class="col-sm-2 col-form-label">Status</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{status14}" />
	</div>
</div>

<!-- Sub-section: SVaR Breakdown -->
<hr class="my-4">
<h5>SVaR Breakdown</h5>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Credit Spread (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{creditSpreadAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Credit Sensitive Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{creditSensitiveImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Interest Rate in the Trading Book (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{interestRateInTheTradingBookAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Rate Sensitive Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{rateSensitiveImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Foreign Exchange (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{foreignExchangeAed}" />
	</div>
	<label class="col-sm-2 col-form-label">FX Sensitive Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{fxSensitiveImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Equity (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{equityAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Equity Sensitive Relative Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{equitySensitiveRelativeImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Commodities (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{commoditiesAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Commodity Sensitive Relative Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{commoditySensitiveRelativeImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Credit Derivatives (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control" th:field="*{creditDerivativesAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Relative Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{relativeImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Jump-to-default Loss (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{jumpToDefaultLossAed}" />
	</div>
	<label class="col-sm-2 col-form-label">JTD Relative Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{jtdRelativeImpactPercent}" />
	</div>
</div>

<div class="form-group row">
	<label class="col-sm-2 col-form-label">Overall Impact (AED)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{overallImpactAed}" />
	</div>
	<label class="col-sm-2 col-form-label">Overall Relative Impact (%)</label>
	<div class="col-sm-4">
		<input type="text" class="form-control number-24-2" th:field="*{overallRelativeImpactPercent}" />
	</div>
</div>


						</div>

						<!-- Submit -->
						<div class="card-footer text-center"
							style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
							<button type="button" class="custom-tab-btn" onclick="updateform(event)">Update</button>
							<a th:href="@{/Trade_Market_Risk(formmode='list')}" class="custom-tab-btn">Cancel</a>
						</div>

					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="modal fade" id="alert">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: white;">BANK OF
						BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg"></p>
					<button type="button" class="custom-tab-btn" onclick="list()" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="alert1">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: white;">BANK OF
						BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg1"></p>
					<button type="button" class="custom-tab-btn" onclick="trade()" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Loader Modal (Using your existing loader image) -->
	<div class="modal fade" id="loader" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content" style="background: transparent; border: none;">
				<div class="modal-body text-center">
					<img th:src="@{/images/loader.gif}" style="width: 150px; height: auto;" alt="Processing...">
				</div>
			</div>
		</div>
	</div>

	<!-- Custom Alert/Result Modal (Matches your existing style) -->
	<div class="modal fade" id="resultModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<!-- Your custom styled header -->
				<div class="menu-title-header">
					<div class="modal-title" id="resultModalLabel" style="text-align: center; color: white;">
						<!-- Title will be set by JavaScript -->
					</div>
				</div>
				<div class="modal-body" style="text-align: center; font-size: 1.1rem;">
					<p id="resultModalBody"></p>
					<!-- Your custom styled button -->
					<button type="button" class="custom-tab-btn" onclick="list()" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
	$(document).ready(function () {
		$('#usertable').DataTable({
			"paging": true,
			"pageLength": 10,
			"lengthChange": false,
			"searching": true,
			"ordering": true,
			"info": true,
			"autoWidth": false,
			"language": {
				"search": "Search:"
			}
		});
	});
</script>


<!-- Include this after your DataTable initialization script -->

<style>
	/* Remove top margin/padding from DataTables parent containers */
	#data {
		padding-top: 0 !important;
		margin-top: 0 !important;
	}

	.table-responsive {
		margin-top: 0 !important;
		padding-top: 0 !important;
	}

	/* Ensure DataTables filter (search box) doesn't have spacing above it */
	div.dataTables_filter {
		margin-top: 0 !important;
		padding-top: 0 !important;
	}

	/* FIX: Make search label and box inline */
	div.dataTables_filter label {
		display: flex !important;
		align-items: center;
		gap: 8px;
		white-space: nowrap;
	}

	/* Style pagination buttons */
	.dataTables_wrapper .dataTables_paginate .paginate_button {
		background-color: white;
		border: 1px solid rgb(0, 164, 166);
		color: rgb(0, 164, 166) !important;
		padding: 5px 10px;
		margin: 2px;
		border-radius: 6px;
		transition: 0.3s;
		font-weight: 600;
	}

	.dataTables_wrapper .dataTables_paginate .paginate_button.current,
	.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
		background-color: rgb(0, 164, 166) !important;
		color: white !important;
	}

	/* Optional: Style the search input */
	.dataTables_filter input {
		border: 1px solid rgb(0, 164, 166);
		border-radius: 4px;
		padding: 4px 8px;
	}
</style>


<script>
function handleBankChange(select) {
    const selectedBank = select.value;

    if (!selectedBank) {
        // Clear the fields
        $('#bankSymbol').val('');
        $('#conventionalIslamic').val('');
        $('#localForeign').val('');
        $('#cbuaeTiering').val('');
        return;
    }

    $.ajax({
    	url: '/BCDRS/getBankDetails',
        type: 'GET',
        data: { bankName: selectedBank },
        success: function(data) {
            $('#bankSymbol').val(data.bankSymbol || '');
            $('#conventionalIslamic').val(data.conventionalIslamic || '');
            $('#localForeign').val(data.localForeign || '');
            $('#cbuaeTiering').val(data.cbuaeTiering || '');
        },
        error: function(xhr, status, error) {
            console.error('AJAX Error:', error);
          //  alert('Failed to fetch bank details.');
        }
    });
}
</script>
<script>
function handleCountryChange(select) {
    const selectedCountry = select.value;

    if (!selectedCountry) {
        $('#cbuaeGeographicalZone').val('');
        return;
    }

    $.ajax({
        url: '/BCDRS/getCountryDetails',
        type: 'GET',
        data: { countryName: selectedCountry },
        success: function(data) {
            $('#cbuaeGeographicalZone').val(data.cbuaeGeographicalZone || '');
        },
        error: function(xhr, status, error) {
            console.error('AJAX Error:', error);
            alert('Failed to fetch geographical zone.');
        }
    });
}

// Run on page load (for edit mode)
window.onload = function() {
    const countrySelect = document.getElementById("countryOfRisk");
    if (countrySelect && countrySelect.value) {
        handleCountryChange(countrySelect);
    }
};
</script>
<script>
  const fieldRules = {
    // VARCHAR2 fields
    bankName: 100,
    groupHeadOfficeSubsidiary: 50,
    subsidiary: 50,
    bankSymbol: 50,
    conventionalIslamic: 50,
    localForeign: 50,
    cbuaeTiering: 50,
    tradingBookDesks: 50,
    cbuaeInternalDeskReference:50,
    confidenceInterval:50,
    status:50,
    status2:50,
    status3:50,
    status4:50,
    status5:50,
    status6:50,
    status7:50,
    status8:50,
    status9:50,
    impliedVolatilityType:20,
    status10:50,
    status11:50,
    status12:50,
    status13:50,
    status14:50,

    // NUMBER(24,2) fields
    annualBudgetAed: "24,2",
    tradingDeskBookSizeMarketValueAed: "24,2",
    relativeSizePercentTotalAssetsOrPercentTotalTradingBook: "24,2",
    ytdPandLAed: "24,2",
    maximumLossOverThePeriodAed: "24,2",
    holdingPeriod: "24,2",
    varExposureAed: "24,2",
    varLimitAed: "24,2",
    expectedShortfallAed: "24,2",
    expectedShortfallLimitAed: "24,2",
    modifiedDuration: "24,2",
    interestRateShockAppliedBps: "24,2",
    limit1: "24,2",
    dv01: "24,2",
    limit2: "24,2",
    dv01TenorGapsLt3Yr: "24,2",
    dv01TenorGapsGt3Yr: "24,2",
    creditSpreadCs01: "24,2",
    creditSpreadShockAppliedBps: "24,2",
    limit3: "24,2",
    creditSpreadCs01InvestmentGrade: "24,2",
    creditSpreadCs01SubInvestment: "24,2",
    creditSpreadCs01Unrated: "24,2",
    betaEquity: "24,2",
    equityShockAppliedBps: "24,2",
    limit4: "24,2",
    br01: "24,2",
    interestRateDifferentialShockAppliedBps: "24,2",
    limit5: "24,2",
    dollarDelta: "24,2",
    shockAppliedBps1: "24,2",
    limit6: "24,2",
    dollarGamma: "24,2",
    shockAppliedBps2: "24,2",
    limit7: "24,2",
    dollarVega: "24,2",
    shockAppliedBps3: "24,2",
    limit8: "24,2",
    dollarTheta: "24,2",
    limit9: "24,2",
    dollarRho: "24,2",
    shockAppliedBps4: "24,2",
    limit10: "24,2",
    dollarVanna: "24,2",
    shockAppliedBps5: "24,2",
    limit11: "24,2",
    dollarVolga: "24,2",
    shockAppliedBps6: "24,2",
    limit12: "24,2",
    creditSpreadAed: "24,2",
    creditSensitiveImpactPercent: "24,2",
    interestRateInTheTradingBookAed: "24,2",
    rateSensitiveImpactPercent: "24,2",
    foreignExchangeAed: "24,2",
    fxSensitiveImpactPercent: "24,2",
    equityAed: "24,2",
    equitySensitiveRelativeImpactPercent: "24,2",
    commoditiesAed: "24,2",
    commoditySensitiveRelativeImpactPercent: "24,2",
    creditDerivativesAed: "24,2",
    relativeImpactPercent: "24,2",
    jumpToDefaultLossAed: "24,2",
    jtdRelativeImpactPercent: "24,2",
    overallImpactAed: "24,2",
    overallRelativeImpactPercent: "24,2"
    
    
  };

  function showError(input, msg) {
    let span = document.getElementById(input.id + "-error");
    if (!span) {
      span = document.createElement("small");
      span.id = input.id + "-error";
      span.className = "text-danger";
      span.style.display = "block";
      input.parentNode.appendChild(span);
    }
    span.innerText = msg;
  }

  function clearError(input) {
    const span = document.getElementById(input.id + "-error");
    if (span) span.innerText = "";
  }

  function validateInput(event) {
    const input = event.target;
    const rule = fieldRules[input.id];
    const value = input.value.trim();

    if (!rule || value === "") {
      clearError(input);
      return;
    }

    if (typeof rule === "number" || !isNaN(rule)) {
      // VARCHAR2 Validation (check character length)
      if (value.length > rule) {
        showError(input, `Max ${rule} characters allowed`);
      } else {
        clearError(input);
      }
    } else if (typeof rule === "string" && rule.includes(",")) {
      // NUMBER(p,s) validation
      const [total, decimal] = rule.split(",").map(Number);
      const regex = /^\d+(\.\d+)?$/;

      if (!regex.test(value)) {
        showError(input, `Only numeric values allowed with max ${decimal} decimals`);
        return;
      }

      const [intPart, decPart = ""] = value.split(".");
      const intLen = intPart.replace(/^0+/, "").length;
      const decLen = decPart.length;

      if (intLen + decLen > total || decLen > decimal) {
        showError(input, `Max ${total - decimal} digits before and ${decimal} after decimal`);
      } else {
        clearError(input);
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    for (const id in fieldRules) {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener("input", validateInput);

        // Add maxlength to VARCHAR2 fields only
        if (typeof fieldRules[id] === "number" || !isNaN(fieldRules[id])) {
          input.setAttribute("maxlength", fieldRules[id]);
        }
      }
    }
  });
</script>
</html>