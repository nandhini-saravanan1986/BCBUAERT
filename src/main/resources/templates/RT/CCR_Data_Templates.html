<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<!-- 
CREATED BY	: SANJEEVI S 
CREATED ON	: 25.06.2025 (Started)
PURPOSE		: CCR DATA TEMPLATES
Tested by   : Rajalakshmi
-->

<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="stylesheet" th:href="@{/css/CustomButton.css}" />
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon" />

<!-- JavaScript -->
<!-- jQuery core (required first) -->


<!-- âœ… Your manually placed jQuery validation
	<script th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
	 <script th:src="/jquery/jquery.validate.min.js"></script>
	 -->

<!-- jQuery (required first) -->
<script th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>

<!-- âœ… jQuery Validation -->
<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<!-- Bootstrap + Others -->
<script th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<script th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>
<script
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>


<style>
body {
	font-family: 'Segoe UI', Arial, sans-serif;
	font-size: 14px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	font-family: sans-serif;
}

.modal-backdrop {
	position: fixed;
	top: 0;
	left: 0;
	width: 120vw !important; /* ðŸ‘ˆ a bit wider than viewport */
	height: 120vh !important; /* ðŸ‘ˆ a bit taller than viewport */
	background-color: #000; /* ðŸ‘ˆ solid black base */
	opacity: 0.7 !important; /* ðŸ‘ˆ slightly darker overlay */
	z-index: 1062;
	/* ðŸ‘ˆ ensures it sits below modal but above everything else */
}

/* === ROLE PAGE CUSTOM HEADER === */
.role-page-header {
	background-color: #ffffff;
	padding: 15px 20px;
}

.role-page-title h4 {
	color: #003366;
	font-family: "Segoe UI", Arial, sans-serif;
	font-size: 20px;
	font-weight: 700;
	margin: 0;
}

.role-page-underline {
	width: 158px;
	height: 3px;
	background-color: #0073e6;
	border-radius: 2px;
	margin-top: 6px;
	box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6); /* soft glow below */
}

/* Add Button Styling */
/* Base Button Style */
.role-add-btn {
	background: #ffffff; /* default white background */
	color: #005fa3; /* blue text */
	border: 2px solid #005fa3;
	border-radius: 25px;
	padding: 8px 18px;
	font-size: 13px;
	font-weight: 600;
	cursor: pointer;
	box-shadow: 0 2px 5px rgba(0, 64, 128, 0.1);
	transition: all 0.3s ease;
}

/* Hover effect */
.role-add-btn:hover {
	background: linear-gradient(135deg, #005fa3, #007bff);
	color: #fff;
	transform: translateY(-2px);
	box-shadow: 0 0 10px rgba(0, 102, 204, 0.4);
}

/* Active (clicked or selected) button */
.role-add-btn.active {
	background: linear-gradient(135deg, #005fa3, #007bff);
	color: #fff;
	border: none;
	box-shadow: 0 2px 8px rgba(0, 64, 128, 0.3);
	transform: translateY(-1px);
}

/* Optional: icon spacing */
.role-add-btn i {
	margin-right: 5px;
}
</style>

<style>
:root {
	--bob-orange: #0073e6;
	--bob-blue: #004080;
	--overlay-bg: rgba(255, 255, 255, 0.9);
}

/* Full-screen overlay */
.bob-loader {
	position: fixed;
	inset: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	background: rgba(226, 232, 237, 0.6); /* lighter background */
	backdrop-filter: blur(8px); /* âœ… background blur */
	-webkit-backdrop-filter: blur(8px); /* Safari support */
	z-index: 9999;
	transition: opacity 0.25s ease, visibility 0.25s;
	opacity: 1;
	visibility: visible;
}

/* Hide when not active */
.bob-loader[aria-hidden="true"] {
	opacity: 0;
	visibility: hidden;
	pointer-events: none;
}

/* Loader card */
.bob-loader-card {
	display: flex;
	flex-direction: column;
	align-items: center;
}

/* Static logo */
.logo-imgs {
	height: 90px;
	object-fit: contain;
	display: block;
}

/* Flowing bar below logo */
.flow-bar {
	position: relative;
	width: 200px; /* âœ… increased width */
	height: 8px; /* slightly thicker for better visibility */
	background: #f1f1f1;
	border-radius: 4px;
	overflow: hidden;
	margin-top: 10px;
}

.flow-line {
	position: absolute;
	left: -40%;
	top: 0;
	width: 40%;
	height: 100%;
	background: linear-gradient(90deg, var(--bob-orange), var(--bob-blue));
	border-radius: 4px;
	animation: flowMove 1.2s linear infinite;
}

/* Animation for flowing line */
@keyframes flowMove { 0% {
	left: -40%;
}
100%
{
left
:
100%;
}
}
</style>

<script>
							function goBack() {
								document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
							    window.history.back();
							}

							function goForward() {
								document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
							    window.history.forward();
							}

							// Detect mouse near screen edges
							document.addEventListener('mousemove', function(e) {
							    const backBtn = document.getElementById('floatingBackBtn');
							    const forwardBtn = document.getElementById('floatingForwardBtn');
							    const screenWidth = window.innerWidth;

							    // Left edge (back)
							    if (e.clientX < 50) {
							        backBtn.classList.add('show');
							    } else {
							        backBtn.classList.remove('show');
							    }

							    // Right edge (forward)
							    if (screenWidth - e.clientX < 50) {
							        forwardBtn.classList.add('show');
							    } else {
							        forwardBtn.classList.remove('show');
							    }
							});
							</script>

<style>
/* Shared styles for both buttons */
#floatingBackBtn, #floatingForwardBtn {
	position: fixed;
	top: 50%;
	background-color: #F8AC46FF;
	border: none;
	color: white;
	font-size: 20px;
	border-radius: 50%;
	width: 45px;
	height: 45px;
	display: flex;
	align-items: center;
	justify-content: center;
	opacity: 0;
	pointer-events: none;
	transition: all 0.4s ease;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
	z-index: 999;
}

/* Back button */
#floatingBackBtn {
	left: -50px; /* hidden off-screen */
}

/* Forward button */
#floatingForwardBtn {
	right: -50px; /* hidden off-screen */
}

/* Show when near edge */
#floatingBackBtn.show {
	left: 20px;
	opacity: 1;
	pointer-events: auto;
}

#floatingForwardBtn.show {
	right: 20px;
	opacity: 1;
	pointer-events: auto;
}

/* Hover animation */
#floatingBackBtn:hover, #floatingForwardBtn:hover {
	background-color: #E67E00;
	transform: scale(1.1);
}
</style>


<style>
.btns {
	float: right;
	margin: 5px;
}

.col-sm-5 {
	padding-bottom: 15px;
}

.list-body {
	padding: 0px;
}

.error {
	color: red;
	padding-left: 10px;
}

.formline {
	padding-bottom: 15px;
}

.btn-primary {
	background-color: #E77400;
	border-color: #0c0c0c;
}

.btn-primary:not(:disabled):not(.disabled).active, .btn-primary:not(:disabled):not(.disabled):active,
	.show>.btn-primary.dropdown-toggle {
	color: #fff;
	background-color: #cc000000;
	border-color: #161617;
}

#finusertb {
	width: 460px;
}
</style>
<style>
	#usertable {
		min-width: 2800px;
		/* adjust based on columns */
	}

	#usertable {
		border-collapse: collapse !important;
		font-family: Arial, sans-serif !important;
		font-size: 12px !important;
	}

	/* HEADER */
	/* Update this section in your <style> tag */
	#usertable thead th {
		background-color: #7b6458;
		color: #fff;
		font-family: Arial, sans-serif !important;
		font-size: 14px !important;
		text-align: center;
		vertical-align: middle;
		white-space: normal;

		/* ADD THESE THREE LINES */
		padding: 2px 4px !important;
		/* Reduces internal spacing */
		line-height: 1.1 !important;
		/* Reduces space between wrapped text lines */
		font-size: 11px !important;
		/* Optional: slightly smaller font to save space */
		position: sticky;
		top: 0;
		/* Keeps the first row at the top */
		z-index: 10;
		background-color: #7b6458 !important;
		/* Ensures the header isn't transparent */
		color: white;
		box-shadow: inset 0 -1px 0 #dee2e6;
		/* Optional: adds a bottom border to the sticky header */
	}


	/* BODY CELLS */
	#usertable td {
		padding: 5px 6px !important;
		border: 1px solid #e8e8e8 !important;
		/* light grey lines */
		background: #fafafa;
		white-space: normal !important;
	}

	/* ROW EVEN/ODD */
	#usertable tbody tr:nth-child(even) {
		background-color: #f4f2ef !important;
	}

	#usertable tbody tr:nth-child(odd) {
		background-color: #ffffff !important;
	}
	#usertable thead tr:nth-child(2) th {
	    top: 32px; /* Adjust this value (e.g., 30px to 40px) to match the height of your first header row */
	    z-index: 9;

	/* SEARCH BOX FIX */
	.dataTables_filter label {
		display: flex !important;
		gap: 10px;
		align-items: center;
	}

	.dataTables_filter label {
		display: flex !important;
		align-items: center;
		gap: 8px;
		/* space between text and input */
		margin-bottom: 0 !important;
	}

	.dataTables_filter input {
		margin-left: 5px;
		flex: 1;
	}

	/* === ROLE PAGE CUSTOM HEADER === */
	.role-page-header {
		background-color: #ffffff;
		padding: 15px 20px;
		display: flex;
		/* Added for alignment */
		justify-content: space-between;
		/* Added for alignment */
		align-items: center;
		/* Added for alignment */
	}
</style>

<style>
	/* DataTables pagination container */
	.dataTables_wrapper .dataTables_paginate {
		display: flex;
		gap: 3px;
		margin-left: 4px !important;
	}

	.dataTables_wrapper .dataTables_paginate .paginate_button {
		box-sizing: border-box;
		display: inline-block;
		min-width: 1.5em;
		padding: 0.5em !important;
		margin-left: -8px;
		text-align: center;
		text-decoration: none !important;
		border: 1px solid transparent;
		border-radius: 2px;
	}

	.mb-2 {
		margin-bottom: -0.5rem !important;
	}

	.dataTables_wrapper .dataTables_paginate .page-link {
		outline: none !important;
		box-shadow: none !important;
	}

	/* Hover ONLY for Previous & Next */
	.dataTables_wrapper .dataTables_paginate .previous .page-link:hover,
	.dataTables_wrapper .dataTables_paginate .next .page-link:hover {
		background-color: #e9ecef !important;
		color: rgb(255, 128, 64) !important;
	}

	/* Page numbers should NOT hover */
	.dataTables_wrapper .dataTables_paginate .page-item:not(.previous):not(.next):not(.active) .page-link:hover {
		background-color: #f5f5f5 !important;
		color: #6c757d !important;
		cursor: default !important;
	}

	.dataTables_wrapper .dataTables_paginate .page-item.active .page-link {
		background-color: #ff7f27 !important;
		border-color: #ff7f27 !important;
		color: #ffffff !important;
		cursor: default !important;
	}
</style>
<style>
	.role-btn {
		background: #ffffff;
		/* default white */
		color: #E67E00;
		/* default orange text */
		border: 1px solid #E67E00;
		border-radius: 25px;
		padding: 8px 18px;
		font-size: 13px;
		font-weight: 600;
		cursor: pointer;
		box-shadow: 0 1px 3px rgba(230, 126, 0, 0.15);
		transition: all 0.3s ease;
	}

	/* Hover effect â†’ pastel orange */
	.role-btn:hover {
		background: #FFF3D1;
		/* pastel orange (same as submenu hover) */
		color: #E67E00;
		/* orange text */
		transform: translateY(-2px);
		box-shadow: 0 0 8px rgba(230, 126, 0, 0.4);
	}

	/* Active (selected tab) */
	.role-btn.active {
		background: #E67E00;
		/* solid orange */
		color: #fff;
		/* white text */
		border-color: #E67E00;
		transform: translateY(-1px);
		box-shadow: 0 1px 8px rgba(230, 126, 0, 0.3);
	}

	/* Optional: icon spacing */
	.role-btn i {
		margin-right: 5px;
	}
</style>
<style>
	#pageHeader {
		position: sticky;
		top: 110px;
		z-index: 1050;
		background: white;
		padding-top: 10px;
	}

	#tabHeader {
		position: sticky;
		top: 5px;
		/* just below page header */
		z-index: 1040;
		background: white;
		padding: 5px 0;
	}

	#mainHeader {
		position: sticky;
		top: 0;
		z-index: 9999;
		background: white;
	}
</style>


<style>
.card {
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
	border-radius: 8px;
}

.card-header h5 {
	font-size: 22px;
	color: #fff;
	font-weight: 600;
}

.nav-tabs .nav-link {
	font-weight: 500;
	border: 1px solid #dee2e6;
	border-bottom: none;
	border-radius: 4px 4px 0 0;
	background-color: #f1f1f1;
	margin-right: 5px;
}

.nav-tabs .nav-link.active {
	background-color: #ffffff;
	border-color: #dee2e6 #dee2e6 #ffffff;
}

.table-responsive {
	border: 1px solid #dee2e6;
	border-radius: 4px;
}

.table-hover tbody tr:hover {
	background-color: #f3f6f9;
}

thead th {
	position: sticky;
	top: 0;
	background-color: #e9ecf0;
	z-index: 1;
}

.card-footer {
	padding: 10px;
	border-top: 1px solid #ccc;
}

.btn-xs {
	padding: 4px 12px;
	font-size: 14px;
	border-radius: 4px;
}

/* #usertable th,
		#usertable td {
			vertical-align: middle;
			text-align: left;
			font-size: 17px;
			font-family: Verdana, sans-serif;
		} */
.fa-edit:hover {
	color: #28a745;
	transform: scale(1.1);
}

td {
	border: 1px solid rgb(0, 164, 166);
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
}
</style>


<style>
.form-group {
	position: relative;
	margin-bottom: 1.5rem;
}

.form-control {
	width: 100%;
	border: 2px solid #ccc;
	border-radius: 8px;
	font-size: 1rem;
	outline: none;
	background: transparent;
	transition: border-color 0.3s ease, padding-top 0.3s ease;
}

.error {
	color: red;
	padding-top: 15px;
}

.form-control:focus {
	border-color: #007bff;
}

.form-legend {
	position: absolute;
	top: 50%;
	left: 15px;
	transform: translateY(-50%);
	font-size: 1rem;
	color: #aaa;
	background: white;
	padding: 0 5px;
	pointer-events: none;
	transition: 0.3s ease;
}

/* When input or select is focused or has a value, move the label up */
.form-control:focus ~.form-legend, .form-control:not(:placeholder-shown)
	~.form-legend {
	top: -8px;
	font-size: 1rem;
	color: #007bff;
}

/* Hover effect when the input/select is focused */
.form-control:focus:hover ~.form-legend {
	color: #0056b3;
	/* Darker shade of blue on hover */
}

/* Ensure the label returns to the normal color after focus or hover is removed */
.form-control:not(:focus) ~.form-legend {
	color: #aaa;
	/* Normal label color */
}
</style>

<style>
/* Red border for invalid inputs */
input.error, select.error {
	border: 2px solid red !important;
}

/* Error message style */
label.error {
	color: red;
	font-size: 0.85em;
	margin-top: 5px;
	display: block;
}
</style>
<script>
		$(document).ready(function () {
			$("#nostroForm").validate({
				errorClass: "error", // use 'error' class for styling
				errorElement: "label", // wrap error messages in <label>

				// Place the error after the input field
				errorPlacement: function (error, element) {
					if (element.parent('.form-group').length) {
						error.insertAfter(element); // default
					} else {
						error.insertAfter(element);
					}
				},

				// Highlight and unhighlight fields
				highlight: function (element) {
					$(element).addClass("error");
				},
				unhighlight: function (element) {
					$(element).removeClass("error");
				},

				// On successful validation, run this
				submitHandler: function (form) {
					submitForm(); // your custom submit function
				}
			});
		});
	</script>

<script>

		function submitForm() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");

			const reportName = 'CBUAE_CCR_Data_Template';
			const submitUrl = './createDataControl?report_name=' + encodeURIComponent(reportName);
			const formData = $("#nostroForm").serialize();

			$.ajax({
				url: submitUrl,
				type: "POST",
				data: formData,
				success: function (response) {
					document.getElementById("bob-loader").setAttribute("aria-hidden", "true");

					$("#alertmsg1").text(response);
					$("#alert1").modal("toggle");
					//location.href = 'Nostro_Account_Bal';
				},
				error: function (xhr, status, error) {
					document.getElementById("bob-loader").setAttribute("aria-hidden", "true");

					console.error("Error:", error);
					alert("Error occurred: " + error);
				}
			});
		}


	</script>

<script th:inline="javascript">


		function home() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			location.href = 'Dashboard'
		}

		function back() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");

			window.history.back();
		}

		function list() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			location.href = 'CCR_Data_Templates?formmode=list';
		}

		function nostro() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			location.href = 'CCR_Data_Templates';
		}
		$(document).ready(function () {
			// On modal close, redirect to your controller method path
			$('#alert').on('hidden.bs.modal', function () {
				window.location.href = './CCR_Data_Templates';
			});
		});

		function updateform(event) {
			event.preventDefault();
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");

			$.ajax({
				url: `./updateCCRData`,
				type: 'POST',
				data: $('#repoData').serialize(),
				success: function (response) {
					document.getElementById("bob-loader").setAttribute("aria-hidden", "true");


					$("#alertmsg").text(response);
					$("#alert1").modal("toggle");

				},
				error: function (xhr, status, error) {
					console.error("Error in modify:", error);
					document.getElementById("bob-loader").setAttribute("aria-hidden", "true");

					alert("Failed to modify. Please try again.");
				}
			});

		}

	</script>

</head>


<script>
	function navigateToTab(tabId) {
		document.getElementById("bob-loader").setAttribute("aria-hidden", "false");

	    let url = '';
	    if (tabId === 'data') {
	        url = 'CCR_Data_Templates?formmode=list';
	    } else if (tabId === 'datacontrols') {
	        url = 'CCR_Data_Templates?formmode=add';
	    } else if (tabId === 'template') {
	        url = 'CCR_Data_Templates?formmode=add&tab=template';  // âœ… Correct
	    }

	    window.location.href = url;
	}






	function handleClick(tabId) {
		// Remove active class from all buttons
		document.querySelectorAll('.role-add-btn').forEach(btn => btn.classList.remove('active'));
		document.getElementById(tabId + '-btn').classList.add('active');

		// Hide all panes
		document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('show', 'active'));
		document.getElementById(tabId).classList.add('show', 'active');
	}

	// On page load, detect formmode and show corresponding tab
	window.addEventListener('DOMContentLoaded', function () {
	    const params = new URLSearchParams(window.location.search);
	    const formmode = params.get('formmode');
	    const tab = params.get('tab');

	    if (tab === 'template') {
	        handleClick('template');
	    } else if (formmode === 'list') {
	        handleClick('data');
	    } else {
	        handleClick('datacontrols');
	    }
	});

</script>




<script>
	function downloadCCRData() {
		document.getElementById("bob-loader").setAttribute("aria-hidden", "false");

		$.ajax({
			url: './downloadCCRDataExcel',
			type: 'GET',
			xhrFields: {
				responseType: 'blob'
			},
			success: function (data, textStatus, jqXHR) {
				document.getElementById("bob-loader").setAttribute("aria-hidden", "true");

				if (jqXHR.status === 204 || !data || data.size < 100) {
					showResultModal('Information', 'No data was available to create a download.');
					return;
				}

				const blob = new Blob([data], {type: 'application/vnd.ms-excel'});

				const url = window.URL.createObjectURL(blob);

				const a = document.createElement('a');
				a.style.display = 'none';
				a.href = url;
				a.download = 'CBUAE_CCR_Data_Template.xls';
				document.body.appendChild(a);

				a.click();

				window.URL.revokeObjectURL(url);
				document.body.removeChild(a);

				showResultModal('Success', 'The file CBUAE_CCR_Data_Template has been downloaded successfully.');
			},
			error: function (jqXHR, textStatus, errorThrown) {
				document.getElementById("bob-loader").setAttribute("aria-hidden", "true");
				console.error("Download failed:", textStatus, errorThrown);
				showResultModal('Error', 'An error occurred while downloading the file. Please check server logs and try again.');
			}
		});
	}

	function showResultModal(title, message) {
		$('#resultModalLabel').text(title);
		$('#resultModalBody').text(message);
		$('#resultModal').modal('show');
	}
</script>

<title>RiskInsights</title>

<body>
	<div class="container-fluid"
		style="padding-left: 0px; padding-right: 0px;">
		<!-- 	<div class="row"> -->

			<div id="mainHeader" th:insert="XBRLHeaderMenu :: header"></div>

				<div id="pageHeader" class="role-page-header d-flex justify-content-between align-items-center w-100"
			th:if="${formmode == 'list' or formmode == 'add' or formmode =='null' or formmode !='edit' }">
			<div class="float-left">
				<h4>CCR DATA TEMPLATE</h4>
			</div>
			<div
							class="role-page-header d-flex justify-content-between align-items-center">
							<div class="float-left">
								<button class=role-btn id="datacontrols-btn"
									onclick="navigateToTab('datacontrols')">Data Controls</button>
								<!--<button class="custom-tab-btn" id="template-btn" onclick="navigateToTab('template')">Template
									Instructions</button>-->

								<button class="role-btn" id="template-btn"
									onclick="navigateToTab('template')">Template Instructions</button>


								<button class="role-btn" id="data-btn"
									onclick="navigateToTab('data')">Data</button>

							</div>
							<div class="float-right">
								<button th:if="${formmode} =='list'" type="button"
									class="role-btn" onclick="downloadCCRData();">
									<i class="fa fa-download"></i> Download
								</button>
							</div>
						</div>
		</div>
		<!-- -------------------User List Starts----------------------------------------------------- -->
		<div style="padding-right: 10px; padding-left: 20px;"
			th:if="${formmode == 'list' or formmode == 'add' or formmode =='null' or formmode !='edit' }">

			<!-- Tabs -->
			<div class="tab-content" id="myTabContent" style="margin-top: 15px;">
				<!--<div class="tab-pane fade show active" id="datacontrols" role="tabpanel">-->


				<div class="tab-pane fade show active" id="datacontrols"
					role="tabpanel"
					th:if="${formmode == 'add' and (tab == null or tab == 'datacontrols')}">

					<div class="row">
						<div class="col-sm-12 finuserapply">
							<form id="nostroForm" method="post" autocomplete="off">
								<div class="card-body">


									<input autocomplete="false" name="hidden" type="text"
										style="display: none;">
									<div class="form-group" style="border: none">
										<div class="row formline">
											<div class="col-sm-1"></div>
											<div class="form-group col-md-2">
												<select id="submittingInstitution"
													name="submittingInstitution" class="form-control" required>
													<option value="">-- Select Institution --</option>
													<option value="Bank of Baroda">Bank of Baroda</option>
												</select> <label for="submittingInstitution" class="form-legend">Submitting
													Institution</label>
											</div>


											<div class="col-sm-1"></div>

											<div class="form-group col-md-2">
												<input type="date" id="portfolioDate" name="portfolioDate"
													class="form-control" placeholder=" " required /> <label
													for="portfolioDate" class="form-legend">Portfolio
													date</label>
											</div>
										</div>

										<!-- Contact Employee 1 Name / Title -->
										<!-- Contact Employee 1 Group -->
										<div class="form-group"
											style="border: 1px solid #e0e0e0; padding: 1px; margin-bottom: 6px; border-radius: 5px;">
											<div class="row formline">
												<div class="col-sm-12">
													<label style="font-weight: bold; color: #0D0D0C;">Contact
														Details(Employee 1)</label>
												</div>
											</div>
											<div class="row formline">
												<div class="col-sm-2"></div>
												<div class="form-group col-md-3">
													<input type="text" id="contactEmployee1Name1"
														name="contactEmployee1Name1" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee1Name1" class="form-legend">Name</label>
												</div>


												<div class="form-group col-md-3">
													<input type="text" id="contactEmployee1Title1"
														name="contactEmployee1Title1" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee1Title1" class="form-legend">Title</label>
												</div>



												<div class="form-group col-md-3">
													<input type="email" id="contactEmployee1Email1"
														name="contactEmployee1Email1" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee1Email1" class="form-legend">Email</label>
												</div>
												<div class="col-sm-3"></div>

											</div>
										</div>
										<div class="form-group"
											style="border: 1px solid #e0e0e0; padding: 1px; margin-bottom: 6px; border-radius: 5px;">
											<div class="row formline">
												<div class="col-sm-12">
													<label style="font-weight: bold; color: #0D0D0C;">Contact
														Details(Employee 2)</label>
												</div>
											</div>
											<div class="row formline">
												<div class="col-sm-2"></div>
												<div class="form-group col-md-3">
													<input type="text" id="contactEmployee2Name2"
														name="contactEmployee2Name2" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee2Name2" class="form-legend">Name</label>
												</div>


												<div class="form-group col-md-3">
													<input type="text" id="contactEmployee2Title2"
														name="contactEmployee2Title2" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee2Title2" class="form-legend">Title</label>
												</div>



												<div class="form-group col-md-3">
													<input type="email" id="contactEmployee2Email2"
														name="contactEmployee2Email2" class="form-control"
														placeholder=" " required /> <label
														for="contactEmployee2Email2" class="form-legend">Email</label>
												</div>
												<div class="col-sm-3"></div>

											</div>
											<!-- Contact Employee 2 Group -->
										</div>
										<div class="form-group"
											style="border: 1px solid #e0e0e0; padding: 1px; margin-bottom: 6px; border-radius: 5px;">
											<div class="row formline">
												<div class="col-sm-12">
													<label style="font-weight: bold; color: #0D0D0C;">Sign
														Off</label>
												</div>
											</div>

											<!-- Sign-off CRO Name / Email -->
											<div class="row formline">
												<div class="col-sm-2"></div>
												<div class="form-group col-md-3">
													<input type="text" id="signOffCroName"
														name="signOffCroName" class="form-control" placeholder=" "
														required /> <label for="signOffCroName"
														class="form-legend">CRO Name</label>
												</div>
												<div class="form-group col-md-3">
													<input type="email" id="signOffCroEmail"
														name="signOffCroEmail" class="form-control"
														placeholder=" " required /> <label for="signOffCroEmail"
														class="form-legend">CRO Email</label>
												</div>
												<div class="form-group col-md-3">
															<input type="text" id="signOffCfoName"
															name="signOffCfoName" class="form-control" placeholder=" "
															required /> <label for="signOffCfoName"
														class="form-legend">CFO Name</label>
													</div>
											</div>

											<!-- Sign-off CFO Name / Email -->
										
											<!-- Sign-off Head of Treasury Name / Email -->
											<div class="row formline">
												<div class="col-sm-2"></div>
												<div class="form-group col-md-3">
													<input type="email" id="signOffCfoEmail"
														name="signOffCfoEmail" class="form-control"
														placeholder=" " required /> <label for="signOffCfoEmail"
														class="form-legend">CFO Email</label>
														</div>
												<div class="form-group col-md-3">
													<input type="text" id="signOffHeadOfTreasuryName"
														name="signOffHeadOfTreasuryName" class="form-control"
														placeholder=" " required /> <label
														for="signOffHeadOfTreasuryName" class="form-legend">Head
														of Treasury Name</label>
												</div>
												<div class="form-group col-md-3">
													<input type="email" id="signOffHeadOfTreasuryEmail"
														name="signOffHeadOfTreasuryEmail" class="form-control"
														placeholder=" " required /> <label
														for="signOffHeadOfTreasuryEmail" class="form-legend">Head
														of Treasury Email</label>
												</div>
											</div>
										</div>

									</div>
							</form>
						
					<div class="card-footer text-center"
						style="padding-bottom: 18px;">
						<!-- <button type="button" class="custom-tab-btn" onclick="home();">
								<i class="fa fa-home"></i> Home
							</button> -->


						<button th:if="${formmode == 'null' or formmode == 'add'}"
							type="button" class="role-btn" onclick="submitForm()">Save</button>


						<!-- <button type="button" class="custom-tab-btn" onclick="back();">
								<i class="fa fa-arrow-left"></i> Back
							</button> -->
							</div>
					</div>

					</div>
				</div>
			</div>

			<!-- --------------------------------------DATA CONTROL ENDS--------------------------------------------- -->

			<!-- --------------------------------------TEMPLATE STARTS--------------------------------------------- -->
			<!--	<div class="tab-pane fade" id="template" role="tabpanel"
					th:if="${formmode == null or formmode == 'add'}">-->

			<div class="tab-pane fade show active" id="template" role="tabpanel"
				th:if="${formmode == 'add' and tab != null and tab == 'template'}">


				<p>Templates tabs</p>


				<div class="card-footer text-center"
					style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
					<!-- <button type="button" class="custom-tab-btn" onclick="home();">
							<i class="fa fa-home"></i> Home
						</button> -->

					<!--<button type="button" class="custom-tab-btn" onclick="submitForm()">
							Save
						</button>-->

					<!-- <button type="button" class="custom-tab-btn" onclick="back();">
							<i class="fa fa-arrow-left"></i> Back
						</button> -->
				</div>
			</div>

			<!-- --------------------------------------TEMPLATE ENDS--------------------------------------------- -->



			<!-- -----------------------------------DATA LIST STARTS -------------------------------------------- -->
			<div class="tab-pane fade" id="data" role="tabpanel">
				<!-- Move your existing table content here -->

				<!-- 	<div class="row">
				<div class="col-sm-12">
					<div class="container-fluid">
   -->
				<div class="table-responsive"
					style="max-height: 400px; overflow: auto; border: none;">
					<table id="usertable"
						class="table table-bordered table-striped table-hover"
						style="min-width: 2000px;">
						<thead class="thead-light">
							<tr>
								<th rowspan="1" style="text-align: center;"></th>
								<th colspan="8" style="text-align: center;">Financial
									Institution Information</th>
								<th colspan="22" style="text-align: center;">Counterparty
									Information</th>
								<th colspan="1" style="text-align: center;">Exposure</th>
							</tr>
							<tr>
								<th style="text-align: center;width: 100px;">Action</th>

								<th>Data Date</th>
								<th>Bank Name</th>
								<th>Head Office/Subsidiary</th>
								<th>Subsidiary</th>
								<th>Bank Symbol</th>
								<th>Conventional/Islamic</th>
								<th>Local Foreign</th>
								<th>CBUAE Tiering</th>
								<th>Counterparty Name</th>
								<th>Internal Counterparty Reference</th>
								<th>Internal Counterparty Rating</th>
								<th>Final Rating CBUAE</th>
								<th>Country of Risk</th>
								<th>CBUAE Geographical Zone</th>
								<th>Counterparty Type</th>
								<th>Sector</th>
								<th>PFE@95% (AED equivalent)</th>
								<th>Expected Positive Exposure (AED equivalent)</th>
								<th>Expected Negative Exposure (AED equivalent)</th>
								<th>CSA</th>
								<th>Collateral Type</th>
								<th>Threshold</th>
								<th>Minimum Transfer Amount (MTA)</th>
								<th>Independent Amount (IA)</th>
								<th>Margin Call Frequency</th>
								<th>Net Collateral Outstanding (AED equivalent)</th>
								<th>CVA (AED equivalent)</th>
								<th>DVA (AED equivalent)</th>
								<th>Bilateral CVA (AED equivalent)</th>
								<th>FVA (AED equivalent)</th>
								<th>Incremental PFE</th>

							</tr>
						</thead>
						<tbody>
							<tr th:each="data : ${repoList1}">
								<td style="text-align: center;min-width: 100px;"><a
									th:href="@{'/CCR_Data_Templates?formmode=edit&siNo=' + ${data.siNo}}">
										<i class="fa fa-edit" style="color: #ff7f27;"></i>
								</a></td>
								<td
									th:text="${#dates.format(data.transactionDate, 'dd-MM-yyyy')}"></td>
								<td th:text="${data.bankName}"></td>
								<td th:text="${data.headOfficeSubsidiary}"></td>
								<td th:text="${data.subsidiary}"></td>
								<td th:text="${data.bankSymbol}"></td>
								<td th:text="${data.conventionalIslamic}"></td>
								<td th:text="${data.localForeign}"></td>
								<td th:text="${data.cbuaeTiering}"></td>
								<td th:text="${data.counterpartyName}"></td>
								<td th:text="${data.internalCounterpartyRef}"></td>
								<td th:text="${data.internalCounterpartyRating}"></td>
								<td th:text="${data.finalRatingCbuae}"></td>
								<td th:text="${data.countryOfRisk}"></td>
								<td th:text="${data.cbuaeGeographicalZone}"></td>
								<td th:text="${data.counterpartyType}"></td>
								<td th:text="${data.sector}"></td>

								<!-- Decimal Format for Amount Fields -->
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.pfe95Aed, 1, 'COMMA', 2, 'POINT')}"></td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.expectedPositiveExposureAed, 1, 'COMMA', 2, 'POINT')}">
								</td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.expectedNegativeExposureAed, 1, 'COMMA', 2, 'POINT')}">
								</td>

								<td th:text="${data.csa}"></td>
								<td th:text="${data.collateralType}"></td>

								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.threshold, 1, 'COMMA', 2, 'POINT')}">
								</td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.minimumTransferAmountAed, 1, 'COMMA', 2, 'POINT')}">
								</td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.independentAmountAed, 1, 'COMMA', 2, 'POINT')}">
								</td>

								<td th:text="${data.marginCallFrequency}"></td>

								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.netCollateralOutstandingAed, 1, 'COMMA', 2, 'POINT')}">
								</td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.cvaAed, 1, 'COMMA', 2, 'POINT')}"></td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.dvaAed, 1, 'COMMA', 2, 'POINT')}"></td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.bilateralCvaAed, 1, 'COMMA', 2, 'POINT')}">
								</td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.fvaAed, 1, 'COMMA', 2, 'POINT')}"></td>
								<td style="text-align: right;"
									th:text="${#numbers.formatDecimal(data.incrementalPfe, 1, 'COMMA', 2, 'POINT')}">
								</td>
							</tr>
						</tbody>

					</table>

				</div>


				<div class="card-footer text-center"
					style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
					<!-- <button type="button" class="custom-tab-btn" onclick="home();">
							<i class="fa fa-home"></i> Home
						</button> -->


					<button th:if="${formmode == 'null' or formmode == 'add'}"
						type="button" class="role-btn" onclick="submitForm()">Save</button>


					<!-- <button type="button" class="custom-tab-btn" onclick="back();">
							<i class="fa fa-arrow-left"></i> Back
						</button> -->

				</div>

			</div>



		</div>

		<!------------------ edit starts-------------------------------------------------------------->

		<div th:if="${formmode}=='edit'"  class="ccr-edit-page"  style="align-items: center">
			<form th:action="@{/BCDRS/updateCCRData}" th:object="${repoData}"
				method="post" id="repoData">
				<div class="card" style="margin-left: 15px; margin-right: 15px;">
					<div
						class="role-page-header d-flex justify-content-between align-items-center">
						<div>
							<h4>CCR Data Templates - Edit</h4>

						</div>
					</div>


					<div class="card-body" style="max-height: 500px; overflow-y: auto;">
						<input type="hidden" name="siNo" th:field="*{siNo}" />
						<div>
							<h4 style="padding-bottom:10px">Financial Institution Information</h4>
						</div>
						<div class="form-group row">
							<label class="col-sm-2 col-form-label">Data Date</label>
							<div class="col-sm-4">

								<input type="date" class="form-control"
									th:field="*{transactionDate}" readonly required />

							</div>
							<label class="col-sm-2 col-form-label">Bank Name</label>
							<div class="col-sm-4">
								<select class="form-control" th:field="*{bankName}"
									onchange="handleBankChange(this)">
									<option value="">-- Select Bank --</option>
									<option th:each="bank : ${bankList}"
										th:value="${bank.bankName}" th:text="${bank.bankName}"></option>
								</select>
							</div>
						</div>

						<div class="form-group row">
							<label class="col-sm-2 col-form-label">Head
								Office/Subsidiary</label>
							<div class="col-sm-4">
								<select class="form-control" th:field="*{headOfficeSubsidiary}">
									<option value="">-- Select --</option>
									<option value="Head Office">Head Office</option>
									<option value="Subsidiary">Subsidiary</option>
								</select>
							</div>

							<label class="col-sm-2 col-form-label">Subsidiary</label>
							<div class="col-sm-4">
								<input type="text" class="form-control vchar-50"
									th:field="*{subsidiary}" id="subsidiary" />
							</div>
						</div>

						<div class="form-group row">
							<label class="col-sm-2 col-form-label">Bank Symbol</label>
							<div class="col-sm-4">
								<input type="text" class="form-control" th:field="*{bankSymbol}"
									id="bankSymbol" readonly />
							</div>

							<label class="col-sm-2 col-form-label">Conventional/Islamic</label>
							<div class="col-sm-4">
								<input type="text" class="form-control"
									th:field="*{conventionalIslamic}" id="conventionalIslamic"
									readonly />
							</div>
						</div>

						<div class="form-group row">
							<label class="col-sm-2 col-form-label">Local Foreign</label>
							<div class="col-sm-4">
								<input type="text" class="form-control"
									th:field="*{localForeign}" id="localForeign" readonly />
							</div>

							<label class="col-sm-2 col-form-label">CBUAE Tiering</label>
							<div class="col-sm-4">
								<input type="text" class="form-control"
									th:field="*{cbuaeTiering}" id="cbuaeTiering" readonly />

							</div>
						</div>
						<div>
							<h4 style="padding-bottom:10px">Counterparty Information</h4>
						</div>

						<div class="form-group row">

							<label class="col-sm-2 col-form-label"> Counterparty Name</label>
							<div class="col-sm-4">
								<input type="text" class="form-control vchar-50"
									th:field="*{counterpartyName}" id="counterpartyName" />
							</div>
							<label class="col-sm-2 col-form-label"> Internal
								Counterparty Ref</label>
							<div class="col-sm-4">
								<input type="text" class="form-control vchar-50"
									th:field="*{internalCounterpartyRef}"
									id="internalCounterpartyRef" />
							</div>
						</div>
						<div class="form-group row">


							<label class="col-sm-2 col-form-label"> Internal
								Counterparty Rating</label>
							<div class="col-sm-4">
								<input type="text" class="form-control vchar-50"
									th:field="*{internalCounterpartyRating}"
									id="internalCounterpartyRating" />
							</div>
							<label class="col-sm-2 col-form-label">Final Rating CBUAE</label>
							<div class="col-sm-4">
								<input type="text" class="form-control vchar-50"
									th:field="*{finalRatingCbuae}" id="finalRatingCbuae" />
							</div>

						</div>
						<div class="form-group row">

							<label class="col-sm-2 col-form-label">Country Of Risk</label>
							<div class="col-sm-4">
								<select class="form-control" th:field="*{countryOfRisk}"
									onchange="handleCountryChange(this)">
									<option value="">-- Select Country --</option>
									<option th:each="c : ${countryList}"
										th:value="${c.countryOfRisk}" th:text="${c.countryOfRisk}"></option>
								</select>
							</div>

							<label class="col-sm-2 col-form-label">CBUAE Geo Zone</label>
							<div class="col-sm-4">
								<input type="text" class="form-control"
									th:field="*{cbuaeGeographicalZone}" id="cbuaeGeographicalZone"
									readonly />
							</div>
						</div>

						<!-- Country of Risk -->
						<div class="form-group row">
							<label class="col-sm-2 col-form-label">Counter Party Type</label>
							<div class="col-sm-4">

								<select class="form-control" th:field="*{counterpartyType}"
									id="counterpartyType">
									<option value="" disabled selected>-- Select --</option>
									<option value="Corporate">Corporate</option>
									<option value="FI">FI</option>
									<option value="NBFI">NBFI</option>
									<option value="PSE Commercial">PSE Commercial</option>
									<option value="Retail">Retail</option>
									<option value="SME">SME</option>
									<option value="Sovereign">Sovereign</option>
									<option value="Other">Other</option>
									<option value="Multilateral Development Banks">Multilateral
										Development Banks</option>
								</select>
							</div>

							<label class="col-sm-2 col-form-label">Sector</label>
							<div class="col-sm-4">

								<select class="form-control" th:field="*{sector}" id="sector">
									<option value="" disabled selected>-- Select --</option>
									<option value="Communication Services">Communication
										Services</option>
									<option value="Consumer Discretionary">Consumer
										Discretionary</option>
									<option value="Consumer Staples">Consumer Staples</option>
									<option value="Energy">Energy</option>
									<option value="Financials">Financials</option>
									<option value="Health Care">Health Care</option>
									<option value="Industrials">Industrials</option>
									<option value="Information Technology">Information
										Technology</option>
									<option value="Materials">Materials</option>
									<option value="Real Estate">Real Estate</option>
									<option value="Utilities">Utilities</option>
									<option value="Other">Other</option>
								</select>

							</div>
						</div>
						<div class="form-group row">

							<label class="col-sm-2 col-form-label">PFE 95 AED</label>
							<div class="col-sm-4">
								<input type="text" class="form-control  number-24-2"
									th:field="*{pfe95Aed}" id="pfe95Aed" />
							</div>


							<label class="col-sm-2 col-form-label">Expected Positive
								Exposure AED</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{expectedPositiveExposureAed}"
									id="expectedPositiveExposureAed" />
							</div>

						</div>
						<div class="form-group row">

							<label class="col-sm-2 col-form-label">Expected Negative
								Exposure AED</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{expectedNegativeExposureAed}"
									id="expectedNegativeExposureAed" />
							</div>


							<label class="col-sm-2 col-form-label">CSA</label>
							<div class="col-sm-4">

								<select class="form-control" th:field="*{csa}">
									<option value="" disabled selected>-- Select --</option>
									<option value="Y">Y</option>

								</select>

							</div>

						</div>
						<div class="form-group row">

							<!-- Collateral Type -->
							<label class="col-sm-2 col-form-label">Collateral Type</label>
							<div class="col-sm-4">
								<select class="form-control" th:field="*{collateralType}"
									id="collateralType">
									<option value="" disabled selected>-- Select --</option>
									<option value="Cash">Cash</option>
									<option value="Security">Security</option>

								</select>
							</div>

							<!-- Threshold -->
							<label class="col-sm-2 col-form-label">Threshold</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{threshold}" id="threshold" />
							</div>

						</div>

						<div class="form-group row">

							<!-- Minimum Transfer Amount AED -->
							<label class="col-sm-2 col-form-label">Minimum Transfer
								Amount (AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{minimumTransferAmountAed}"
									id="minimumTransferAmountAed" />
							</div>

							<!-- Independent Amount AED -->
							<label class="col-sm-2 col-form-label">Independent Amount
								(AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{independentAmountAed}" id="independentAmountAed" />
							</div>

						</div>

						<div class="form-group row">

							<!-- Margin Call Frequency -->
							<label class="col-sm-2 col-form-label">Margin Call
								Frequency</label>
							<div class="col-sm-4">

								<select class="form-control" th:field="*{marginCallFrequency}"
									id="marginCallFrequency">
									<option value="" disabled selected>-- Select --</option>
									<option value="Daily">Daily</option>
									<option value="Weekly">Weekly</option>
									<option value="Monthly">Monthly</option>
									<option value="Quarterly">Quarterly</option>

								</select>

							</div>

							<!-- Net Collateral Outstanding AED -->
							<label class="col-sm-2 col-form-label">Net Collateral
								Outstanding (AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{netCollateralOutstandingAed}"
									id="netCollateralOutstandingAed" />

							</div>

						</div>

						<div class="form-group row">

							<!-- CVA AED -->
							<label class="col-sm-2 col-form-label">CVA (AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{cvaAed}" id="cvaAed" />
							</div>

							<!-- DVA AED -->
							<label class="col-sm-2 col-form-label">DVA (AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{dvaAed}" id="dvaAed" />
							</div>

						</div>

						<div class="form-group row">

							<!-- Bilateral CVA AED -->
							<label class="col-sm-2 col-form-label">Bilateral CVA
								(AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{bilateralCvaAed}" id="bilateralCvaAed" />
							</div>

							<!-- FVA AED -->
							<label class="col-sm-2 col-form-label">FVA (AED)</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{fvaAed}" id="fvaAed" />
							</div>

						</div>
						<div>
						<h4 style="padding-bottom:10px">Exposure</h4>
						</div>
						<div class="form-group row">

							<!-- Incremental PFE -->
							<label class="col-sm-2 col-form-label">Incremental PFE</label>
							<div class="col-sm-4">
								<input type="text" class="form-control number-24-2"
									th:field="*{incrementalPfe}" id="incrementalPfe" />
							</div>

						</div>

						<!-- End card-body -->
						<!-- âœ… Footer section -->
						<div class="card-footer text-center">
							<button type="submit" class="role-btn"
								onclick="updateform(event)">Update</button>
							<a th:href="@{/CCR_Data_Templates (formmode='list')}"
								class="role-btn" style="text-decoration: none;">Cancel</a>
							<!--<a th:href="@{/home}" class="custom-tab-btn">Home</a>-->
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>



	<div class="modal fade" id="datadelete">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-body"
					style="margin-top: 8px; text-align: center; color: #f15362;">
					<button type="button" class="close" data-dismiss="modal">Ã—</button>
					Are you Sure want to delete?
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="submitformdelete(this);" th:attr="data-formmode=delete">Submit</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Floating Back Button -->
	<button id="floatingBackBtn" onclick="goBack()" title="Go Back">
		<i class="fa fa-arrow-left"></i>
	</button>
	<!-- Floating Forward Button -->
	<button id="floatingForwardBtn" onclick="goForward()"
		title="Go Forward">
		<i class="fa fa-arrow-right"></i>
	</button>
	<div class="modal fade" id="formmsg">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-body"
					style="margin-top: 8px; text-align: center; color: aliceblue;">
					<button type="button" class="close" data-dismiss="modal">Ã—</button>
					<a th:value="${msg}"></a>
				</div>
				<div class="modal-footer"
					style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); padding: 10px; border-top: 2px solid #ccc;">
					<button type="button" class="btn btn-primary"
						onclick="submitformdelete(this);" th:attr="data-formmode=delete">Submit</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="alert">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel"
						style="text-align: center; color: white;">BANK OF BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg"></p>
					<!--<button type="button" class="custom-tab-btn" onclick="list()"
							data-dismiss="modal">Close</button>-->

					<button type="button" class="role-btn"
						onclick="closeAlertAndRedirect()">Close</button>

				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="alert1">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" style="text-align: center; color: white;">BANK
						OF BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg">Update successful!</p>
					<!--<button type="button" class="role-btn" onclick="closeModalAndGoToDataTab()">Close</button>-->
					<a th:href="@{/CCR_Data_Templates(formmode='list')}"
						class="role-btn" style="text-decoration: none;">Close</a>
				</div>
			</div>
		</div>
	</div>
	<div id="bob-loader" class="bob-loader" aria-hidden="true"
		role="status" aria-label="Loading">
		<div class="bob-loader-card">
			<img th:src="@{/images/bobn.png}" alt="Bank of Baroda"
				class="logo-imgs">
			<div class="flow-bar">
				<div class="flow-line"></div>
			</div>
		</div>
	</div>
	<!-- Loader Modal (Using your existing loader image) -->
	<div class="modal fade" id="loader" data-backdrop="static"
		data-keyboard="false">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content"
				style="background: transparent; border: none;">
				<div class="modal-body text-center">
					<img th:src="@{/images/loader.gif}"
						style="width: 150px; height: auto;" alt="Processing...">
				</div>
			</div>
		</div>
	</div>

	<!-- Custom Alert/Result Modal (Matches your existing style) -->
	<div class="modal fade" id="resultModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<!-- Your custom styled header -->
				<div class="menu-title-header">
					<div class="modal-title" id="resultModalLabel"
						style="text-align: center; color: white;">
						<!-- Title will be set by JavaScript -->
					</div>
				</div>
				<div class="modal-body"
					style="text-align: center; font-size: 1.1rem;">
					<p id="resultModalBody"></p>
					<!-- Your custom styled button -->
					<button type="button" class="role-btn" onclick="list()"
						data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

</body>
<script>
	$('#usertable').DataTable({
		scrollX: false,
		autoWidth: false,
		paging: true,
		searching: true,
		lengthChange: false,
		ordering: false,
		pageLength: 100,
		fixedHeader: true,

		// Layout: search (left) + pagination (right)
		dom: '<"d-flex justify-content-between align-items-center mb-2"f p>t',


		// Optional: language tweak for better label
		language: {
			search: "Search:"
		}
	});
</script>


<!-- Include this after your DataTable initialization script -->

<style>
/* Remove top margin/padding from DataTables parent containers */
#data {
	padding-top: 0 !important;
	margin-top: 0 !important;
}

.table-responsive {
	margin-top: 0 !important;
	padding-top: 0 !important;
}

/* Ensure DataTables filter (search box) doesn't have spacing above it */
div.dataTables_filter {
	margin-top: 0 !important;
	padding-top: 0 !important;
}

/* FIX: Make search label and box inline */
.dataTables_filter label {
	display: flex !important;
	align-items: center;
	gap: 8px; /* space between text and input */
	margin-bottom: 0 !important;
}

/* Optional: Style the search input */
.dataTables_filter input {
	margin-left: 5px;
	flex: 1;
}
</style>

<script>
	function handleCountryChange(select) {
		const selectedCountry = select.value;

		if (!selectedCountry) {
			$('#cbuaeGeographicalZone').val('');
			return;
		}

		$.ajax({
			url: '/BCDRS/getCountryDetails',
			type: 'GET',
			data: {countryName: selectedCountry},
			success: function (data) {
				$('#cbuaeGeographicalZone').val(data.cbuaeGeographicalZone || '');
			},
			error: function (xhr, status, error) {
				console.error('AJAX Error:', error);
				//alert('Failed to fetch geographical zone.');
			}
		});
	}

	// Run on page load (for edit mode)
	window.onload = function () {
		const countrySelect = document.getElementById("countryOfRisk");
		if (countrySelect && countrySelect.value) {
			handleCountryChange(countrySelect);
		}
	}; 
</script>
<script>
	function handleCountryChange2(select) {
		const selectedCountry = select.value;

		if (!selectedCountry) {
			$('#cbuaeGeographicalZone2').val('');
			return;
		}

		$.ajax({
			url: '/BCDRS/getCountryDetails',
			type: 'GET',
			data: {countryName: selectedCountry},
			success: function (data) {
				$('#cbuaeGeographicalZone2').val(data.cbuaeGeographicalZone || '');
			},
			error: function (xhr, status, error) {
				console.error('AJAX Error:', error);
				//alert('Failed to fetch geographical zone.');
			}
		});
	}

	// Run on page load (for edit mode)
	window.onload = function () {
		const countrySelect = document.getElementById("countryOfRisk");
		if (countrySelect && countrySelect.value) {
			handleCountryChange(countrySelect);
		}
	}; 
</script>

<script>
	function handleTransactionType(selectElement) {
		var selectedValue = selectElement.value;
		var cbuaeInput = document.getElementById("cbuaeInternalRef");

		if (selectedValue === "Repo" || selectedValue === "Reverse Repo") {
			cbuaeInput.value = selectedValue;
		} else {
			cbuaeInput.value = "";
		}
	}
</script>
<script>
	function handleBankChange(select) {
		const selectedBank = select.value;

		if (!selectedBank) {
			$('#bankSymbol').val('');
			$('#conventionalIslamic').val('');
			$('#localForeign').val('');
			$('#cbuaeTiering').val('');
			return;
		}

		$.ajax({
			url: '/BCDRS/getBankDetails',  // This uses your existing method
			type: 'GET',
			data: {bankName: selectedBank},
			success: function (data) {
				$('#bankSymbol').val(data.bankSymbol || '');
				$('#conventionalIslamic').val(data.conventionalIslamic || '');
				$('#localForeign').val(data.localForeign || '');
				$('#cbuaeTiering').val(data.cbuaeTiering || '');
			},
			error: function (xhr, status, error) {
				console.error('AJAX Error:', error);
				alert('Failed to fetch bank details.');
			}
		});
	}
</script>

<script>
  const fieldRules = {
    // VARCHAR2 fields
    bankName: 100,
    headOfficeSubsidiary: 20,
    subsidiary: 50,
    bankSymbol: 10,
    conventionalIslamic: 50,
    cbuaeTiering: 10,
    localForeign: 10,
    counterpartyName: 50,
    internalCounterpartyRef: 50,
    internalCounterpartyRating: 50,
    finalRatingCbuae: 50,
    countryOfRisk: 50,
    cbuaeGeographicalZone: 50,
    counterpartyType: 50,
    sector: 10,
    csa: 10,
    collateralType: 50,
    marginCallFrequency: 50,
    
    
    // NUMBER(24,2) fields
    pfe95Aed: "24,2",
    expectedPositiveExposureAed: "24,2",
    expectedNegativeExposureAed: "24,2",
    threshold: "24,2",
    minimumTransferAmountAed: "24,2",
    internal_short_limit: "24,2",
    independentAmountAed: "24,2",
    netCollateralOutstandingAed: "24,2",
    cvaAed: "24,2",
    dvaAed: "24,2",
    bilateralCvaAed: "24,2",
    fvaAed: "24,2",
    incrementalPfe: "24,2"
  };

  function showError(input, msg) {
    let span = document.getElementById(input.id + "-error");
    if (!span) {
      span = document.createElement("small");
      span.id = input.id + "-error";
      span.className = "text-danger";
      span.style.display = "block";
      input.parentNode.appendChild(span);
    }
    span.innerText = msg;
  }

  function clearError(input) {
    const span = document.getElementById(input.id + "-error");
    if (span) span.innerText = "";
  }

  function validateInput(event) {
    const input = event.target;
    const rule = fieldRules[input.id];
    const value = input.value.trim();

    if (!rule || value === "") {
      clearError(input);
      return;
    }

    if (typeof rule === "number" || !isNaN(rule)) {
      // VARCHAR2 Validation (check character length)
      if (value.length > rule) {
        showError(input, `Max ${rule} characters allowed`);
      } else {
        clearError(input);
      }
    } else if (typeof rule === "string" && rule.includes(",")) {
      // NUMBER(p,s) validation
      const [total, decimal] = rule.split(",").map(Number);
      const regex = /^\d+(\.\d+)?$/;

      if (!regex.test(value)) {
        showError(input, `Only numeric values allowed with max ${decimal} decimals`);
        return;
      }

      const [intPart, decPart = ""] = value.split(".");
      const intLen = intPart.replace(/^0+/, "").length;
      const decLen = decPart.length;

      if (intLen + decLen > total || decLen > decimal) {
        showError(input, `Max ${total - decimal} digits before and ${decimal} after decimal`);
      } else {
        clearError(input);
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    for (const id in fieldRules) {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener("input", validateInput);

        // Add maxlength to VARCHAR2 fields only
        if (typeof fieldRules[id] === "number" || !isNaN(fieldRules[id])) {
          input.setAttribute("maxlength", fieldRules[id]);
        }
      }
    }
  });
</script>
<style>
	/* Default header alignment */
	#usertable thead th {
		text-align: center !important;
		vertical-align: middle !important;
	}

	/* Left aligned headers */
	#usertable thead th.th-left {
		text-align: left !important;
	}

	/* Right aligned headers */
	#usertable thead th.th-right {
		text-align: right !important;
		width: 50px !important;
	}

	#usertable td.th-left {
		text-align: left !important;
	}

	/* Right aligned headers */
	#usertable td.th-right {
		text-align: right !important;
		width: 50px !important;
	}

	#usertable {
		table-layout: auto !important;
		width: 100% !important;
	}

	/* Report Date column â€“ prevent wrap + increase width */
	#usertable th.col-report-date,
	#usertable td.col-report-date {
		min-width: 120px !important;
		/* increase as needed */
		white-space: nowrap !important;
		text-align: center;
	}
</style>
<style>
	body:has(#ccr-edit-page) {
		overflow: hidden;
	}

	#ccr-edit-page .card-body {
		max-height: calc(100vh - 280px);
		overflow-y: auto;
		overflow-x: hidden;
	}

	#ccr-edit-page .card {
		margin-bottom: 0;
	}
</style>
<style>
	.menu-title-header {
		background-color: #f7a47c !important;
		color: #ffffff;
		text-align: center;
		padding: 10px 15px;
		border-top-left-radius: 6px;
		border-top-right-radius: 6px;
	}
</style>
<style>
	.ccr-edit-page {
		font-family: Arial, sans-serif !important;
		font-size: 12px !important;
	}

	.ccr-edit-page label,
	.ccr-edit-page input,
	.ccr-edit-page textarea,
	.ccr-edit-page button {
		font-size: 12px !important;
	}

	.modal-title {
		background-color: #f7a47c;
	}
</style>
</html>