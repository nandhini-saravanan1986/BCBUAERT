<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
		th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/font-awesome/5.9.0/css/all.min.css"
		th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
		th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
		th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
	<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
	<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
	<link rel="stylesheet" th:href="@{/css/CustomButton.css}" />

	<!-- CORRECT ORDER -->
	<!-- 1. jQuery First -->
	<script src="/webjars/jquery/3.4.1/jquery.min.js" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>

	<!-- 2. Popper Second (Required by Bootstrap 4) -->
	<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
		th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>

	<!-- 3. Bootstrap Third -->
	<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
		th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>

	<!-- 4. Others follow -->
	<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
		th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
		th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

	<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
	<script src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>


	<style>
		.modal-backdrop {
			position: fixed;
			top: 0;
			left: 0;
			width: 120vw !important;
			/* ðŸ‘ˆ a bit wider than viewport */
			height: 120vh !important;
			/* ðŸ‘ˆ a bit taller than viewport */
			background-color: #000;
			/* ðŸ‘ˆ solid black base */
			opacity: 0.7 !important;
			/* ðŸ‘ˆ slightly darker overlay */
			z-index: 1062;
			/* ðŸ‘ˆ ensures it sits below modal but above everything else */
		}

		:root {
			--bob-orange: #0073e6;
			--bob-blue: #004080;
			--overlay-bg: rgba(255, 255, 255, 0.9);
		}

		/* Full-screen overlay */
		.bob-loader {
			position: fixed;
			inset: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			background: rgba(226, 232, 237, 0.6);
			/* lighter background */
			backdrop-filter: blur(8px);
			/* âœ… background blur */
			-webkit-backdrop-filter: blur(8px);
			/* Safari support */
			z-index: 9999;
			transition: opacity 0.25s ease, visibility 0.25s;
			opacity: 1;
			visibility: visible;
		}

		/* Hide when not active */
		.bob-loader[aria-hidden="true"] {
			opacity: 0;
			visibility: hidden;
			pointer-events: none;
		}

		/* Loader card */
		.bob-loader-card {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		/* Static logo */
		.logo-imgs {
			height: 90px;
			object-fit: contain;
			display: block;
		}

		/* Flowing bar below logo */
		.flow-bar {
			position: relative;
			width: 200px;
			/* âœ… increased width */
			height: 8px;
			/* slightly thicker for better visibility */
			background: #f1f1f1;
			border-radius: 4px;
			overflow: hidden;
			margin-top: 10px;
		}

		.flow-line {
			position: absolute;
			left: -40%;
			top: 0;
			width: 40%;
			height: 100%;
			background: linear-gradient(90deg, var(--bob-orange), var(--bob-blue));
			border-radius: 4px;
			animation: flowMove 1.2s linear infinite;
		}

		/* Animation for flowing line */
		@keyframes flowMove {
			0% {
				left: -40%;
			}

			100% {
				left: 100%;
			}
		}
	</style>


	<style>
		#usertable {
			width: 100% !important;

			font-family: Arial, sans-serif !important;
			font-size: 12px !important;
			border-collapse: separate !important;
			/* Required for sticky borders to work */
			border-spacing: 0;
		}

		/* HEADER */
		#usertable th {
			background-color: #7b6458 !important;
			/* brown header */
			position: sticky;
			top: 0;
			z-index: 100;
			/* Keeps header above the body rows */
			color: white !important;
			/*text-align: center !important;*/
			padding: 8px 10px !important;
			font-weight: bold !important;
			border: 1px solid #ffffff !important;
			/* thin white separator */
			white-space: normal !important;
		}

		/* BODY CELLS */
		#usertable td {
			padding: 5px 6px !important;
			border: 1px solid #e8e8e8 !important;
			/* light grey lines */
			background: #fafafa;
			white-space: normal !important;
		}

		/* ROW EVEN/ODD */
		#usertable tbody tr:nth-child(even) {
			background-color: #f4f2ef !important;
		}

		#usertable tbody tr:nth-child(odd) {
			background-color: #ffffff !important;
		}

		/* SEARCH BOX FIX */
		.dataTables_filter label {
			display: flex !important;
			gap: 10px;
			align-items: center;
		}

		.dataTables_filter input {
			width: 180px !important;
			padding: 5px;
		}

		/* PAGINATION â€” SAME AS TIA */
		.dataTables_wrapper .dataTables_paginate .paginate_button {
			border-radius: 50% !important;
			padding: 5px 10px !important;
			margin: 2px;
			border: none !important;
			background: #e0e0e0 !important;
			color: black !important;
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button.current {
			background: #E67E00 !important;
			/* orange */
			color: white !important;
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
			background: #555 !important;
			color: white !important;
		}

		/* Disable box shadow */
		.dataTables_wrapper .dataTables_paginate .paginate_button:active {
			box-shadow: none !important;
		}



		.dataTables_filter label {
			display: flex !important;
			align-items: center;
			gap: 8px;
			/* space between text and input */
			margin-bottom: 0 !important;
		}

		.dataTables_filter input {
			margin-left: 5px;
			flex: 1;
		}

		/* === ROLE PAGE CUSTOM HEADER === */
		.role-page-header {
			background-color: #ffffff;
			padding: 15px 20px;
			display: flex;
			/* Added for alignment */
			justify-content: space-between;
			/* Added for alignment */
			align-items: center;
			/* Added for alignment */
		}

		.role-page-title h4 {
			color: #212529;
			font-family: "Segoe UI", Arial, sans-serif;
			font-size: 26px;
			font-weight: 500;
			margin: 0;
		}
	</style>

	<style>
		/* Red border for invalid inputs */
		input.error,
		select.error {
			border: 2px solid red !important;
		}

		/* Error message style */
		label.error {
			color: red;
			font-size: 0.85em;
			margin-top: 5px;
			display: block;
		}

		.left-arrow-circle {
			width: 35px;
			height: 35px;
			border-radius: 50%;
			background-color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-right: 10px;
			transition: background-color 0.3s, transform 0.2s;
		}

		.left-arrow-circle i {
			color: rgb(107, 122, 143);
		}

		.left-arrow-circle:hover {
			background-color: rgb(107, 122, 143);
			cursor: pointer;
			transform: scale(1.05);
			border: 2px solid white;
		}

		.left-arrow-circle:hover i {
			color: white;
		}

		.white-text span {
			color: white !important;


		}
	</style>
	<style>
		/* Shared styles for both buttons */
		#floatingBackBtn,
		#floatingForwardBtn {
			position: fixed;
			top: 50%;
			background-color: #0073e6;
			border: none;
			color: white;
			font-size: 20px;
			border-radius: 50%;
			width: 45px;
			height: 45px;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			pointer-events: none;
			transition: all 0.4s ease;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
			z-index: 999;
		}

		/* Back button */
		#floatingBackBtn {
			left: -50px;
			/* hidden off-screen */
		}

		/* Forward button */
		#floatingForwardBtn {
			right: -50px;
			/* hidden off-screen */
		}

		/* Show when near edge */
		#floatingBackBtn.show {
			left: 20px;
			opacity: 1;
			pointer-events: auto;
		}

		#floatingForwardBtn.show {
			right: 20px;
			opacity: 1;
			pointer-events: auto;
		}

		/* Hover animation */
		#floatingBackBtn:hover,
		#floatingForwardBtn:hover {
			background-color: #005bb5;
			transform: scale(1.1);
		}
	</style>
	<style>
		.btns {
			float: right;
			margin: 5px;
		}

		.page-item.active .page-link {
			z-index: 1;
			color: #fff;
			background-color: #E67E00;
			border-color: #E67E00;
		}

		.col-sm-5 {
			padding-bottom: 15px;
		}

		.list-body {
			padding: 0px;
		}

		.error {
			color: red;
			padding-left: 10px;
		}

		.formline {
			padding-bottom: 15px;
			display: flex;
			/* Ensure flex for alignment */
			align-items: center;
			/* Vertically align items */
		}

		.formline>.col-sm-2,
		.formline>.col-sm-3 {
			display: flex;
			/* Make columns flex containers */
			align-items: center;
			/* Vertically align content within columns */
		}

		.formline>.col-sm-2 {
			justify-content: flex-end;
			/* Right-align labels */
			text-align: right;
			padding-right: 15px;
			/* Space between label and input */
		}

		.formline>.col-sm-3 {
			padding-left: 0px;
			/* Remove extra padding if needed */
		}

		.btn-primary {
			background-color: #E77400;
			border-color: #0c0c0c;
		}

		.btn-primary:not(:disabled):not(.disabled).active,
		.btn-primary:not(:disabled):not(.disabled):active,
		.show>.btn-primary.dropdown-toggle {
			color: #fff;
			background-color: #cc000000;
			border-color: #161617;
		}

		#finusertb {
			width: 460px;
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button {
			padding: 0px;
		}

		/* Added for overall layout consistency */
		.container-fluid {
			width: 100%;
			padding-top: 1px;
			padding-right: 15px !important;
			/* Adjusted for better content spacing */
			padding-left: 15px !important;
			/* Adjusted for better content spacing */
			margin-right: auto;
			margin-left: auto;
		}

		.card {
			border: 1px solid #e0e0e0;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, .05);
		}

		.card-header {
			background-color: #f8f9fa;
			border-bottom: 1px solid #e0e0e0;
			padding: 15px 20px;
			display: flex;
			/* Added for alignment */
			justify-content: space-between;
			/* Added for alignment */
			align-items: center;
			/* Added for alignment */
		}
		html, body {
		    height: 100%;
		    overflow: hidden; /* This removes both X and Y window scrollbars */
		    margin: 0;
		    padding: 0;
		}
		.card-body {
			padding: 20px;
		}

		.card-footer {
			background-color: #f8f9fa;
			border-top: 1px solid #e0e0e0;
			padding: 15px 20px;
		}

		.form-control-sm {
			height: calc(1.8125rem + 2px);
			/* Adjusted for better appearance */
			padding: .25rem .5rem;
			font-size: .875rem;
			line-height: 1.5;
			border-radius: .2rem;
		}

		/* Custom Tab Button Style */
		.custom-tab-btn {
			background-color: #007bff;
			color: white;
			border: none;
			padding: 8px 15px;
			margin-left: 8px;
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.3s ease;
			font-size: 14px !important;
			/* Ensure consistent font size */
		}

		.custom-tab-btn:hover {
			background-color: #0056b3;
		}
	</style>
	<style>
		.valids {
			color: green;
		}

		.invalids {
			color: red;
		}
	</style>

	<style>
		.role-btn {
			background: #ffffff;
			/* default white */
			color: #E67E00;
			/* default orange text */
			border: 1px solid #E67E00;
			border-radius: 25px;
			padding: 8px 18px;
			font-size: 13px;
			font-weight: 600;
			cursor: pointer;
			box-shadow: 0 1px 3px rgba(230, 126, 0, 0.15);
			transition: all 0.3s ease;
		}

		/* Hover effect â†’ pastel orange */
		.role-btn:hover {
			background: #FFF3D1;
			/* pastel orange (same as submenu hover) */
			color: #E67E00;
			/* orange text */
			transform: translateY(-2px);
			box-shadow: 0 0 8px rgba(230, 126, 0, 0.4);
		}

		/* Active (selected tab) */
		.role-btn.active {
			background: #E67E00;
			/* solid orange */
			color: #fff;
			/* white text */
			border-color: #E67E00;
			transform: translateY(-1px);
			box-shadow: 0 1px 8px rgba(230, 126, 0, 0.3);
		}

		/* Optional: icon spacing */
		.role-btn i {
			margin-right: 5px;
		}
	</style>
	<style>
		#pageHeader {
			position: sticky;
			top: 110px;
			z-index: 1050;
			background: white;
			padding-top: 10px;
		}

		#tabHeader {
			position: sticky;
			top: 5px;
			/* just below page header */
			z-index: 1040;
			background: white;
			padding: 5px 0;
		}

		#mainHeader {
			position: sticky;
			top: 0;
			z-index: 9999;
			background: white;
		}

		#bankSuggestions,
		#bankSuggestions_code {
			position: absolute;
			background: white;
			border: 1px solid #ccc;
			z-index: 2000;
			width: 100%;
			display: none;
			max-height: 150px;
			/* Limits height to show ~5 items */
			overflow-y: auto;
			/* Enables scrolling */
			box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
		}

		.suggestion-item-bank,
		.suggestion-item-code {
			padding: 8px;
			cursor: pointer;
			border-bottom: 1px solid #eee;
		}

		.suggestion-item-bank:hover,
		.suggestion-item-code:hover {
			background-color: #f1f1f1;
		}
	</style>

	<script th:inline="javascript">
		/*<![CDATA[*/








		function adduser() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");


			location.href = 'counterparty?formmode=add';

		}


		function list() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			location.href = 'counterparty?formmode=list';
		}



		/*]]>*/
	</script>

	<script>
		function deleteuser() {

			var entryuser = document.querySelector('[data-entry_user]');
			var modifyuser = document.querySelector('[data-modify_user]');

			if (confirm('Are you sure you want to delete this User?')) {
				document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
				var userid = document.getElementById("userId").value;
				$.ajax({
					type: 'post',
					url: './deleteuser?formmode=' + userid,
					success: function (response) {
						document.getElementById("bob-loader").setAttribute("aria-hidden", "true");
						$("#alertmsg").text('User Deleted');
						$('#alert').modal("toggle");
					},
					error: function (xhr, status, error) {
						document.getElementById("bob-loader").setAttribute("aria-hidden", "true");
						alert('Not able to delete contact administrator');
					}
				});
			}

		}
	</script>
	<script>
		function roledesc1() {

			var roleid = $("#roleId").find(':selected').val();

			if (roleid == 'VISAP1') {
				$("#roleDesc1").val("VISAP1");
			} else if (roleid == 'VISAR2') {
				$("#roleDesc1").val("VISAR2");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'CURINT4') {
				$("#roleDesc1").val("CURINT4");
			}
			$(this).find(':selected').text();

		}

		function brflogin() {

			var roleid = $("#roleId").find(':selected').val();

			if (roleid == 'VISAP1') {
				$("#roleDesc1").val("VISAP1");
			} else if (roleid == 'VISAR2') {
				$("#roleDesc1").val("VISAR2");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'CURINT4') {
				$("#roleDesc1").val("CURINT4");
			}
			$(this).find(':selected').text();

		}

		function home() {
			location.href = "/MIS/Dashboard";
		}

		function back() {
			window.history.back();
		}
	</script>
	<script>
		function goBack() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			window.history.back();
		}

		function goForward() {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			window.history.forward();
		}

		// Detect mouse near screen edges
		// Detect mouse near screen edges with protection against null elements
		document.addEventListener('mousemove', function (e) {
			const backBtn = document.getElementById('floatingBackBtn');
			const forwardBtn = document.getElementById('floatingForwardBtn');
			const screenWidth = window.innerWidth;

			// Only run logic if buttons actually exist on the current page
			if (backBtn && forwardBtn) {
				// Left edge (back)
				if (e.clientX < 50) {
					backBtn.classList.add('show');
				} else {
					backBtn.classList.remove('show');
				}

				// Right edge (forward)
				if (screenWidth - e.clientX < 50) {
					forwardBtn.classList.add('show');
				} else {
					forwardBtn.classList.remove('show');
				}
			}
		});
	</script>

	<script>
		function submitform() {

			var counterPartyBankCode = $("#counterPartyBankCode").val().trim();
			var counterPartyBank = $("#counterPartyBank").val().trim();
			var location = $("#location").val().trim();
			var expiryDate = $("#expiryDate").val().trim();
			var rating = $("#rating").val().trim();
			var regularLimit = $("#regularLimit").val().trim();
			var adhocLimit = $("#adhocLimit").val().trim();
			var creditLimit = $("#creditLimit").val().trim();
			var settlementLimit = $("#settlementLimit").val().trim();
			var moneyMarketLimit = $("#moneyMarketLimit").val().trim();
			var tradeFinanceLimit = $("#tradeFinanceLimit").val().trim();
			var earmarkinglimit = $("#earmarkinglimit").val().trim(); // Added
			var earmarkingdate = $("#earmarkingdate").val().trim(); // Added


			if (counterPartyBankCode === "") {
				alert("Please enter counterParty Bank Code.");
				$("#counterPartyBankCode").focus();
				return;
			}
			if (regularLimit === "") {
				alert("Please enter regularLimit.");
				$("#regularLimit").focus();
				return;
			} if (adhocLimit === "") {
				alert("Please enter adhocLimit.");
				$("#adhocLimit").focus();
				return;
			} if (creditLimit === "") {
				alert("Please enter creditLimit.");
				$("#creditLimit").focus();
				return;
			} if (settlementLimit === "") {
				alert("Please enter settlementLimit.");
				$("#settlementLimit").focus();
				return;
			} if (moneyMarketLimit === "") {
				alert("Please enter moneyMarketLimit.");
				$("#moneyMarketLimit").focus();
				return;
			} if (tradeFinanceLimit === "") {
				alert("Please enter tradeFinanceLimit.");
				$("#tradeFinanceLimit").focus();
				return;
			}


			if (counterPartyBank === "") {
				alert("Please enter counterparty bank name.");
				$("#counterPartyBank").focus();
				return;
			}
			/*if (expiryDate === "") {
				alert("Please enter Expiry Date.");
				$("#expiryDate").focus();
				return;
			}*/
			if (rating === "") {
				alert("Please enter Rating .");
				$("#rating").focus();
				return;
			}
			if (location === "") {
				alert("Please enter location.");
				$("#location").focus();
				return;
			}
			if (Adhoc_Limit_exp_date === "") {
				alert("Please enter Adhoc Limit Expiry Date.");
				$("#Adhoc_Limit_exp_date").focus();
				return;
			}

			// All fields are valid â€” proceed with AJAX
			var formData = $("#counterpartys").serialize();
			console.log("Form data being submitted:", formData);

			$.ajax({
				url: "./Addcounter",
				type: "POST",
				data: formData,
				success: function (response) {
					console.log("Server response:", response);
					saveDetailsSequentially();
					$("#alertmsg").text(response);
					$('#alert').modal("toggle");

					// Trigger download using browser, not AJAX
					/*  setTimeout(function() {
						 window.location.href = "./download/excel";
					 }, 200); */ // slight delay to ensure file generation completes
				},
				error: function (xhr, status, error) {
					console.error("Error occurred:", error);
					$("#alertmsg").text("An error occurred: " + error);
					$('#alert').modal("toggle");
				}
			});
		}

	</script>
	<script th:inline="javascript">
		/*<![CDATA[*/
		var counterlist = /*[[${counterlist}]]*/[];
		var getcode = /*[[${getcode}]]*/[];
		console.log(getcode)
		// -------------------- Bank Name Validation --------------------

		function validatelis(inputElem) {
			const inputVal = inputElem.value.trim().toLowerCase();
			let matches = [];

			$("#bankSuggestions").empty().hide();

			// Collect matching suggestions
			counterlist.forEach(item => {
				if (item.toLowerCase().includes(inputVal) && inputVal !== "") {
					matches.push(item);
				}
			});

			// Do not show "Already exists!" message
			$("#bankExistsMsg").hide();

			// Do not hide the generate button
			$("#generatebtn").show();

			if (matches.length > 0) {
				matches.forEach(suggestion => {
					$("#bankSuggestions").append(
						`<div class='suggestion-item-bank' style='padding: 5px; cursor: pointer;'>${suggestion}</div>`
					);
				});
				$("#bankSuggestions").show();
			}
		}


		$(document).on("click", ".suggestion-item-bank", function () {
			$("#counterPartyBank").val($(this).text());
			$("#bankSuggestions").hide();
			validatelis(document.getElementById("counterPartyBank"));
		});

		$(document).click(function (e) {
			if (!$(e.target).closest("#counterPartyBank, #bankSuggestions").length) {
				$("#bankSuggestions").hide();
			}
		});

		// -------------------- Bank Code Validation --------------------

		function validatelist(inputElem) {
			const inputVal = inputElem.value.trim().toLowerCase();
			let exists = false;
			let matches = [];

			$("#bankSuggestions_code").empty().hide();

			getcode.forEach(item => {
				if (item.toLowerCase() === inputVal) {
					exists = true;
				} else if (item.toLowerCase().includes(inputVal) && inputVal !== "") {
					matches.push(item);
				}
			});

			$("#bankExistsMsg_code").toggle(exists);
			if (exists) $("#generatebtn").hide();
			else $("#generatebtn").show();

			if (matches.length > 0) {
				matches.forEach(suggestion => {
					$("#bankSuggestions_code").append(
						`<div class='suggestion-item-code' style='padding: 5px; cursor: pointer;'>${suggestion}</div>`
					);
				});
				$("#bankSuggestions_code").show();
			}
		}

		$(document).on("click", ".suggestion-item-code", function () {
			$("#counterPartyBankCode").val($(this).text());
			$("#bankSuggestions_code").hide();
			validatelist(document.getElementById("counterPartyBankCode"));
		});

		$(document).click(function (e) {
			if (!$(e.target).closest("#counterPartyBankCode, #bankSuggestions_code").length) {
				$("#bankSuggestions_code").hide();
			}
		});
		/*]]>*/
	</script>

	<style>
		.btn {
			font-size: unset !important;
		}


		.container-fluid {

			width: 100%;
			padding-top: 1px;
			padding-right: 0px !important;
			padding-left: 0px !important;
			margin-right: auto;
			margin-left: auto;
		}
	</style>
	<script>
		$(document).ready(function () {
		    if ($.fn.DataTable.isDataTable('#usertable')) {
		        $('#usertable').DataTable().destroy();
		    }

		    $('#usertable').DataTable({
		        "paging": true,
		        "lengthChange": false,
		        "searching": true,
		        "ordering": true,
		        "info": true,
		        "autoWidth": false, // Set this to false
		        "pageLength": 10,   // You can increase this since the body scrolls now
		        "language": {
		            "search": "Search Table:"
		        },
		        "dom": '<"top"f>rt<"bottom"ip><"clear">'
		    });
		});
	</script>



	<script>

		function modifyCounterparty(id) {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			console.log("Modify clicked for ID:", id);
			location.href = 'counterparty?formmode=edit' + '&id=' + id;
		}

		function viewCounterparty(id) {
			document.getElementById("bob-loader").setAttribute("aria-hidden", "false");
			console.log("view clicked for ID:", id);
			location.href = 'counterparty?formmode=view' + '&id=' + id;
		}

	</script>


	<script>
		function modify() {

			var counterPartyBankCode = $("#counterPartyBankCode").val().trim();
			var counterPartyBank = $("#counterPartyBank").val().trim();
			var location = $("#location").val().trim();
			var expiryDate = $("#expiryDate").val().trim();
			var rating = $("#rating").val().trim();
			var regularLimit = $("#regularLimit").val().trim();
			var adhocLimit = $("#adhocLimit").val().trim();
			var creditLimit = $("#creditLimit").val().trim();
			var settlementLimit = $("#settlementLimit").val().trim();
			var moneyMarketLimit = $("#moneyMarketLimit").val().trim();
			var tradeFinanceLimit = $("#tradeFinanceLimit").val().trim();
			var earmarkinglimit = $("#earmarkinglimit").val().trim(); // Added
			var earmarkingdate = $("#earmarkingdate").val().trim(); // Added


			if (counterPartyBankCode === "") {
				alert("Please enter counterParty Bank Code.");
				$("#counterPartyBankCode").focus();
				return;
			}
			if (regularLimit === "") {
				alert("Please enter regularLimit.");
				$("#regularLimit").focus();
				return;
			} if (adhocLimit === "") {
				alert("Please enter adhocLimit.");
				$("#adhocLimit").focus();
				return;
			} if (creditLimit === "") {
				alert("Please enter creditLimit.");
				$("#creditLimit").focus();
				return;
			} if (settlementLimit === "") {
				alert("Please enter settlementLimit.");
				$("#settlementLimit").focus();
				return;
			} if (moneyMarketLimit === "") {
				alert("Please enter moneyMarketLimit.");
				$("#moneyMarketLimit").focus();
				return;
			} if (tradeFinanceLimit === "") {
				alert("Please enter tradeFinanceLimit.");
				$("#tradeFinanceLimit").focus();
				return;
			}


			if (counterPartyBank === "") {
				alert("Please enter counterparty bank name.");
				$("#counterPartyBank").focus();
				return;
			}
			/*if (expiryDate === "") {
				alert("Please enter Expiry Date.");
				$("#expiryDate").focus();
				return;
			}*/
			if (rating === "") {
				alert("Please enter Rating .");
				$("#rating").focus();
				return;
			}
			if (location === "") {
				alert("Please enter location.");
				$("#location").focus();
				return;
			}
			if (Adhoc_Limit_exp_date === "") {
				alert("Please enter Adhoc Limit Expiry Date.");
				$("#Adhoc_Limit_exp_date").focus();
				return;
			}

			// All fields are valid â€” proceed with AJAX
			var formData = $("#counterpartys").serialize();
			console.log("Form data being submitted:", formData);

			$.ajax({
				url: "./Addcounter?formmode=edit",
				type: "POST",
				data: formData,
				success: function (response) {
					console.log("Server response:", response);
					$("#alertmsg").text(response);
					$('#alert').modal("toggle");


					// Trigger download using browser, not AJAX
					/*  setTimeout(function() {
						 window.location.href = "./download/excel";
					 }, 200); */ // slight delay to ensure file generation completes
				},
				error: function (xhr, status, error) {
					console.error("Error occurred:", error);
					$("#alertmsg").text("An error occurred: " + error);
					$('#alert').modal("toggle");
				}
			});
		}


	</script>

	<script th:inline="javascript">
		/*<![CDATA[*/

		// Global flag to prevent duplicate loading in modal
		var isAdhocDataLoaded = false;

		// 1. MAIN SUBMIT FUNCTION (ADD MODE)
		function submitform() {
			if (!validateMainForm()) return;

			var formData = $("#counterpartys").serialize();
			$.ajax({
				url: "./Addcounter",
				type: "POST",
				data: formData,
				success: function (response) {
					// After master is saved, save the modal details
					saveDetailsSequentially();
					$("#alertmsg").text(response);
					$('#alert').modal("show");
				},
				error: function (xhr) {
					alert("Error saving master record: " + xhr.statusText);
				}
			});
		}

		// 2. MAIN MODIFY FUNCTION (EDIT MODE)
		function modify() {
			if (!validateMainForm()) return;

			var formData = $("#counterpartys").serialize();
			$.ajax({
				url: "./Addcounter?formmode=edit",
				type: "POST",
				data: formData,
				success: function (response) {
					saveDetailsSequentially();
					$("#alertmsg").text(response);
					$('#alert').modal("show");
				},
				error: function (xhr) {
					alert("Error modifying record: " + xhr.statusText);
				}
			});
		}

		// 3. VALIDATION HELPER
		function validateMainForm() {
			var bankCode = $("#counterPartyBankCode").val().trim();
			var bankName = $("#counterPartyBank").val().trim();
			var country = $("#location").val().trim();
			var rating = $("#rating").val().trim();
			var adhocExp = $("#Adhoc_Limit_exp_date").val();

			if (bankCode === "") {alert("Please enter Bank Code."); return false;}
			if (bankName === "") {alert("Please enter Bank Name."); return false;}
			if (country === "") {alert("Please enter Country."); return false;}
			if (rating === "") {alert("Please enter Rating."); return false;}
			if (adhocExp === "") {alert("Please enter Adhoc Limit Expiry Date."); return false;}
			return true;
		}

		// 4. MODAL LOGIC
		function openAdhocModal() {
			var bankCode = $("#counterPartyBankCode").val();
			var srlNo = $("#srlNo").val();
			var formmode = /*[[${formmode}]]*/ 'add';

			if (!bankCode) {
				alert("Please enter CounterParty Bank Code first.");
				return;
			}

			$('#adhocDetailModal').modal('show');

			if (!isAdhocDataLoaded) {
				if (formmode === 'edit' || formmode === 'view') {
					$.ajax({
						url: "./getAdhocDetails",
						type: "GET",
						data: {srlNo: srlNo},
						success: function (data) {
							$("#adhocDetailTable tbody").empty();
							if (data && data.length > 0) {
								data.forEach(item => addAdhocDetailRow(item));
								calculateAdhocSum();
							} else {
								addAdhocDetailRow();
							}
							isAdhocDataLoaded = true;
						}
					});
				} else {
					if ($("#adhocDetailTable tbody tr").length === 0) {
						addAdhocDetailRow();
					}
					isAdhocDataLoaded = true;
				}
			}
		}

		function addAdhocDetailRow(data = null) {
			var bankCode = $("#counterPartyBankCode").val();
			var today = new Date().toISOString().split('T')[0];

			var limitType = data ? data.limit_type : "Credit Limit";
			var adhocAmt = data ? data.adhocLimit : 0;
			var adhocDate = data ? formatDate(data.adhocLimitDate) : today;
			var expDate = data ? formatDate(data.adhocLimitExpDate) : today;
			var earLimit = data ? data.earMarkingLimit : 0;
			var earDate = data ? formatDate(data.earMarkingDate) : today;
			var refNo = data ? data.referenceNo : "";
			var rollOverVal = data ? data.rollOver : "No";

			var row = `<tr>
	        <td><input type="text" class="form-control form-control-sm d-bank" value="${bankCode}" readonly></td>
	        <td>
	            <select class="form-control form-control-sm d-limit-type">
	                <option value="Credit Limit" ${limitType === 'Credit Limit' ? 'selected' : ''}>Credit Limit</option>
	                <option value="Settlement Limit" ${limitType === 'Settlement Limit' ? 'selected' : ''}>Settlement Limit</option>
	            </select>
	        </td>
	        <td><input type="number" class="form-control form-control-sm d-limit" oninput="calculateAdhocSum()" value="${adhocAmt}"></td>
	        <td><input type="date" class="form-control form-control-sm d-date" value="${adhocDate}"></td>
	        <td><input type="date" class="form-control form-control-sm d-exp" value="${expDate}" min="${today}" onchange="validateAdhocDate(this)"></td>
	        <td><input type="number" class="form-control form-control-sm d-ear-limit" value="${earLimit}"></td>
	        <td><input type="date" class="form-control form-control-sm d-ear-date" value="${earDate}"></td>
	        <td><input type="text" class="form-control form-control-sm d-ref" value="${refNo}"></td>
	        <td>
	            <select class="form-control form-control-sm d-roll">
	                <option value="No" ${rollOverVal === 'No' ? 'selected' : ''}>No</option>
	                <option value="Yes" ${rollOverVal === 'Yes' ? 'selected' : ''}>Yes</option>
	            </select>
	        </td>
	    </tr>`;
			$("#adhocDetailTable tbody").append(row);
		}

		function validateAdhocDate(input) {
			var today = new Date();
			var dd = String(today.getDate()).padStart(2, '0');
			var mm = String(today.getMonth() + 1).padStart(2, '0');
			var yyyy = today.getFullYear();
			var todayStr = yyyy + '-' + mm + '-' + dd;

			// Calculate one year from now
			var nextYear = new Date();
			nextYear.setFullYear(today.getFullYear() + 1);
			var yyyyNext = nextYear.getFullYear();
			var mmNext = String(nextYear.getMonth() + 1).padStart(2, '0');
			var ddNext = String(nextYear.getDate()).padStart(2, '0');
			var maxDateStr = yyyyNext + '-' + mmNext + '-' + ddNext;

			if (input.value < todayStr) {
				alert("Expiry Date cannot be less than the current date.");
				input.value = todayStr;
			} else if (input.value > maxDateStr) {
				alert("Expiry Date cannot be more than one year from today (" + maxDateStr + ").");
				input.value = maxDateStr;
			}
		}

		function calculateAdhocSum() {
			var total = 0;
			$(".d-limit").each(function () {
				var val = parseFloat($(this).val()) || 0;
				total += val;
			});
			$("#adhocRunningTotal").text(total.toFixed(2));
			$("#adhocLimit").val(total.toFixed(2));
		}

		function confirmAdhocDetails() {
			var totalAdhoc = 0;
			var totalCreditLimit = 0;
			var totalSettlementLimit = 0;

			$("#adhocDetailTable tbody tr").each(function () {
				var limitType = $(this).find(".d-limit-type").val();
				var limitVal = parseFloat($(this).find(".d-limit").val()) || 0;

				totalAdhoc += limitVal;

				if (limitType === "Credit Limit") {
					totalCreditLimit += limitVal;
				} else if (limitType === "Settlement Limit") {
					totalSettlementLimit += limitVal;
				}
			});

			// Update main form fields
			$("#adhocLimit").val(totalAdhoc.toFixed(2));
			$("#creditLimit").val(totalCreditLimit.toFixed(2));
			$("#settlementLimit").val(totalSettlementLimit.toFixed(2));

			$('#adhocDetailModal').modal('hide');
		}

		function saveDetailsSequentially() {
			var adhocDetails = [];
			$("#adhocDetailTable tbody tr").each(function () {
				var row = $(this);
				adhocDetails.push({
					limit_type: row.find(".d-limit-type").val(),
					adhocLimit: row.find(".d-limit").val(),
					adhocLimitDate: row.find(".d-date").val(),
					adhocLimitExpDate: row.find(".d-exp").val(),
					earMarkingLimit: row.find(".d-ear-limit").val(),
					earMarkingDate: row.find(".d-ear-date").val(),
					referenceNo: row.find(".d-ref").val(),
					rollOver: row.find(".d-roll").val()
				});
			});

			$.ajax({
				url: "./saveDetailsRecord",
				type: "POST",
				data: {
					adhocDetailsJson: JSON.stringify(adhocDetails),
					srlNo: $("#srlNo").val(),
					bankName: $("#counterPartyBank").val()
				},
				success: function (res) {console.log("Adhoc Details saved");}
			});
		}

		function formatDate(dateString) {
			if (!dateString) return new Date().toISOString().split('T')[0];
			var d = new Date(dateString);
			return d.toISOString().split('T')[0];
		}

		/*]]>*/
	</script>
</head>
<title>RiskInsights</title>

<body>
	<div>
		<div class="row">
			<!--<div th:insert="XBRLHeaderMenu :: header"></div>-->
			<div id="mainHeader" th:insert="XBRLHeaderMenu :: header"></div>
			<div class="col-sm-12">

				<div th:if="${formmode}=='list'">
					<div class="card">
						<div id="pageHeader" class="role-page-header">

							<div class="role-page-title">
								<h4 th:text="${menu}"></h4>

							</div>


							<div class="btn-group">
								<button type="button" class="role-btn"
									onclick="window.location.href='./download/excel?mode=exposure'">
									Template Download
								</button>
								<button type="button" class="role-btn" th:if="${roleId}=='ADM-M'" onclick="adduser();">
									Add
								</button>
							</div>
						</div>

						<div id="tabHeader" class="row">
							<div class="col-sm-12">
								<div class="table-responsive" style="border: none;">
									<!--<div class="table-container" style="padding: 0px 15px;">-->
									<table class="table table-striped table-bordered table-hover" id="usertable">
										<thead style="background-color: #e9ecf0;" class="thead-light">
											<tr>
												<th style="white-space: nowrap;">S. No.</th>
												<th style="text-align: left; white-space: nowrap;">CounterParty Bank
													Code</th>
												<th style="text-align: left; white-space: nowrap;">CounterParty Bank
												</th>
												<th style="text-align: left; white-space: nowrap;">External Rating</th>
												<th style="text-align: left; white-space: nowrap;">Country</th>
												<th style=" text-align: right;white-space: nowrap;">Regular Limit</th>
												<th style=" text-align: right;white-space: nowrap;">Adhoc Limit</th>
												<th style=" text-align: right;white-space: nowrap;">Settlement
													Limit</th>
												<th style="text-align: right;white-space: nowrap;">Credit Limit</th>
												<th style="text-align: right;white-space: nowrap;">Money Market
													Limit</th>
												<th style=" text-align: right;white-space: nowrap;">Trade Finance
													Limit</th>
												<th style=" text-align: center;white-space: nowrap;">Adhoc Limit
													Expiry Date</th>

												<th style=" text-align: center;white-space: nowrap;">EAR Marking Limit
												</th>
												<th style=" text-align: center;white-space: nowrap;">Ear Marking Date
												</th>
												<th style=" text-align: center;white-space: nowrap;">Status</th>
												<th style=" width:5%; text-align: center;white-space: nowrap;">Expiry
													Date</th>
												<th style=" text-align: center;white-space: nowrap;">Action</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="lists : ${listall}" style="cursor: pointer;">
												<td th:text="${lists.srlNo}"></td>
												<td style="text-align:left" th:text="${lists.counterPartyBankCode}">
												</td>
												<td th:text="${lists.counterPartyBank}"></td>
												<td th:text="${lists.rating}"></td>
												<td th:text="${lists.location}"></td>
												<td th:text="${#numbers.formatDecimal(lists.regularLimit, 1, 2)}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.adhocLimit, 1, 2)}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.settlementLimit, 1, 2)}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.creditLimit, 1, 2)}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.moneyMarketLimit, 1, 2)}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.tradeFinanceLimit, 1, 2)}"
													style="text-align: right;"></td>


												<td th:text="${#dates.format(lists.Adhoc_Limit_exp_date, 'dd-MM-yyyy')}"
													style="text-align: center;"></td>

												<td th:text="${#numbers.formatDecimal(lists.earmarkinglimit, 1, 2)}"
													style="text-align: right;"></td>

												<td th:text="${#dates.format(lists.earmarkingdate, 'dd-MM-yyyy')}"
													style="text-align: center;"></td>


												<td style="text-align: center;"><span
														th:text="${lists.expiryDate >= currentDate} ? 'Active' : 'Expired'"
														th:style="${lists.expiryDate >= currentDate} ? 'color:green;' : 'color:red;'">
													</span></td>
												<td th:text="${#dates.format(lists.expiryDate, 'dd-MM-yyyy')}"
													style="text-align: center;"></td>
												<!-- Modify Button -->


												<td style="text-align: center;">
													<i class="fa fa-edit" title="Modify" th:if="${roleId}=='ADM-M'"
														th:attr="onclick=|modifyCounterparty('${lists.id}')|"
														style="cursor: pointer; color: blue; margin-right: 12px;">
													</i>

													<i class="fa fa-eye" title="View"
														th:attr="onclick=|viewCounterparty('${lists.id}')|"
														style="cursor: pointer; color: blue;">
													</i>
												</td>

											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>


					</div>
				</div>


				<div th:if="${formmode}=='add'">
					<div class="row">
						<div class="col-sm-12 ">
							<form action="#" method="post" autocomplete="off" id="counterpartys">
								<div class="card">
									<div class="role-page-header d-flex justify-content-between align-items-center">
										<!-- Left: Page Title -->
										<div class="role-page-title">
											<h4 th:text="${menu}"></h4>
											<div style="width: 240px;
												    height: 3px;
												    background-color: #0073e6;
												    border-radius: 2px;
												    margin-top: 6px;
												    box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);"></div>
										</div>

										<div class="btn-group nav-buttons float-right">
											<button type="button" class="role-add-btn" id="btnInq"
												onclick="list();">List</button>
										</div>
									</div>
									<div class="card-body">

										<input autocomplete="false" name="hidden" type="text" style="display: none;">
										<div class="form-group">
											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="userId">Serial No.<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" id="srlNo" th:value="${serialNo}"
														class="form-control form-control-sm" name="srlNo"
														autocomplete="off" readonly />
												</div>
												<div class="col-sm-2">
													<label for="counterPartyBankCode">CounterParty Bank Code<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBankCode"
														id="counterPartyBankCode" class="form-control form-control-sm"
														autocomplete="on" oninput="validatelist(this)" required />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg_code"
														style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions_code"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="counterPartyBank">CounterParty Bank<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBank" id="counterPartyBank"
														class="form-control form-control-sm" autocomplete="on"
														oninput="validatelis(this)" required />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg" style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

												<div class="col-sm-2">
													<label for="rating">External Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="rating" id="rating"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>

											</div>
											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Country<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="location" id="location"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>
												<div class="col-sm-2">
													<label for="location">Country Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="countryRating" id="countryRating"
														class="form-control form-control-sm" required />
												</div>

											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Regular Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="regularLimit" id="regularLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>
												<div class="col-sm-2">
													<label for="adhocLimit">Adhoc Limit (Total)<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<div class="input-group">
														<!-- Main total field is now readonly; it gets its value from the modal sum -->
														<input type="number" name="adhocLimit" id="adhocLimit"
															class="form-control form-control-sm" readonly required />
														<div class="input-group-append">
															<button class="btn btn-primary btn-sm" type="button"
																onclick="openAdhocModal()">
																<i class="fa fa-list"></i> Details
															</button>
														</div>
													</div>
												</div>
											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Settlement Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="settlementLimit" id="settlementLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>

												<div class="col-sm-2">
													<label for="location">Adhoc Limit Expiry Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="Date" name="Adhoc_Limit_exp_date"
														id="Adhoc_Limit_exp_date" class="form-control form-control-sm"
														required />
												</div>


											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">Credit Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="creditLimit" id="creditLimit"
														class="form-control form-control-sm" required />
												</div>
												<div class="col-sm-2">
													<label for="location">Money Market Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="moneyMarketLimit" id="moneyMarketLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>



											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">EAR Marking Limit</label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="earmarkinglimit" id="earmarkinglimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>

												<div class="col-sm-2">
													<label for="location">Ear Marking Date</label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="earmarkingdate" id="earmarkingdate"
														class="form-control form-control-sm" required />
												</div>




											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Trade Finance Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="tradeFinanceLimit" id="tradeFinanceLimit"
														class="form-control form-control-sm" required />
												</div>
											</div>

										</div>
										<div class="card-footer text-center">

											<button type="button" class="custom-tab-btn" id="generatebtn"
												onclick="submitform();">Submit</button>

										</div>

									</div>
								</div>
							</form>

						</div>
					</div>
				</div>

				<div th:if="${formmode}=='edit'">
					<div class="row">
						<div class="col-sm-12 ">
							<form action="#" method="post" autocomplete="off" id="counterpartys">
								<div class="card">

									<div class="role-page-header d-flex justify-content-between align-items-center">
										<!-- Left: Page Title -->
										<div class="role-page-title">
											<h4>CounterParty Bank - Modify</h4>
											<div style="width: 327px;
																								    height: 3px;
																								    background-color: #0073e6;
																								    border-radius: 2px;
																								    margin-top: 6px;
																								    box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);"></div>
										</div>
										<div class="btn-group nav-buttons float-right">
											<button type="button" class="role-add-btn" id="btnInq"
												onclick="list();">List</button>
										</div>
									</div>
									<div class="card-body">

										<input autocomplete="false" name="hidden" type="text" style="display: none;">
										<div class="form-group">
											<div class="row formline">
												<div class="col-sm-auto"></div>
												<input type="number" id="id" th:value="${list.id}"
													class="form-control form-control-sm" name="id" autocomplete="off"
													readonly hidden />
												<div class="col-sm-2">
													<label for="userId">Serial No.<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" id="srlNo" th:value="${list.srlNo}"
														class="form-control form-control-sm" name="srlNo"
														autocomplete="off" readonly />
												</div>
												<div class="col-sm-2">
													<label for="counterPartyBankCode">CounterParty Bank Code<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBankCode"
														th:value="${list.counterPartyBankCode}"
														id="counterPartyBankCode" class="form-control form-control-sm"
														readonly />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg_code"
														style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions_code"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="counterPartyBank">CounterParty Bank<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBank"
														th:value="${list.counterPartyBank}" id="counterPartyBank"
														class="form-control form-control-sm" readonly />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg" style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

												<div class="col-sm-2">
													<label for="rating">External Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="rating" id="rating"
														th:value="${list.rating}" class="form-control form-control-sm"
														autocomplete="new-text" required />
												</div>

											</div>
											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Country<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="location" id="location"
														th:value="${list.location}" class="form-control form-control-sm"
														autocomplete="new-text" required />
												</div>
												<!--<div class="col-sm-2">
													<label for="location">Expiry Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="expiryDate" id="expiryDate"
														class="form-control form-control-sm"
														th:value="${#dates.format(list.expiryDate, 'yyyy-MM-dd')}"
														required />

												</div>-->
												<div class="col-sm-2">
													<label for="location">Country Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="countryRating" id="countryRating"
														th:value="${list.countryRating}"
														class="form-control form-control-sm" required />
												</div>

											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Regular Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="regularLimit" id="regularLimit"
														th:value="${list.regularLimit}"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>
												<div class="col-sm-2">
													<label for="location">Adhoc Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<div class="input-group">
														<input type="number" name="adhocLimit" id="adhocLimit"
															th:value="${list.adhocLimit}"
															class="form-control form-control-sm" readonly required />
														<div class="input-group-append">
															<button class="btn btn-primary btn-sm" type="button"
																onclick="openAdhocModal()">
																<i class="fa fa-list"></i> Details
															</button>
														</div>
													</div>
												</div>

											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Settlement Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="settlementLimit" id="settlementLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.settlementLimit}" />
												</div>

												<div class="col-sm-2">
													<label for="location">Adhoc Limit Expiry Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="Date" name="Adhoc_Limit_exp_date"
														id="Adhoc_Limit_exp_date" class="form-control form-control-sm"
														required
														th:value="${#dates.format(list.Adhoc_Limit_exp_date, 'yyyy-MM-dd')}" />
												</div>


											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">Credit Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="creditLimit" id="creditLimit"
														class="form-control form-control-sm" required
														th:value="${list.creditLimit}" />
												</div>
												<div class="col-sm-2">
													<label for="location">Money Market Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="moneyMarketLimit" id="moneyMarketLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.moneyMarketLimit}" />
												</div>



											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">EAR Market Date</label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="earmarkingdate" id="earmarkingdate"
														class="form-control form-control-sm" required
														th:value="${#dates.format(list.earmarkingdate, 'yyyy-MM-dd')}" />
												</div>
												<div class="col-sm-2">
													<label for="location">EAR Marking Limit</label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="earmarkinglimit" id="earmarkinglimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.earmarkinglimit}" />
												</div>



											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Trade Finance Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="tradeFinanceLimit" id="tradeFinanceLimit"
														class="form-control form-control-sm" required
														th:value="${list.tradeFinanceLimit}" />
												</div>
											</div>

										</div>

										<div class="card-footer text-center">

											<button type="button" class="custom-tab-btn" id="generatebtn"
												onclick="modify();">Submit</button>


										</div>
									</div>
								</div>
							</form>

						</div>
					</div>
				</div>


				<div th:if="${formmode}=='view'">
					<div class="row">
						<div class="col-sm-12 ">
							<form action="#" method="post" autocomplete="off" id="counterpartys">
								<div class="card">

									<div class="role-page-header d-flex justify-content-between align-items-center">
										<!-- Left: Page Title -->
										<div class="role-page-title">
											<h4>CounterParty Bank - View</h4>
											<div style="width: 244px;
																			    height: 3px;
																			    background-color: #0073e6;
																			    border-radius: 2px;
																			    margin-top: 6px;
																			    box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);"></div>
										</div>

										<!-- Right: Add Button -->
										<div>
											<button type="button" class="role-add-btn" onclick="list();">
												List
											</button>
										</div>
									</div>






									<div class="card-body">

										<input autocomplete="false" name="hidden" type="text" style="display: none;">
										<div class="form-group">
											<div class="row formline">
												<div class="col-sm-auto"></div>
												<input type="number" id="id" th:value="${list.id}"
													class="form-control form-control-sm" name="id" autocomplete="off"
													readonly hidden />
												<div class="col-sm-2">
													<label for="userId">Serial No.<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" id="srlNo" th:value="${list.srlNo}"
														class="form-control form-control-sm" name="srlNo"
														autocomplete="off" readonly />
												</div>
												<div class="col-sm-2">
													<label for="counterPartyBankCode">CounterParty Bank Code<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBankCode"
														th:value="${list.counterPartyBankCode}"
														id="counterPartyBankCode" class="form-control form-control-sm"
														autocomplete="on" oninput="validatelist(this)" required
														readonly />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg_code"
														style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions_code"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="counterPartyBank">CounterParty Bank<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3 position-relative">
													<input type="text" name="counterPartyBank"
														th:value="${list.counterPartyBank}" id="counterPartyBank"
														class="form-control form-control-sm" autocomplete="on"
														oninput="validatelis(this)" required readonly />

													<!-- Tooltip for already exists -->
													<small id="bankExistsMsg" style="color: red; display: none;">Already
														exists!</small>

													<!-- Manual dropdown for matches -->
													<div id="bankSuggestions"
														style="position: absolute; background: white; border: 1px solid #ccc; z-index: 1000; width: 100%; display: none;">
													</div>
												</div>

												<div class="col-sm-2">
													<label for="rating">External Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="rating" id="rating"
														th:value="${list.rating}" class="form-control form-control-sm"
														autocomplete="new-text" required readonly />
												</div>

											</div>
											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Country<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="location" id="location"
														th:value="${list.location}" class="form-control form-control-sm"
														autocomplete="new-text" required readonly />
												</div>
												<!--<div class="col-sm-2">
													<label for="location">Expiry Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="expiryDate" id="expiryDate"
														class="form-control form-control-sm"
														th:value="${#dates.format(list.expiryDate, 'yyyy-MM-dd')}"
														required readonly />

												</div>-->
												<div class="col-sm-2">
													<label for="location">Country Rating<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="countryRating" id="countryRating"
														th:value="${list.countryRating}"
														class="form-control form-control-sm" readonly />
												</div>
											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Regular Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="regularLimit" id="regularLimit"
														th:value="${list.regularLimit}"
														class="form-control form-control-sm" autocomplete="new-text"
														required readonly />
												</div>
												<div class="col-sm-2">
													<label for="location">Adhoc Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="adhocLimit" id="adhocLimit"
														th:value="${list.adhocLimit}"
														class="form-control form-control-sm" required readonly />
												</div>

											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Settlement Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="settlementLimit" id="settlementLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.settlementLimit}" readonly />
												</div>

												<div class="col-sm-2">
													<label for="location">Adhoc Limit Expiry Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="Date" name="Adhoc_Limit_exp_date"
														id="Adhoc_Limit_exp_date" class="form-control form-control-sm"
														required
														th:value="${#dates.format(list.Adhoc_Limit_exp_date, 'yyyy-MM-dd')}"
														readonly />
												</div>


											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">Credit Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="creditLimit" id="creditLimit"
														class="form-control form-control-sm" required
														th:value="${list.creditLimit}" readonly />
												</div>
												<div class="col-sm-2">
													<label for="location">Money Market Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="moneyMarketLimit" id="moneyMarketLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.moneyMarketLimit}" readonly />
												</div>



											</div>

											<div class="row formline">
												<div class="col-sm-auto"></div>

												<div class="col-sm-2">
													<label for="location">EAR Marking Date</label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="creditLimit" id="creditLimit"
														class="form-control form-control-sm" required
														th:value="${#dates.format(list.earmarkingdate, 'yyyy-MM-dd')}"
														readonly />
												</div>
												<div class="col-sm-2">
													<label for="location">EAR Marking Limit</label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="moneyMarketLimit" id="moneyMarketLimit"
														class="form-control form-control-sm" autocomplete="new-text"
														required th:value="${list.earmarkinglimit}" readonly />
												</div>



											</div>


											<div class="row formline">
												<div class="col-sm-auto"></div>
												<div class="col-sm-2">
													<label for="location">Trade Finance Limit<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="number" name="tradeFinanceLimit" id="tradeFinanceLimit"
														class="form-control form-control-sm" required
														th:value="${list.tradeFinanceLimit}" readonly />
												</div>
											</div>

										</div>

										<!--<div class="card-footer text-center">
									<button type="button" class="custom-tab-btn"
										 id="btnHome"
										onclick="home();">Home</button>
									<button type="button" class="custom-tab-btn"
										 id="btnBack"
										onclick="back();">Back</button>

								</div>-->
									</div>
								</div>
							</form>

						</div>
					</div>
				</div>
				<button id="floatingBackBtn" onclick="goBack()" title="Go Back">
					<i class="fa fa-arrow-left"></i>
				</button>
				<!-- Floating Forward Button -->
				<button id="floatingForwardBtn" onclick="goForward()" title="Go Forward">
					<i class="fa fa-arrow-right"></i>
				</button>




				<!-- Adhoc Limit Detail Modal -->
				<!-- Adhoc Limit Detail Modal -->
				<div class="modal fade" id="adhocDetailModal" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-xl" role="document">
						<div class="modal-content">
							<div class="modal-header" style="background-color: #7b6458; color: white;">
								<h5 class="modal-title">Adhoc Limit Entry Detail</h5>
								<button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<div class="table-responsive">
									<table class="table table-bordered table-sm" id="adhocDetailTable"
										style="font-size: 12px;">
										<thead style="background-color: #f4f2ef;">
											<tr class="text-center">
												<th style="width: 15%">Bank Code</th>
												<th style="width: 12%">Limit Type</th> <!-- Added -->
												<th style="width: 10%">Adhoc Limit</th>
												<th style="width: 12%">Adhoc Date</th>
												<th style="width: 12%">Expiry Date</th>
												<th style="width: 10%">Ear Mark Limit</th>
												<th style="width: 12%">Ear Mark Date</th>
												<th style="width: 12%">Reference</th>
												<th style="width: 10%">Roll Over</th> <!-- Changed to Yes/No -->
											</tr>
										</thead>
										<tbody>
											<!-- Dynamic rows injected here -->
										</tbody>
									</table>
								</div>
								<button type="button" class="btn btn-sm btn-info" onclick="addAdhocDetailRow()">
									<i class="fa fa-plus"></i> Add New Row
								</button>
							</div>
							<div class="modal-footer">
								<div class="mr-auto"><strong>Running Total: </strong><span
										id="adhocRunningTotal">0.00</span></div>
								<button type="button" class="btn btn-secondary btn-sm"
									data-dismiss="modal">Cancel</button>
								<button type="button" class="btn btn-primary btn-sm"
									onclick="confirmAdhocDetails()">Apply to Form</button>
							</div>
						</div>
					</div>
				</div>

				<div class="modal fade" id="alert">
					<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="menu-title-header">
								<div class="modal-title" id="exampleModalLabel"
									style="text-align: center; color: white;">BANK OF BARODA</div>
							</div>
							<div class="modal-body" style="text-align: center">
								<p id="alertmsg"></p>
								<button type="button" class="custom-tab-btn" onclick="back()"
									data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>

				<div id="bob-loader" class="bob-loader" aria-hidden="true" role="status" aria-label="Loading">
					<div class="bob-loader-card">
						<img th:src="@{/images/bobn.png}" alt="Bank of Baroda" class="logo-imgs">
						<div class="flow-bar">
							<div class="flow-line"></div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>


</body>

<style>
	/* Remove top margin/padding from DataTables parent containers */
	#data {
		padding-top: 0 !important;
		margin-top: 0 !important;
	}

	.table-responsive {
		margin-top: 0 !important;
		padding-top: 0 !important;
		max-height: 500px;
		/* Adjust this height as per your need (e.g., 60vh) */
		overflow-y: auto;
		overflow-x: auto;
		border: 1px solid #e8e8e8;
	}

	/* Ensure DataTables filter (search box) doesn't have spacing above it */
	div.dataTables_filter {
		margin-top: 0 !important;
		padding-top: 0 !important;
	}

	/* FIX: Make search label and box inline */
	.dataTables_filter label {
		display: flex !important;
		align-items: center;
		gap: 8px;
		/* space between text and input */
		margin-bottom: 0 !important;
	}

	/* Style pagination buttons */
	.dataTables_wrapper .dataTables_paginate .paginate_button {
		padding: 0px;
	}

	/* Optional: Style the search input */
	.dataTables_filter input {
		margin-left: 5px;
		flex: 1;
	}
</style>

</html>