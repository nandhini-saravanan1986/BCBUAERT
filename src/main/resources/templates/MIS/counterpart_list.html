<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
		th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/font-awesome/5.9.0/css/all.min.css"
		th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
		th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
		th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
	<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
	<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
	<link rel="stylesheet" th:href="@{/css/CustomButton.css}" />

	<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
		th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
	<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
		th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
	<script src="/webjars/jquery/3.4.1/jquery.min.js" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
	<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
		th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

	<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
		th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

	<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
		th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

	<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
	<script src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

	<style>
		

		  
		  	.dataTables_filter label {
		  display: flex !important;
		  align-items: center;
		  gap: 8px; /* space between text and input */
		  margin-bottom: 0 !important;
		}

		.dataTables_filter input {
		  margin-left: 5px;
		  flex: 1;
		}
		/* === ROLE PAGE CUSTOM HEADER === */
		.role-page-header {
			background-color: #ffffff;
			padding: 15px 20px;
		}

		.role-page-title h4 {
			color: #003366;
			font-family: "Segoe UI", Arial, sans-serif;
			font-size: 20px;
			font-weight: 700;
			margin: 0;
		}

		.role-page-underline {
			width: 158px;
			height: 3px;
			background-color: #0073e6;
			border-radius: 2px;
			margin-top: 6px;
			box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);
			/* soft glow below */
		}


		/* Add Button Styling */
		.role-add-btn {
			background: linear-gradient(135deg, #005fa3, #007bff);
			color: #fff;
			border: none;
			border-radius: 25px;
			padding: 8px 18px;
			font-size: 13px;
			font-weight: 600;
			cursor: pointer;
			box-shadow: 0 2px 5px rgba(0, 64, 128, 0.2);
			transition: all 0.3s ease;
		}

		.role-add-btn:hover {
			background: linear-gradient(135deg, #007bff, #3399ff);
			transform: translateY(-2px);
			box-shadow: 0 0 10px rgba(0, 102, 204, 0.4);
		}

		.role-add-btn i {
			margin-right: 5px;
		}
	</style>
	<script>
		function goBack() {
			window.history.back();
		}

		function goForward() {
			window.history.forward();
		}

		// Detect mouse near screen edges
		document.addEventListener('mousemove', function (e) {
			const backBtn = document.getElementById('floatingBackBtn');
			const forwardBtn = document.getElementById('floatingForwardBtn');
			const screenWidth = window.innerWidth;

			// Left edge (back)
			if (e.clientX < 50) {
				backBtn.classList.add('show');
			} else {
				backBtn.classList.remove('show');
			}

			// Right edge (forward)
			if (screenWidth - e.clientX < 50) {
				forwardBtn.classList.add('show');
			} else {
				forwardBtn.classList.remove('show');
			}
		});
	</script>

	<style>
		/* Shared styles for both buttons */
		#floatingBackBtn,
		#floatingForwardBtn {
			position: fixed;
			top: 50%;
			background-color: #0073e6;
			border: none;
			color: white;
			font-size: 20px;
			border-radius: 50%;
			width: 45px;
			height: 45px;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			pointer-events: none;
			transition: all 0.4s ease;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
			z-index: 999;
		}

		/* Back button */
		#floatingBackBtn {
			left: -50px;
			/* hidden off-screen */
		}

		/* Forward button */
		#floatingForwardBtn {
			right: -50px;
			/* hidden off-screen */
		}

		/* Show when near edge */
		#floatingBackBtn.show {
			left: 20px;
			opacity: 1;
			pointer-events: auto;
		}

		#floatingForwardBtn.show {
			right: 20px;
			opacity: 1;
			pointer-events: auto;
		}

		/* Hover animation */
		#floatingBackBtn:hover,
		#floatingForwardBtn:hover {
			background-color: #005bb5;
			transform: scale(1.1);
		}
	</style>
	<style>
		/* Red border for invalid inputs */
		input.error,
		select.error {
			border: 2px solid red !important;
		}

		/* Error message style */
		label.error {
			color: red !important;
			font-size: 0.85em;
			margin-top: 5px;
			display: block;
		}

		.underline {
			text-decoration: underline;
			color: #08a6f1;
			cursor: pointer;
		}

		.left-arrow-circle {
			width: 35px;
			height: 35px;
			border-radius: 50%;
			background-color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-right: 10px;
			transition: background-color 0.3s, transform 0.2s;
		}

		.left-arrow-circle i {
			color: rgb(107, 122, 143);
		}

		.left-arrow-circle:hover {
			background-color: rgb(107, 122, 143);
			cursor: pointer;
			transform: scale(1.05);
			border: 2px solid white;
		}

		.left-arrow-circle:hover i {
			color: white;
		}

		.white-text span {
			color: white !important;


		}
	</style>
	<style>
		body {
			font-family: 'Segoe UI', Arial, sans-serif;
			font-size: 14px;
			margin: 0;
			overflow-x: hidden;
			/* â›” Prevent full-page scroll */
		}

		.btns {
			float: right;
			margin: 5px;
		}

		.col-sm-5 {
			padding-bottom: 15px;
		}

		.list-body {
			padding: 0px;
		}

		.error {
			color: red;
			padding-left: 10px;
		}

		.formline {
			padding-bottom: 15px;
		}

		.btn-primary {
			background-color: #E77400;
			border-color: #0c0c0c;
		}


		#finusertb {
			width: 460px;
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button {
			padding: 0px;
		}
	</style>
	<style>
		.valids {
			color: green;
		}

		.invalids {
			color: red;
		}
	</style>
	<script th:inline="javascript">
		/*<![CDATA[*/




		function home() {
			location.href = 'Dashboard'
		}

		function back() {
			window.history.back();
		}



		function adduser() {


			location.href = 'counterparty_list?formmode=add';

		}

		function list() {
			location.href = 'counterparty_list?formmode=list';
		}



		/*]]>*/
	</script>

	<script>
		function deleteuser() {

			var entryuser = document.querySelector('[data-entry_user]');
			var modifyuser = document.querySelector('[data-modify_user]');

			if (confirm('Are you sure you want to delete this User?')) {
				$("#loader1").modal("toggle");
				var userid = document.getElementById("userId").value;
				$.ajax({
					type: 'post',
					url: './deleteuser?formmode=' + userid,
					success: function (response) {
						$("#loader1").modal("hide");
						$("#alertmsg").text('User Deleted');
						$('#alert').modal("toggle");
					},
					error: function (xhr, status, error) {
						$("#loader1").modal("hide");
						alert('Not able to delete contact administrator');
					}
				});
			}

		}
	</script>
	<script>
		function roledesc1() {

			var roleid = $("#roleId").find(':selected').val();

			if (roleid == 'VISAP1') {
				$("#roleDesc1").val("VISAP1");
			} else if (roleid == 'VISAR2') {
				$("#roleDesc1").val("VISAR2");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'CURINT4') {
				$("#roleDesc1").val("CURINT4");
			}
			$(this).find(':selected').text();

		}

		function brflogin() {

			var roleid = $("#roleId").find(':selected').val();

			if (roleid == 'VISAP1') {
				$("#roleDesc1").val("VISAP1");
			} else if (roleid == 'VISAR2') {
				$("#roleDesc1").val("VISAR2");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'RFI3') {
				$("#roleDesc1").val("RFI3");
			} else if (roleid == 'CURINT4') {
				$("#roleDesc1").val("CURINT4");
			}
			$(this).find(':selected').text();

		}

		function home() {
			location.href = "/MIS/Dashboard";
		}

		function back() {
			window.history.back();
		}
	</script>

	<script>
		function check_date() {
			var iBranchCode = $("#iBranchCode").val().trim();
			var iBranchName = $("#iBranchName").val().trim();
			var reportDate = $("#reportDate").val().trim();
			var fileInput = $("#file")[0].files[0];

			if (!iBranchCode || !iBranchName || !reportDate || !fileInput) {
				alert("All fields are required.");
				return;
			}

			$.ajax({
				url: "./search_date?reportDate=" + encodeURIComponent(reportDate) + "&iBranchCode=" + encodeURIComponent(iBranchCode) + "&mode=exposure",
				type: "GET",
				success: function (response) {
					console.log("Success:", response);
					if (response > 0) {
						$("#alertmsg1").text("Report already exists for the selected date.");
						$('#alert1').modal("toggle");
					} else {
						submitform();
					}
				},
				error: function (xhr, status, error) {
					console.error("Error:", error);
					$("#alertmsg").text("Error occurred: " + error);
					$('#alert').modal("toggle");
				}
			});
		}



		function submitform() {
			var iBranchCode = $("#iBranchCode").val().trim();
			var iBranchName = $("#iBranchName").val().trim();
			var reportDate = $("#reportDate").val().trim();
			var fileInput = $("#file")[0].files[0];

			if (!iBranchCode || !iBranchName || !reportDate || !fileInput) {
				alert("All fields are required.");
				return;
			}

			let formData = new FormData();
			formData.append("iBranchCode", iBranchCode);
			formData.append("iBranchName", iBranchName);
			formData.append("reportDate", reportDate);
			formData.append("file", fileInput);
			formData.append("uploadedBy", $("#uploadedBy").val());
			$("#loader1").modal("toggle");
			$.ajax({
				url: "./Add_ASL?mode=exposure",
				type: "POST",
				data: formData,
				contentType: false,
				processData: false,
				success: function (response) {
					$("#loader1").modal("hide");
					console.log("Success:", response);
					$("#alertmsg").text(response);
					$('#alert').modal("toggle");
				},
				error: function (xhr, status, error) {
					$("#loader1").modal("hide");
					console.error("Error:", error);
					$("#alertmsg").text("Error occurred: " + error);
					$('#alert').modal("toggle");
				}
			});
		}

		function ignore() {


			$("#alertmsg1").text("");
			$("#alert1").modal("hide");
		}
		function replace() {
			$("#alertmsg1").text("");
			$("#alert1").modal("hide");

			var iBranchCode = $("#iBranchCode").val().trim();
			var iBranchName = $("#iBranchName").val().trim();
			var reportDate = $("#reportDate").val().trim();
			var fileInput = $("#file")[0].files[0];

			if (!iBranchCode || !iBranchName || !reportDate || !fileInput) {
				alert("All fields are required.");
				return;
			}

			let formData = new FormData();
			formData.append("iBranchCode", iBranchCode);
			formData.append("iBranchName", iBranchName);
			formData.append("reportDate", reportDate);
			formData.append("file", fileInput);
			formData.append("uploadedBy", $("#uploadedBy").val());
			$("#loader1").modal("toggle");
			$.ajax({
				url: "./Replace_data?mode=exposure",
				type: "POST",
				data: formData,
				contentType: false,
				processData: false,
				success: function (response) {
					$("#loader1").modal("hide");
					console.log("Success:", response);
					$("#alertmsg").text(response);
					$('#alert').modal("toggle");
				},
				error: function (xhr, status, error) {
					$("#loader1").modal("hide");
					console.error("Error:", error);
					$("#alertmsg").text("Error occurred: " + error);
					$('#alert').modal("toggle");
				}
			});


		}

	</script>

	<script th:inline="javascript">
		/*<![CDATA[*/
		var counterlist = /*[[${counterlist}]]*/[];

		function validatelis(inputElem) {
			var inputVal = inputElem.value.trim().toLowerCase();
			var exists = false;
			var matches = [];

			// Reset previous suggestions
			$("#bankSuggestions").empty().hide();

			// Check for match and collect suggestions
			counterlist.forEach(function (item) {
				if (item.toLowerCase() === inputVal) {
					exists = true;
				} else if (item.toLowerCase().includes(inputVal) && inputVal !== "") {
					matches.push(item);
				}
			});

			// Show tooltip if exists
			if (exists) {
				$("#bankExistsMsg").show();
				$("#generatebtn").hide();
			} else {
				$("#bankExistsMsg").hide();
				$("#generatebtn").show();
			}

			// Show suggestions dropdown
			if (matches.length > 0) {
				matches.forEach(function (suggestion) {
					$("#bankSuggestions").append(
						"<div class='suggestion-item' style='padding: 5px; cursor: pointer;'>" +
						suggestion + "</div>"
					);
				});
				$("#bankSuggestions").show();
			}
		}

		// Handle click on suggestion
		$(document).on("click", ".suggestion-item", function () {
			$("#counterPartyBank").val($(this).text());
			$("#bankSuggestions").hide();
			validatelis(document.getElementById("counterPartyBank")); // re-validate after selection
		});

		// Hide suggestions if clicked outside
		$(document).click(function (e) {
			if (!$(e.target).closest("#counterPartyBank, #bankSuggestions").length) {
				$("#bankSuggestions").hide();
			}
		});
		/*]]>*/
	</script>
	<style>
		.page-item.active .page-link {
			z-index: 1;
			color: #fff;

			border-color: darkorange;
		}

		.btn {
			font-size: unset !important;
		}

		.container-fluid {

			width: 100%;
			padding-top: 1px;
			padding-right: 0px !important;
			padding-left: 0px !important;
			margin-right: auto;
			margin-left: auto;
		}
	</style>


	<script th:inline="javascript">
		/*<![CDATA[*/
		var currentBranch = /*[[${currentBranch}]]*/ '';
		//alert(currentBranch)
		document.addEventListener("DOMContentLoaded", function () {
			if (currentBranch) {
				const buttons = document.querySelectorAll('.branch-button');
				buttons.forEach(btn => {
					if (btn.getAttribute('data-branch').trim() === currentBranch.trim()) {
						btn.classList.add('active'); // Optional: visually show it's selected
						btn.click(); // Trigger the function
					}
				});
			}
		});
		/*]]>*/
	</script>
	<script>

		$(document).ready(function () {
			// Initialize once on page load and store the instance
			$('#usertable').DataTable({
				scrollX: true,
				autoWidth: false,
				paging: true,
				searching: true,
				lengthChange: false,
				ordering: true,
				pageLength: 10,
				fixedHeader: true,

				// ðŸ‘‡ Top row: search (left) + pagination (right)
				dom: '<"d-flex justify-content-between align-items-center mb-2"f p>t'
			});

			$('#reportDate').on('change', function () {
				const reportDate = this.value;

				// Get the active branch button's data-branch attribute
				const activeBranchBtn = document.querySelector('.branch-button.active');
				const selectedBranch = activeBranchBtn ? activeBranchBtn.getAttribute('data-branch') : '';

				$.ajax({
					type: 'GET',
					url: './getExplosure_datas',
					data: {
						reportDate: reportDate,
						selected_branch: selectedBranch
					},
					success: function (data) {
						table.clear(); // clear existing data

						data.forEach(row => {
							// Provide default values for missing or empty fields
							table.row.add([
								`<div style="text-align:center;">${row.formattedDate || ''}</div>`,
								row.counterpartyBankName || '',
								formatNumber(row.buyersCredit) || '0.00',
								formatNumber(row.foreignBillDiscounting) || '0.00',
								formatNumber(row.localBillDiscounting) || '0.00',
								formatNumber(row.guaranteeSblcs) || '0.00',
								formatNumber(row.syndicatedLoansInvestment) || '0.00',
								formatNumber(row.others) || '0.00',
								row.remarks || '',
								row.total || '0.00',
								row.iBranchCode || '',
								row.iBranchName || ''
							]);
						});

						table.draw(); // redraw table with new data
					},
					error: function (xhr, status, error) {
						console.error('AJAX error:', status, error);
						alert('Error fetching data!');
					}
				});
			});
		});


	</script>
	<script>
		$(document).ready(function () {
			// Handle branch button click
			$('.branch-button').on('click', function () {
				// Remove active class from all buttons
				$('.branch-button').removeClass('active');

				// Add active class to clicked button
				$(this).addClass('active');

				// Get selected branch
				const selectedBranch = $(this).data('branch');



				// Send AJAX request
				$.ajax({
					type: 'GET',
					url: './getExploreDataBranch',
					data: {
						selected_branch: selectedBranch // Must match controller param name
					},
					success: function (data) {
						const table = $('#usertable').DataTable();
						table.clear();

						data.forEach(row => {
							// Provide default values for missing or empty fields
							table.row.add([
								`<div style="text-align:center;">${row.formattedDate || ''}</div>`,
								row.counterpartyBankName || '',
								formatNumber(row.buyersCredit) || '0.00',
								formatNumber(row.foreignBillDiscounting) || '0.00',
								formatNumber(row.localBillDiscounting) || '0.00',
								formatNumber(row.guaranteeSblcs) || '0.00',
								formatNumber(row.syndicatedLoansInvestment) || '0.00',
								formatNumber(row.others) || '0.00',
								row.remarks || '',
								row.total || '0.00',
								row.iBranchCode || '',
								row.iBranchName || ''
							]);
						});

						table.draw();
						if (selected_branch) {
							const buttons = document.querySelectorAll('.branch-button');
							buttons.forEach(btn => {
								if (btn.getAttribute('data-branch').trim() === selected_branch.trim()) {
									btn.classList.add('active'); // Optional: visually show it's selected
									btn.click(); // Trigger the function
								}
							});
						}
					},
					error: function (xhr, status, error) {
						console.error('AJAX error:', status, error);
						alert('Error fetching data!');
					}
				});
			});
		});

		function formatNumber(value) {
			let num = parseFloat(value || 0);
			return num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
		}






	</script>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const today = new Date().toISOString().split('T')[0];
			document.getElementById('reportDate').value = today;
		});

		function Branchcodeval() {
			var code = document.getElementById('iBranchCode').value;

			switch (code) {
				case '9001': $("#iBranchName").val("Dubai"); break;
				case '9002': $("#iBranchName").val("Abu Dhabi"); break;
				case '9003': $("#iBranchName").val("Deira"); break;
				case '9004': $("#iBranchName").val("Sharja"); break;
				case '9005': $("#iBranchName").val("Ras Alkaima"); break;
				case '9008': $("#iBranchName").val("Syndication"); break;
				case '9010': $("#iBranchName").val("Treasury"); break;
				case '9019': $("#iBranchName").val("DFC"); break;
				default: $("#iBranchName").val(""); // clear if not matched
			}
		}

	</script>



	<script>
		let selectedBranch = "";

		function selectBranch(branch) {
			selectedBranch = branch; // Store selected branch globally
			console.log("Selected branch:", selectedBranch);
		}

		function Exposure_sheet() {
			var ReportDate = $("#reportDate").val().trim();
			console.log(ReportDate, selectedBranch);
			if (ReportDate === "") {
				alert("Please enter Report Date.");
				$("#ReportDate").focus();
				return;
			}

			if (selectedBranch === "") {
				alert("Please select branch.");
				return;
			}

			// Download file with selected branch and date
			window.location.href = './download/Exposure?ReportDate=' + ReportDate + '&branch=' + selectedBranch;
		}
	</script>


	<script>
		function get_branch() {
			var code = document.getElementById('iBranchCode').value;
			alert(code)

			$.ajax({
				type: 'GET',
				url: './getbranch', // or './getbranch' if that's the actual endpoint
				data: {selected_branch: code}, // corrected key-value
				success: function (data) {
					//alert(data)
					document.getElementById('iBranchName').value = data;
				},
				error: function () {
					alert("Failed to fetch branch name.");
				}
			});
		}



	</script>

	<script>
		/**
		 * Format a number with comma separators and 2 decimal places
		 */
		function formatAmount(value) {
			if (!value || isNaN(value)) return "0.00";
			return Number(value).toLocaleString('en-US', {
				minimumFractionDigits: 2,
				maximumFractionDigits: 2
			});
		}

		/**
		 * Parse formatted value back to float
		 */
		function parseAmount(formattedValue) {
			if (!formattedValue) return 0;
			return parseFloat(formattedValue.replace(/,/g, '')) || 0;
		}

		/**
		 * Attach event listeners to all amount fields
		 */
		document.addEventListener('input', function (e) {
			if (e.target.classList.contains('amount-field')) {
				let val = e.target.value.replace(/,/g, '');
				val = val.replace(/[^\d.]/g, ''); // allow only numbers and decimal
				e.target.value = val;
			}
		});

		document.addEventListener('blur', function (e) {
			if (e.target.classList.contains('amount-field')) {
				const formatted = formatAmount(parseAmount(e.target.value));
				e.target.value = formatted;

				// recalculate row total after blur
				calculateRowTotal(e.target.closest('tr'));
			}
		}, true);

		/**
		 * Calculate the total of amount fields in a single row
		 */
		function calculateRowTotal(row) {
			if (!row) return;

			let total = 0;
			const amountFields = row.querySelectorAll('input.amount-field:not([name="total"])');
			amountFields.forEach(field => {
				total += parseAmount(field.value);
			});

			const totalField = row.querySelector('input[name="total"]');
			if (totalField) {
				totalField.value = formatAmount(total);
			}
		}

		/**
		 * On page load: format all amount fields with default values
		 */
		window.addEventListener('DOMContentLoaded', () => {
			document.querySelectorAll('.amount-field').forEach(field => {
				field.value = formatAmount(parseAmount(field.value));
			});
		});

	</script>

	<script th:inline="javascript">
		function Exposure_manual_entry(a) {

			var formmode = a.getAttribute("formmode");
			var WORKCLASS = /*[[${session.WORKCLASS}]]*/null;

			if (formmode == 'Addbilldetail') {
				if (WORKCLASS != 'M') {
					alert('Permission denied. You are not authorized to create a bill.');
					return;
				}
			}

			location.href = "counterparty_list?formmode=" + formmode;
		}

		function movetolistpage() {
			location.href = "counterparty_list?formmode=Billdetaillist";
		}

		function modifyRow(a) {

			var formmode = a.getAttribute("formmode");
			var Exposurebillid = a.getAttribute("data-billid");

			var WORKCLASS = /*[[${session.WORKCLASS}]]*/null;

			if (formmode == 'Editbilldetail') {
				if (WORKCLASS != 'M') {
					alert('Permission denied. You are not authorized to Modify a bill.');
					return;
				}
			}

			location.href = "counterparty_list?formmode=" + formmode + '&Exposurebillid=' + Exposurebillid;
		}

		function deleteRow(a) {

			var formmode = a.getAttribute("formmode");
			var Exposurebillid = a.getAttribute("data-billid");

			var WORKCLASS = /*[[${session.WORKCLASS}]]*/null;

			if (formmode == 'Addbilldetail') {
				if (WORKCLASS != 'C') {
					alert('Permission denied. You are not authorized to Verify a bill.');
					return;
				}
			}

			location.href = "counterparty_list?formmode=" + formmode + '&Exposurebillid=' + Exposurebillid;
		}

		function confirmSubmit(button) {
			// Get the form element
			const form = document.getElementById("billdataForm");

			// Get the formmode from the button's data attribute
			const formmode = button.getAttribute("data-formmode");

			var USERID = /*[[${session.USERID}]]*/null;

			if (formmode == 'Verifybilldetail') {

				const modifyuser = button.getAttribute("data-modifyuser");
				const entryuser = button.getAttribute("data-entryuser");
				if (modifyuser == USERID || entryuser == USERID) {
					alert('Verification denied â€” the creator cannot verify their own entry.')
					return;
				}

			}
			if ($("#billdataForm").valid()) {
				$('#loader1').modal("toggle");
				// Create FormData object
				const formData = new FormData(form);

				$.ajax({
					url: "./Exposurebillservice?formmode=" + formmode,
					type: "POST",
					data: formData,
					processData: false,
					contentType: false,
					dataType: "text",
					success: function (response) {
						$('#loader1').hide();
						alert(response);
						location.href = "counterparty_list?formmode=Billdetaillist";
					},
					error: function (xhr, status, error) {
						$('#loader1').hide();
						alert(status + error);

					}
				});
			}
		}

		// Function to show alert when user focuses on bank select
		function showBankAlert() {
			document.getElementById("bankAlert").style.display = "block";
		}

		// Function to hide alert when user clicks anywhere else
		function hideBankAlert(event) {
			const bankSelect = document.getElementById("name_of_the_bank");
			const alertDiv = document.getElementById("bankAlert");

			// If the clicked element is NOT the bank select, hide alert
			if (event.target !== bankSelect) {
				alertDiv.style.display = "none";
			}
		}

		// Attach listeners after page load
		document.addEventListener("DOMContentLoaded", function () {
			const bankSelect = document.getElementById("name_of_the_bank");

			if (bankSelect) {
				bankSelect.addEventListener("focus", showBankAlert);
				document.addEventListener("click", hideBankAlert);
			}
		});
	</script>

</head>
<title>Riskinsights - ASL</title>

<body>
	<div >
		<div class="row">
			<div th:insert="XBRLHeaderMenu :: header"></div>
			<div class="col-sm-12">

				<div th:if="${formmode}=='list'">

					<div class="card">
						<div class="role-page-header d-flex justify-content-between align-items-center">
							<!-- Left: Page Title -->
							<div class="role-page-title">
								<h5 th:text="${menu}" style="  font-weight: bold; padding-top: 10px;"></h5>
								<div style="width: 200px;
											    height: 3px;
											    background-color: #0073e6;
											    border-radius: 2px;
											    margin-top: 6px;
											    box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);"></div>
							</div>

							<div class="form-inline">
								<label for="reportDate" class="mr-2">Report Date:</label> <input type="date"
									id="reportDate" name="reportDate" class="form-control form-control-sm" />
								<button type="button" class="role-add-btn ml-3"
									onclick="Exposure_sheet()">Download</button>
							</div>
						</div>



						<div class="row">
							<div class="col-sm-12">
								<br>

								<div class="row formline">
									<div class="col-auto"></div>
									<!-- Dynamically generate buttons -->

									<!-- Static Branch Buttons -->
									<div class="col-auto">
										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9001' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Dubai" onclick="selectBranch('Dubai')">Dubai</button>

										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9002' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Abu Dhabi" onclick="selectBranch('Abu Dhabi')">Abu
											Dhabi</button>

										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9003' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Deira" onclick="selectBranch('Deira')">Deira</button>

										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9004' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Sharja" onclick="selectBranch('Sharja')">Sharja</button>

										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9005' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Ras Alkaima" onclick="selectBranch('Ras Alkaima')">Ras
											Alkaima</button>

										<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
											th:if="${BRANCHCODE == '9006' or ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}"
											data-branch="Syndication"
											onclick="selectBranch('Syndication')">Syndication</button>
									</div>


									<!--<div class="col-auto" th:each="branch : ${branchesl}">
								<button type="button" class="custom-tab-btn btn-sm m-1 branch-button"
									 th:attr="data-branch=${branch}" id="branch_button"
									th:text="${branch}" 
									style="border-color: #6B7A8F;"
									 onclick="selectBranch(this.getAttribute('data-branch'))">
								</button>
							</div>-->
								</div>


								<div class="col-sm-12">
														<div class="table-container" style="padding: 0px 15px;"> 
														     <table class="table table-striped table-bordered table-hover"
														         id="usertable" style="font-size: 12px;">
														         <thead style="background-color: #e9ecf0; font-family: verdana;"class="thead-light">
															<tr>
												<!--Exposuredetailtable-->
												<th style="white-space: nowrap;">Report Date</th>
												<th style="white-space: nowrap;">CounterParty Bank</th>
												<th style="white-space: nowrap;">Buyers Credit</th>
												<th style="white-space: nowrap;">Foreign Bill Discount</th>
												<th style="white-space: nowrap;">Local Bill Discount</th>
												<th style="white-space: nowrap;">Guarantee SBLCS</th>
												<th style="white-space: nowrap;">Syndicated Loans Investment</th>
												<th style="white-space: nowrap;">Others</th>
												<th style="white-space: nowrap;">Remarks</th>
												<th style="white-space: nowrap;">Total</th>
												<th style="white-space: nowrap;">Branch Code</th>
												<th style="white-space: nowrap;">Branch Name</th>
											</tr>
										</thead>
										<tbody id="tableBody">
											<tr th:each="lists : ${listall}" style="cursor: pointer;">
												<td style=" text-align: center"
													th:text="${#dates.format(lists.reportDate, 'dd-MM-yyyy')}"></td>
												<td th:text="${lists.counterpartyBankName}"></td>
												<td th:text="${#numbers.formatDecimal(lists.buyersCredit, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.foreignBillDiscounting, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.localBillDiscounting, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.guaranteeSblcs, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.syndicatedLoansInvestment, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${#numbers.formatDecimal(lists.others, 0, 'COMMA', 2, 'POINT')}"
													style="text-align: right;"></td>
												<td th:text="${lists.remarks}"></td>
												<td th:text="${lists.total}"></td>
												<td th:text="${lists.iBranchCode}"></td>
												<td th:text="${lists.iBranchName}"></td>
											</tr>
										</tbody>
									</table>
								</div>

								<!--<div class="card-footer text-center">
									<button type="button" class="custom-tab-btn" id="btnHome"
										onclick="home();">Home</button>
									<button type="button" class="custom-tab-btn" id="btnBack"
										onclick="back();">Back</button>
								</div>-->
							</div>
						</div>
					</div>
				</div>
				<div th:if="${formmode}=='add'">
					<div class="row">
						<div class="col-sm-12 ">
							<form action="#" method="post" autocomplete="off" id="ASL_report"
								enctype="multipart/form-data">
								<div class="card">

									<div class="role-page-header d-flex justify-content-between align-items-center">
										<!-- Left: Page Title -->
										<div class="role-page-title">
											<h4 th:text="${menu}"></h4>
											<div style="width: 265px;
											    height: 3px;
											    background-color: #0073e6;
											    border-radius: 2px;
											    margin-top: 6px;
											    box-shadow: 0 4px 12px rgba(0, 115, 230, 0.6);"></div>
										</div>

										<!-- Right: Add Button -->
										<div>
											<button type="button" class="role-add-btn"
												onclick="window.location.href='./download/excel?mode=exposure'">
												Template Download</button>

											<button type="button" th:attr="formmode=Billdetaillist"
												onclick="Exposure_manual_entry(this);" class="role-add-btn">Add
												Exposure Details</button>
										</div>
									</div>
									<div class="card-body">

										<input autocomplete="false" name="hidden" type="text" style="display: none;">
										<div class="form-group">
											<!-- Branch Code Row -->
											<div class="row formline">
												<div class="col-sm-3"></div>

												<div class="col-sm-2">
													<label for="iBranchCode">Branch Code <b
															style="color: red;">*</b></label>
												</div>

												<!-- For ADM: editable input with datalist -->
												<div class="col-sm-3"
													th:if="${ROLEID == 'ADM-M' or ROLEID == 'ADM-C' or ROLEID == 'MGR'}">
													<input type="text" id="iBranchCode" name="iBranchCode"
														class="form-control form-control-sm" list="branchCodeList"
														autocomplete="off" th:value="${BRANCHCODE}" required
														oninput="Branchcodeval()" />
													<datalist id="branchCodeList">
														<option value="9001">9001</option>
														<option value="9002">9002</option>
														<option value="9003">9003</option>
														<option value="9004">9004</option>
														<option value="9005">9005</option>
														<option value="9008">9008</option>
														<option value="9009">9009</option>
														<option value="9010">9010</option>
													</datalist>
												</div>

												<!-- For non-ADM: readonly input -->
												<div class="col-sm-3"
													th:if="${ROLEID != 'ADM-M' AND ROLEID != 'ADM-C' AND ROLEID != 'MGR'}">
													<input type="text" id="iBranchCode" name="iBranchCode"
														class="form-control form-control-sm" th:value="${BRANCHCODE}"
														readonly />
												</div>
											</div>

											<!-- Branch Name Row -->
											<div class="row formline">
												<div class="col-sm-3"></div>

												<div class="col-sm-2">
													<label for="iBranchName">Branch Name <b
															style="color: red;">*</b></label>
												</div>

												<div class="col-sm-3 position-relative">
													<input type="text" id="iBranchName" name="iBranchName"
														class="form-control form-control-sm" th:value="${BRANCHNAME}"
														readonly />
												</div>
											</div>

											<div class="row formline">
												<div class="col-sm-3"></div>
												<div class="col-sm-2">
													<label for="file">File<b style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="file" name="file" id="file"
														class="form-control form-control-sm" autocomplete="new-text"
														required />
												</div>
											</div>
											<div class="row formline">
												<div class="col-sm-3"></div>
												<div class="col-sm-2">
													<label for="uploadedBy">Uploaded By<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="text" name="uploadedBy" id="uploadedBy"
														class="form-control form-control-sm" required
														th:value="${userid}" readonly />
												</div>
											</div>
											<div class="row formline">
												<div class="col-sm-3"></div>
												<div class="col-sm-2">
													<label for="reportDate">Report Date<b
															style="color: red;">*</b></label>
												</div>
												<div class="col-sm-3">
													<input type="date" name="reportDate" id="reportDate"
														class="form-control form-control-sm" required />
												</div>
											</div>
										</div>
										<div class="card-footer text-center">
											<button type="button" class="role-add-btn" id="generatebtn"
												onclick="check_date();">Submit</button>

										</div>
									</div>
								</div>
							</form>

						</div>
					</div>
				</div>

				<div th:if="${formmode}=='Billdetaillist'">
					<div class="card">


						<div class="role-page-header d-flex justify-content-between align-items-center">
							<!-- Left: Page Title -->
							<div class="role-page-title">
								<h4 th:text="${'Exposure Details'}"></h4>
								<div class="role-page-underline"></div>
							</div>

							<div>
								<button type="button" id="addrow" class="role-add-btn" th:attr="formmode=Addbilldetail"
									onclick="Exposure_manual_entry(this);">
									<i class="fa fa-plus-circle"></i> Add Bill
								</button>
							</div>
						</div>

						<div class="table-responsive" style="max-height: 600px; overflow-y: auto; padding-right: 15px;">
							<table class="table table-bordered  table-hover table-sm">
								<!--Exposuredetailtable-->
								<thead class="thead-light">
									<th></th>
									<th></th>
									<th>Srl No</th>
									<th>Branch Name</th>
									<th>Country of Exposure</th>
									<th>Date of Loan</th>
									<th>Trade Loan (USD)</th>
									<th>Trade Loan (Equiv AED)</th>
									<th>Interest Rate</th>
									<th>Bill Due Date</th>
									<th>Name of the Bank</th>
									<th>Bill Id</th>
									<th>Customer Name</th>
									<th>Account No</th>
									<th>Bill Expiry Status</th>
									<th>Verification Status</th>
								</thead>


								<tbody id="BillDataBody">
									<tr th:each="billdata : ${Activebilldetails}">
										<td><button class="btn btn-warning btn-sm"
												th:attr="formmode=Editbilldetail, data-billid=${billdata.srl_no}"
												onclick="modifyRow(this)">
												<i class="fa fa-pen"></i></button></td>
										<td><button class="btn btn-danger btn-sm"
												th:attr="formmode=Deletebilldetail, data-billid=${billdata.srl_no}"
												onclick="deleteRow(this)">
												<i class="fa fa-trash"></i></button></td>
										<td th:text="${billdata.srl_no}"></td>
										<td th:text="${billdata.branch_name}"></td>
										<td th:text="${billdata.country}"></td>
										<td th:text="${#dates.format(billdata.date_of_loan,'dd-MM-yyyy')}"></td>
										<td th:text="${#numbers.formatDecimal(billdata.trade_loan_amt_usd, 0, 'COMMA', 2, 'POINT')}"
											style="text-align: right;">
										</td>
										<td th:text="${#numbers.formatDecimal(billdata.trade_loan_amt_eq_aed, 0, 'COMMA', 2, 'POINT')}"
											style="text-align: right;">
										</td>
										<td th:text="${billdata.interest_rate}"></td>
										<td th:text="${#dates.format(billdata.due_date,'dd-MM-yyyy')}"></td>
										<td th:text="${billdata.name_of_the_bank}"></td>
										<td th:text="${billdata.bill_id}"></td>
										<td th:text="${billdata.customer_name}"></td>
										<td th:text="${billdata.account_no}"></td>
										<td th:text="${billdata.bill_status}"></td>
										<td th:text="*{billdata.entry_flg == 'Y' and billdata.modify_flg == 'N' and billdata.verify_flg == 'N' ? 'New Bill Verification Pending' : 
										               (billdata.entry_flg == 'Y' and billdata.modify_flg == 'Y' and billdata.verify_flg == 'N' ? 'Modified Bill Verification Pending' : 
										               (billdata.entry_flg == 'Y' and billdata.modify_flg == 'N' and billdata.verify_flg == 'Y' ? 'Verified Bill' : 'Unknown')) }"
											th:classappend="*{ billdata.entry_flg == 'Y' and billdata.modify_flg == 'N' and billdata.verify_flg == 'N' ? 'bg-danger text-white' : 
										                     (billdata.entry_flg == 'Y' and billdata.modify_flg == 'Y' and billdata.verify_flg == 'N' ? 'bg-warning text-dark' : 
										                     (billdata.entry_flg == 'Y' and billdata.modify_flg == 'N' and billdata.verify_flg == 'Y' ? 'bg-success text-white' : 'bg-info text-dark')) }"
											class="rounded border text-center"
											style="font-weight: bold; border-radius: 10px;"
											th:attr="formmode=Verifybilldetail, data-billid=${billdata.srl_no}"
											onclick="deleteRow(this)">
										</td>
									</tr>
								</tbody>

							</table>

						</div>


					</div>

				</div>

				<div th:if="${formmode}=='Addbilldetail' or ${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail'
					 or ${formmode}=='Verifybilldetail'">
					<div class="card">
						<!-- Header Section -->
						<div class="card-header d-flex justify-content-between align-items-center flex-wrap">
							<div class="float-left">
								<div style="display: flex; align-items: center;" onclick="back();">
									<!-- Back Icon -->
									<div class="left-arrow-circle">
										<i class="fa fa-arrow-left"></i>
									</div>
									<h5 th:text="${menuname}" style=" font-weight: bold; padding-top: 10px;"></h5>
								</div>
							</div>
							<div class="form-inline">
								<!-- Button to switch to list view -->
								<button type="button" id="viewListBtn" class="custom-tab-btn"
									th:attr="formmode=Billdetaillist" onclick="Exposure_manual_entry(this);">
									<i class="fa fa-list"></i> View List
								</button>
							</div>
						</div>

						<!-- Form Section -->
						<div class="card-body"
							th:if="${formmode=='Deletebilldetail' or formmode=='Addbilldetail' or formmode=='Editbilldetail' or formmode=='Verifybilldetail'}">

							<form action="#" th:object="${billdata}" method="post" autocomplete="off" id="billdataForm"
								th:fragment="finuserapply">
								<div class="form-group">

									<!-- Srl No and Branch Name Row -->
									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">S No</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="srl_no" id="srl_no" th:value="${billdata?.srl_no}"
												class="form-control form-control-sm" maxlength="50" required readonly />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="srl_no" th:value="${billdata?.srl_no}"
												class="form-control form-control-sm" maxlength="50" th:readonly="${formmode}=='Deletebilldetail' or ${formmode}=='Editbilldetail'
												or ${formmode}=='Verifybilldetail'" required />
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Branch Name</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<select id="branch_name" name="branch_name" th:field="*{branch_name}"
												th:value="${branch_name}" class="form-control form-control-sm"
												autocomplete="off" required>
												<option value="" selected disabled>Select</option>
												<option value="Dubai">9001 - Dubai</option>
												<option value="Abu Dhabi">9002 - Abu Dhabi</option>
												<option value="Deira">9003 - Deira</option>
												<option value="Sharjha">9004 - Sharjha</option>
												<option value="Ral Al Khaimah">9005 - Ral Al Khaimah</option>
												<option value="Syndication">9008 - Syndication</option>
											</select>
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<select th:field="*{branch_name}" th:value="${branch_name}" id="branch_name"
												name="branch_name" class="form-control form-control-sm"
												autocomplete="off" required
												th:readonly="${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
												<option value="" selected disabled>Select</option>
												<option value="Dubai">9001 - Dubai</option>
												<option value="Abu Dhabi">9002 - Abu Dhabi</option>
												<option value="Deira">9003 - Deira</option>
												<option value="Sharjha">9004 - Sharjha</option>
												<option value="Ral Al Khaimah">9005 - Ral Al Khaimah</option>
												<option value="Syndication">9008 - Syndication</option>
											</select>
										</div>

										<div class="col-sm-1"></div>
									</div>

									<!-- Add other fields here in similar row structure (Country, Date, Bank etc.) -->

									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">Country of Exposure</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="country" id="country"
												class="form-control form-control-sm" maxlength="50" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="country" th:value="${billdata?.country}"
												class="form-control form-control-sm" maxlength="50" required
												th:readonly="${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Date of loan</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="date" name="date_of_loan" id="date_of_loan"
												th:value="${#dates.format(billdata.date_of_loan,'yyyy-MM-dd')}"
												class="form-control form-control-sm" maxlength="100" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="date" name="date_of_loan"
												th:value="${#dates.format(billdata.date_of_loan,'yyyy-MM-dd')}"
												class="form-control form-control-sm" maxlength="100" required
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>
									</div>

									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">Trade loan amount USD (Mn)</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="trade_loan_amt_usd" id="trade_loan_amt_usd"
												oninput="this.value = this.value
											    .replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1').replace(/^(\d+)(\.\d{0,2})?.*$/, '$1$2');"
												class="form-control form-control-sm" maxlength="50" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="trade_loan_amt_usd"
												th:value="${billdata.trade_loan_amt_usd}"
												class="form-control form-control-sm" maxlength="50" required oninput="this.value = this.value
												.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1').replace(/^(\d+)(\.\d{0,2})?.*$/, '$1$2');"
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Trade loan amount Eq AED
											(Optional)</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="trade_loan_amt_eq_aed" id="trade_loan_amt_eq_aed"
												oninput="this.value = this.value
												.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1').replace(/^(\d+)(\.\d{0,2})?.*$/, '$1$2');"
												class="form-control form-control-sm" maxlength="100" />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="trade_loan_amt_eq_aed"
												th:value="${billdata.trade_loan_amt_eq_aed}"
												class="form-control form-control-sm" maxlength="100" oninput="this.value = this.value
												.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1').replace(/^(\d+)(\.\d{0,2})?.*$/, '$1$2');"
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>
									</div>

									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">Interest Rate</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="number" name="interest_rate" id="interest_rate"
												class="form-control form-control-sm" maxlength="6" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="number" name="interest_rate"
												th:value="${billdata?.interest_rate}"
												class="form-control form-control-sm" max="6" required
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Due Date</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="date" name="due_date" id="due_date"
												class="form-control form-control-sm"
												th:value="${#dates.format(billdata?.due_date, 'yyyy-MM-dd')}"
												required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="date" name="due_date"
												th:value="${#dates.format(billdata.due_date,'yyyy-MM-dd')}"
												class="form-control form-control-sm" required
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>
									</div>

									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">Name of the Bank</label>

										<!-- For Add mode -->
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<select id="name_of_the_bank" name="name_of_the_bank" required
												class="form-control form-control-sm">
												<option value="" disabled selected>Select Bank</option>
												<option th:each="countpartyname : ${Counterpartynamelist}"
													th:value="${countpartyname}" th:text="${countpartyname}">
												</option>
											</select>

											<div th:if="${formmode}=='Addbilldetail'" id="bankAlert"
												class="alert alert-warning small" role="alert" style="display: none;">
												<i class="fas fa-exclamation-triangle"></i> Showing list of Banks having
												the limit. If your bank is missing contact Risk Management
											</div>
										</div>

										<!-- For Edit / Verify / View modes -->
										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">

											<select th:field="*{name_of_the_bank}" id="name_of_the_bank"
												class="form-control form-control-sm"
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'"
												required>
												<option value="" disabled>Select Bank</option>
												<option th:each="countpartyname : ${Counterpartynamelist}"
													th:value="${countpartyname}" th:text="${countpartyname}">
												</option>
											</select>

											<div th:if="${formmode}=='Editbilldetail'" id="bankAlert"
												class="alert alert-warning small" role="alert" style="display: none;">
												<i class="fas fa-exclamation-triangle"></i> Showing list of Banks having
												the limit. If your bank is missing
												contact Risk Management
											</div>
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Bill Number</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="bill_id" id="bill_id"
												onkeyup="this.value = this.value.toUpperCase();"
												class="form-control form-control-sm" maxlength="100" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="bill_id" th:value="${billdata?.bill_id}" required
												class="form-control form-control-sm" maxlength="100"
												onkeyup="this.value = this.value.toUpperCase();"
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>
									</div>

									<div class="row formline mb-3">
										<!-- S No -->
										<label class="col-sm-2 col-form-label">Customer Name</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="customer_name" id="customer_name"
												class="form-control form-control-sm" maxlength="50" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="customer_name"
												th:value="${billdata?.customer_name}"
												class="form-control form-control-sm" required
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>

										<!-- Branch Name -->
										<label class="col-sm-2 col-form-label">Account No</label>
										<div class="col-sm-3" th:if="${formmode}=='Addbilldetail'">
											<input type="text" name="account_no" id="account_no"
												class="form-control form-control-sm" maxlength="100" required />
										</div>

										<div class="col-sm-3"
											th:if="${formmode}=='Editbilldetail' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'">
											<input type="text" name="account_no" th:value="${billdata?.account_no}"
												class="form-control form-control-sm" required
												th:readonly="${formmode}=='view' or ${formmode}=='Deletebilldetail' or ${formmode}=='Verifybilldetail'" />
										</div>

										<div class="col-sm-1"></div>
									</div>


								</div>

								<!-- Save / Update Buttons -->
								<div class="d-flex justify-content-center align-items-center">
									<button type="button" class="custom-tab-btn" th:attr="data-formmode='Addbilldetail'"
										th:if="${formmode}=='Addbilldetail'" onclick="confirmSubmit(this)">
										<i class="fa fa-save"></i> Submit Data
									</button>

									<button type="button" class="custom-tab-btn"
										th:attr="data-formmode='Editbilldetail'" th:if="${formmode}=='Editbilldetail'"
										onclick="confirmSubmit(this)">
										<i class="fa fa-edit"></i> Update Data
									</button>

									<button type="button" class="custom-tab-btn"
										th:attr="data-formmode='Deletebilldetail'"
										th:if="${formmode}=='Deletebilldetail'" onclick="confirmSubmit(this)"
										style="background-color: #dc3545;color: beige;">
										<i class="fa fa-edit"></i> Delete Data
									</button>

									<button type="button" class="custom-tab-btn" th:attr="data-formmode='Verifybilldetail',data-modifyuser=${billdata?.modify_user}
										,data-entryuser=${billdata?.entry_user}"
										th:if="${formmode == 'Verifybilldetail' and billdata?.verify_flg != 'Y' and session.WORKCLASS == 'C'}"
										onclick="confirmSubmit(this)" style="background-color: green;color: beige;">
										<i class="fa fa-edit"></i> Verify Data
									</button>

									<!--	<button type="button" class="custom-tab-btn" onclick="window.history.back();">
										<i class="fa fa-arrow-left"></i> Back
									</button>-->
								</div>
							</form>
						</div>
					</div>
				</div>


			</div>
		</div>
	</div>


	<div class="modal fade" id="alert">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: white;;">BANK OF
						BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg" style="font-family: sans-serif;text-decoration-color: black;"></p>
					<button type="button" class="btn " onclick="back()" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="Listpagealertmessage">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: white;;">BANK OF
						BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg"></p>
					<button type="button" class="btn " onclick="movetolistpage()" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="loader1" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content" style="background: transparent;">
				<div class="modal-body" style="text-align: center">
					<div>
						<img th:src=@{/images/loader.gif} id="bfirelogo" style="width: 153px; height: auto; margin-left: 18px; background-color: transparent;
								border-color: transparent;" alt="Bornfire">
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Floating Back Button -->
	<button id="floatingBackBtn" onclick="goBack()" title="Go Back">
		<i class="fa fa-arrow-left"></i>
	</button>
	<!-- Floating Forward Button -->
	<button id="floatingForwardBtn" onclick="goForward()" title="Go Forward">
		<i class="fa fa-arrow-right"></i>
	</button>
	<div class="modal fade" id="alert1">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: white;;">BANK OF
						BARODA</div>
				</div>
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg1"></p>
					<button type="button" class="btn " onclick="replace()" data-dismiss="modal">Replace</button>
					<button type="button" class="btn" data-dismiss="modal" onclick="ignore();">Ignore</button>

				</div>
			</div>
		</div>
	</div>

</body>

</html>